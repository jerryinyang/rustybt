
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Modern Python backtesting engine built on Zipline-Reloaded">
      
      
        <meta name="author" content="RustyBT Development Team">
      
      
        <link rel="canonical" href="https://jerryinyang.github.io/rustybt/architecture/optimization/">
      
      
      
      
      <link rel="icon" href="../../assets/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.21">
    
    
      
        <title>Optimization Framework Architecture - RustyBT Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.2a3383ac.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#optimization-framework-architecture" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="RustyBT Documentation" class="md-header__button md-logo" aria-label="RustyBT Documentation" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            RustyBT Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Optimization Framework Architecture
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/jerryinyang/rustybt" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    jerryinyang/rustybt
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../getting-started/installation/" class="md-tabs__link">
          
  
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../guides/decimal-precision-configuration/" class="md-tabs__link">
          
  
  
  User Guides

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../examples/" class="md-tabs__link">
          
  
  
  Examples & Tutorials

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../api/order-types/" class="md-tabs__link">
          
  
  
  API Reference

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../about/license/" class="md-tabs__link">
          
  
  
  About

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="RustyBT Documentation" class="md-nav__button md-logo" aria-label="RustyBT Documentation" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    RustyBT Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/jerryinyang/rustybt" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    jerryinyang/rustybt
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quick Start
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    User Guides
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            User Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/decimal-precision-configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Decimal Precision
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/caching-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Caching System
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/creating-data-adapters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Creating Data Adapters
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/csv-data-import/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CSV Data Import
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/testnet-setup-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Testnet Setup
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Examples & Tutorials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Examples & Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Overview APIs
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            Overview APIs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/order-types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Order Types
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/caching-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Caching API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/bundle-metadata-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bundle Metadata API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/datasource-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Datasource API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/finance-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Finance API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/optimization-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Optimization API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/live-trading-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Live Trading API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/analytics-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Analytics API
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Data Management
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Data Management
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/data-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2_2" id="__nav_5_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Adapters
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2_2">
            <span class="md-nav__icon md-icon"></span>
            Adapters
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/data-management/adapters/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/data-management/adapters/ccxt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CCXT
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/data-management/adapters/yfinance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    YFinance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/data-management/adapters/csv/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CSV
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/data-management/adapters/polygon/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Polygon
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/data-management/adapters/alpaca/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Alpaca
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/data-management/adapters/alphavantage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AlphaVantage
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2_3" >
        
          
          <label class="md-nav__link" for="__nav_5_2_3" id="__nav_5_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Catalog
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2_3">
            <span class="md-nav__icon md-icon"></span>
            Catalog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/data-management/catalog/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/data-management/catalog/bundles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bundles
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/data-management/catalog/metadata/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Metadata
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/data-management/catalog/migration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Migration
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2_4" >
        
          
          <label class="md-nav__link" for="__nav_5_2_4" id="__nav_5_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Readers
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2_4">
            <span class="md-nav__icon md-icon"></span>
            Readers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/data-management/readers/data-portal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Data Portal
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/data-management/readers/bar-readers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bar Readers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/data-management/readers/history-loader/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    History Loader
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/data-management/readers/continuous-futures/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Continuous Futures
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2_5" >
        
          
          <label class="md-nav__link" for="__nav_5_2_5" id="__nav_5_2_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    FX System
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2_5">
            <span class="md-nav__icon md-icon"></span>
            FX System
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/data-management/fx/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/data-management/fx/providers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Providers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/data-management/fx/storage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Storage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/data-management/fx/converters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Converters
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2_6" >
        
          
          <label class="md-nav__link" for="__nav_5_2_6" id="__nav_5_2_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Pipeline
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2_6">
            <span class="md-nav__icon md-icon"></span>
            Pipeline
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/data-management/pipeline/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/data-management/pipeline/factors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Factors
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/data-management/pipeline/filters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Filters
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/data-management/pipeline/loaders/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Loaders
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/data-management/pipeline/expressions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Expressions
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2_7" >
        
          
          <label class="md-nav__link" for="__nav_5_2_7" id="__nav_5_2_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Performance
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2_7">
            <span class="md-nav__icon md-icon"></span>
            Performance
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/data-management/performance/caching/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Caching
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/data-management/performance/optimization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Optimization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/data-management/performance/troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Troubleshooting
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Order Management
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            Order Management
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/order-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/order-management/order-types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Order Types
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_3_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3_3" id="__nav_5_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Execution
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3_3">
            <span class="md-nav__icon md-icon"></span>
            Execution
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/order-management/execution/blotter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Blotter
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_3_4" >
        
          
          <label class="md-nav__link" for="__nav_5_3_4" id="__nav_5_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Transaction Costs
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3_4">
            <span class="md-nav__icon md-icon"></span>
            Transaction Costs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/order-management/transaction-costs/slippage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Slippage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/order-management/transaction-costs/commissions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Commissions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/order-management/transaction-costs/borrow-costs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Borrow Costs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/order-management/transaction-costs/financing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Financing
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_3_5" >
        
          
          <label class="md-nav__link" for="__nav_5_3_5" id="__nav_5_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Workflows
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3_5">
            <span class="md-nav__icon md-icon"></span>
            Workflows
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/order-management/workflows/order-lifecycle/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Order Lifecycle
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/order-management/workflows/examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Portfolio Management
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            Portfolio Management
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/portfolio-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_4_2" >
        
          
          <label class="md-nav__link" for="__nav_5_4_2" id="__nav_5_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Multi-Strategy
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4_2">
            <span class="md-nav__icon md-icon"></span>
            Multi-Strategy
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/portfolio-management/multi-strategy/allocators/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Allocators
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_4_3" >
        
          
          <label class="md-nav__link" for="__nav_5_4_3" id="__nav_5_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Risk
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4_3">
            <span class="md-nav__icon md-icon"></span>
            Risk
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/portfolio-management/risk/position-limits/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Position Limits
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_4_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4_4" id="__nav_5_4_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Performance
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4_4">
            <span class="md-nav__icon md-icon"></span>
            Performance
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/portfolio-management/performance/metrics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Metrics
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_5" >
        
          
          <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Optimization
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            Optimization
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/optimization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_5_2" id="__nav_5_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Framework
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5_2">
            <span class="md-nav__icon md-icon"></span>
            Framework
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/optimization/framework/architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/optimization/framework/parameter-spaces/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Parameter Spaces
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/optimization/framework/objective-functions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Objective Functions
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_5_3" id="__nav_5_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Algorithms
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5_3">
            <span class="md-nav__icon md-icon"></span>
            Algorithms
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/optimization/algorithms/grid-search/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Grid Search
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/optimization/algorithms/random-search/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Random Search
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/optimization/algorithms/bayesian/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bayesian
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/optimization/algorithms/genetic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Genetic
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_5_4" id="__nav_5_5_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Walk-Forward
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5_4">
            <span class="md-nav__icon md-icon"></span>
            Walk-Forward
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/optimization/walk-forward/framework/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Framework
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/optimization/walk-forward/windows/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Windows
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/optimization/walk-forward/validation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_5_5" >
        
          
          <label class="md-nav__link" for="__nav_5_5_5" id="__nav_5_5_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Monte Carlo
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5_5">
            <span class="md-nav__icon md-icon"></span>
            Monte Carlo
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/optimization/monte-carlo/stability-testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Stability Testing
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_5_6" >
        
          
          <label class="md-nav__link" for="__nav_5_5_6" id="__nav_5_5_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Parallel
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_5_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5_6">
            <span class="md-nav__icon md-icon"></span>
            Parallel
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/optimization/parallel/multiprocessing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Multiprocessing
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_5_7" >
        
          
          <label class="md-nav__link" for="__nav_5_5_7" id="__nav_5_5_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Best Practices
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_5_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5_7">
            <span class="md-nav__icon md-icon"></span>
            Best Practices
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/optimization/best-practices/overfitting-prevention/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overfitting Prevention
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_6" >
        
          
          <label class="md-nav__link" for="__nav_5_6" id="__nav_5_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Analytics
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6">
            <span class="md-nav__icon md-icon"></span>
            Analytics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/analytics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_6_2" >
        
          
          <label class="md-nav__link" for="__nav_5_6_2" id="__nav_5_6_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Risk
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6_2">
            <span class="md-nav__icon md-icon"></span>
            Risk
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/analytics/risk/metrics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Metrics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/analytics/risk/var-cvar/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    VaR & CVaR
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/analytics/risk/drawdown/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Drawdown
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_7" >
        
          
          <label class="md-nav__link" for="__nav_5_7" id="__nav_5_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Live Trading
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_7">
            <span class="md-nav__icon md-icon"></span>
            Live Trading
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/live-trading/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_7_2" >
        
          
          <label class="md-nav__link" for="__nav_5_7_2" id="__nav_5_7_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Safety
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_7_2">
            <span class="md-nav__icon md-icon"></span>
            Safety
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/live-trading/safety/circuit-breakers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Circuit Breakers
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_8" >
        
          
          <label class="md-nav__link" for="__nav_5_8" id="__nav_5_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Testing
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_8">
            <span class="md-nav__icon md-icon"></span>
            Testing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    About
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            About
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/license/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    License
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Changelog
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#design-principles" class="md-nav__link">
    <span class="md-ellipsis">
      Design Principles
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture-diagram" class="md-nav__link">
    <span class="md-ellipsis">
      Architecture Diagram
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#component-specifications" class="md-nav__link">
    <span class="md-ellipsis">
      Component Specifications
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Component Specifications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-parameterspace" class="md-nav__link">
    <span class="md-ellipsis">
      1. ParameterSpace
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-searchalgorithm-abstract-base-class" class="md-nav__link">
    <span class="md-ellipsis">
      2. SearchAlgorithm Abstract Base Class
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-objectivefunction" class="md-nav__link">
    <span class="md-ellipsis">
      3. ObjectiveFunction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-optimizationresult" class="md-nav__link">
    <span class="md-ellipsis">
      4. OptimizationResult
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-optimizer-orchestrator" class="md-nav__link">
    <span class="md-ellipsis">
      5. Optimizer Orchestrator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-parallel-execution-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      6. Parallel Execution Architecture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-backtest-integration" class="md-nav__link">
    <span class="md-ellipsis">
      7. Backtest Integration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extensibility" class="md-nav__link">
    <span class="md-ellipsis">
      Extensibility
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Extensibility">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adding-new-search-algorithms" class="md-nav__link">
    <span class="md-ellipsis">
      Adding New Search Algorithms
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#search-algorithm-implementations" class="md-nav__link">
    <span class="md-ellipsis">
      Search Algorithm Implementations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Search Algorithm Implementations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#grid-search-algorithm-story-52" class="md-nav__link">
    <span class="md-ellipsis">
      Grid Search Algorithm (Story 5.2)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#random-search-algorithm-story-53" class="md-nav__link">
    <span class="md-ellipsis">
      Random Search Algorithm (Story 5.3)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bayesian-optimization-algorithm-story-54" class="md-nav__link">
    <span class="md-ellipsis">
      Bayesian Optimization Algorithm (Story 5.4) ✅
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Bayesian Optimization Algorithm (Story 5.4) ✅">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-features" class="md-nav__link">
    <span class="md-ellipsis">
      Key Features
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#when-to-use-bayesian-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      When to Use Bayesian Optimization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usage-example" class="md-nav__link">
    <span class="md-ellipsis">
      Usage Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#acquisition-functions-explained" class="md-nav__link">
    <span class="md-ellipsis">
      Acquisition Functions Explained
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prior-knowledge-seeding" class="md-nav__link">
    <span class="md-ellipsis">
      Prior Knowledge Seeding
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#convergence-detection" class="md-nav__link">
    <span class="md-ellipsis">
      Convergence Detection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-expectations" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Expectations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#technical-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Technical Implementation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#limitations" class="md-nav__link">
    <span class="md-ellipsis">
      Limitations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#comparison-with-other-algorithms" class="md-nav__link">
    <span class="md-ellipsis">
      Comparison with Other Algorithms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-bayesian-vs-grid-vs-random" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Bayesian vs Grid vs Random
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#genetic-algorithm-story-55" class="md-nav__link">
    <span class="md-ellipsis">
      Genetic Algorithm (Story 5.5) ✅
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Genetic Algorithm (Story 5.5) ✅">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-features_1" class="md-nav__link">
    <span class="md-ellipsis">
      Key Features
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#when-to-use-genetic-algorithms" class="md-nav__link">
    <span class="md-ellipsis">
      When to Use Genetic Algorithms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usage-example_1" class="md-nav__link">
    <span class="md-ellipsis">
      Usage Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#operator-configuration-guide" class="md-nav__link">
    <span class="md-ellipsis">
      Operator Configuration Guide
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diversity-tracking" class="md-nav__link">
    <span class="md-ellipsis">
      Diversity Tracking
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#termination-criteria" class="md-nav__link">
    <span class="md-ellipsis">
      Termination Criteria
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-expectations_1" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Expectations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#technical-implementation_1" class="md-nav__link">
    <span class="md-ellipsis">
      Technical Implementation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#comparison-ga-vs-bayesian-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Comparison: GA vs Bayesian Optimization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-ga-on-non-smooth-function" class="md-nav__link">
    <span class="md-ellipsis">
      Example: GA on Non-Smooth Function
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration-recommendations" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration Recommendations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation-roadmap" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation Roadmap
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#technology-stack" class="md-nav__link">
    <span class="md-ellipsis">
      Technology Stack
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      Testing Strategy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testing Strategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#unit-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Unit Tests
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Integration Tests
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#property-tests-hypothesis" class="md-nav__link">
    <span class="md-ellipsis">
      Property Tests (Hypothesis)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#no-mocking" class="md-nav__link">
    <span class="md-ellipsis">
      No Mocking
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#design-review-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      Design Review Checklist
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#walk-forward-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Walk-Forward Optimization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Walk-Forward Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview_1" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Architecture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#window-types" class="md-nav__link">
    <span class="md-ellipsis">
      Window Types
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-components" class="md-nav__link">
    <span class="md-ellipsis">
      Key Components
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Key Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-windowconfig" class="md-nav__link">
    <span class="md-ellipsis">
      1. WindowConfig
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-windowdata" class="md-nav__link">
    <span class="md-ellipsis">
      2. WindowData
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-walkforwardoptimizer" class="md-nav__link">
    <span class="md-ellipsis">
      3. WalkForwardOptimizer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usage-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      Usage Pattern
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#overfitting-detection" class="md-nav__link">
    <span class="md-ellipsis">
      Overfitting Detection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Best Practices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-details" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation Details
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#parameter-sensitivity-and-stability-analysis-story-58" class="md-nav__link">
    <span class="md-ellipsis">
      Parameter Sensitivity and Stability Analysis (Story 5.8)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Parameter Sensitivity and Stability Analysis (Story 5.8)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview_2" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#core-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      Core Concepts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Concepts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sensitivity-vs-stability" class="md-nav__link">
    <span class="md-ellipsis">
      Sensitivity vs. Stability
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#overfitting-detection_1" class="md-nav__link">
    <span class="md-ellipsis">
      Overfitting Detection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sensitivity-analysis-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      Sensitivity Analysis Workflow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-components_1" class="md-nav__link">
    <span class="md-ellipsis">
      Key Components
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Key Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-sensitivityanalyzer" class="md-nav__link">
    <span class="md-ellipsis">
      1. SensitivityAnalyzer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-single-parameter-variation" class="md-nav__link">
    <span class="md-ellipsis">
      2. Single-Parameter Variation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-stability-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      3. Stability Metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-interaction-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      4. Interaction Analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-confidence-intervals" class="md-nav__link">
    <span class="md-ellipsis">
      5. Confidence Intervals
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-visualization" class="md-nav__link">
    <span class="md-ellipsis">
      6. Visualization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-analysis-report" class="md-nav__link">
    <span class="md-ellipsis">
      7. Analysis Report
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-with-optimization-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      Integration with Optimization Workflow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synthetic-test-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Synthetic Test Functions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-cases" class="md-nav__link">
    <span class="md-ellipsis">
      Use Cases
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Use Cases">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-post-optimization-validation" class="md-nav__link">
    <span class="md-ellipsis">
      1. Post-Optimization Validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-parameter-selection" class="md-nav__link">
    <span class="md-ellipsis">
      2. Parameter Selection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-search-space-refinement" class="md-nav__link">
    <span class="md-ellipsis">
      3. Search Space Refinement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-algorithm-selection" class="md-nav__link">
    <span class="md-ellipsis">
      4. Algorithm Selection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Considerations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#limitations-and-caveats" class="md-nav__link">
    <span class="md-ellipsis">
      Limitations and Caveats
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Limitations and Caveats">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-local-analysis-only" class="md-nav__link">
    <span class="md-ellipsis">
      1. Local Analysis Only
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-assumes-smooth-objective" class="md-nav__link">
    <span class="md-ellipsis">
      2. Assumes Smooth Objective
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-correlation-vs-interaction" class="md-nav__link">
    <span class="md-ellipsis">
      3. Correlation vs. Interaction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-no-causality-claims" class="md-nav__link">
    <span class="md-ellipsis">
      4. No Causality Claims
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-notes" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation Notes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-complete-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Complete Analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#monte-carlo-simulation-with-data-permutation-story-59" class="md-nav__link">
    <span class="md-ellipsis">
      Monte Carlo Simulation with Data Permutation (Story 5.9)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Monte Carlo Simulation with Data Permutation (Story 5.9)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview_3" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#core-concepts_1" class="md-nav__link">
    <span class="md-ellipsis">
      Core Concepts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Concepts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-central-question" class="md-nav__link">
    <span class="md-ellipsis">
      The Central Question
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#permutation-method" class="md-nav__link">
    <span class="md-ellipsis">
      Permutation Method
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bootstrap-method" class="md-nav__link">
    <span class="md-ellipsis">
      Bootstrap Method
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-components_2" class="md-nav__link">
    <span class="md-ellipsis">
      Key Components
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Key Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-montecarlosimulator" class="md-nav__link">
    <span class="md-ellipsis">
      1. MonteCarloSimulator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-statistical-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      2. Statistical Analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-robustness-classification" class="md-nav__link">
    <span class="md-ellipsis">
      3. Robustness Classification
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-visualization" class="md-nav__link">
    <span class="md-ellipsis">
      4. Visualization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-monte-carlo-results" class="md-nav__link">
    <span class="md-ellipsis">
      5. Monte Carlo Results
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usage-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      Usage Patterns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Usage Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-post-backtest-validation" class="md-nav__link">
    <span class="md-ellipsis">
      1. Post-Backtest Validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-integration-with-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      2. Integration with Optimization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-multiple-metrics-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      3. Multiple Metrics Analysis
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#interpretation-guide" class="md-nav__link">
    <span class="md-ellipsis">
      Interpretation Guide
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Interpretation Guide">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#robust-strategy-indicators" class="md-nav__link">
    <span class="md-ellipsis">
      Robust Strategy Indicators
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luck-indicators" class="md-nav__link">
    <span class="md-ellipsis">
      Luck Indicators
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edge-cases" class="md-nav__link">
    <span class="md-ellipsis">
      Edge Cases
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#technical-implementation_2" class="md-nav__link">
    <span class="md-ellipsis">
      Technical Implementation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Technical Implementation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#permutation-algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      Permutation Algorithm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#equity-curve-reconstruction" class="md-nav__link">
    <span class="md-ellipsis">
      Equity Curve Reconstruction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#statistical-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Statistical Metrics
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-considerations_1" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Considerations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#limitations-and-caveats_1" class="md-nav__link">
    <span class="md-ellipsis">
      Limitations and Caveats
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Limitations and Caveats">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-assumes-iid-trades" class="md-nav__link">
    <span class="md-ellipsis">
      1. Assumes IID Trades
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-preserves-trade-outcomes" class="md-nav__link">
    <span class="md-ellipsis">
      2. Preserves Trade Outcomes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-distribution-assumptions" class="md-nav__link">
    <span class="md-ellipsis">
      3. Distribution Assumptions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-interpretation-context" class="md-nav__link">
    <span class="md-ellipsis">
      4. Interpretation Context
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-with-validation-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Integration with Validation Pipeline
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-complete-analysis_1" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Complete Analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#references_1" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#noise-infusion-simulation" class="md-nav__link">
    <span class="md-ellipsis">
      Noise Infusion Simulation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Noise Infusion Simulation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview_4" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#concept" class="md-nav__link">
    <span class="md-ellipsis">
      Concept
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#architecture_1" class="md-nav__link">
    <span class="md-ellipsis">
      Architecture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#noise-models" class="md-nav__link">
    <span class="md-ellipsis">
      Noise Models
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Noise Models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-gaussian-noise" class="md-nav__link">
    <span class="md-ellipsis">
      1. Gaussian Noise
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-bootstrap-noise" class="md-nav__link">
    <span class="md-ellipsis">
      2. Bootstrap Noise
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ohlcv-constraint-validation" class="md-nav__link">
    <span class="md-ellipsis">
      OHLCV Constraint Validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#degradation-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Degradation Analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usage-example_2" class="md-nav__link">
    <span class="md-ellipsis">
      Usage Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#comparison-with-monte-carlo-permutation" class="md-nav__link">
    <span class="md-ellipsis">
      Comparison with Monte Carlo Permutation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#noise-amplitude-guidelines" class="md-nav__link">
    <span class="md-ellipsis">
      Noise Amplitude Guidelines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#temporal-structure-preservation-advanced" class="md-nav__link">
    <span class="md-ellipsis">
      Temporal Structure Preservation (Advanced)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-with-optimization-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Integration with Optimization Pipeline
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-strategy_1" class="md-nav__link">
    <span class="md-ellipsis">
      Testing Strategy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-considerations_2" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Considerations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#references_2" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="optimization-framework-architecture">Optimization Framework Architecture<a class="headerlink" href="#optimization-framework-architecture" title="Permanent link">&para;</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>The RustyBT optimization framework enables systematic parameter tuning for trading strategies through pluggable search algorithms, parallel execution, and robust checkpoint/resume capabilities. The design draws from proven patterns in scikit-optimize (Bayesian optimization), DEAP (genetic algorithms), and Optuna (trial management).</p>
<h2 id="design-principles">Design Principles<a class="headerlink" href="#design-principles" title="Permanent link">&para;</a></h2>
<ol>
<li><strong>Separation of Concerns</strong>: Search algorithms focus on parameter suggestion logic; Optimizer handles orchestration, persistence, and backtest integration</li>
<li><strong>Extensibility</strong>: Adding new search algorithms requires only implementing the SearchAlgorithm interface</li>
<li><strong>Ask-and-Tell Pattern</strong>: Decouples parameter suggestion from evaluation, enabling flexible control flow</li>
<li><strong>Type Safety</strong>: Full type hints with pydantic validation for all data structures</li>
<li><strong>Zero-Mock</strong>: All components implement real calculations, no hardcoded values or stubs</li>
</ol>
<h2 id="architecture-diagram">Architecture Diagram<a class="headerlink" href="#architecture-diagram" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>graph TB
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    subgraph &quot;User Interface&quot;
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>        User[User Strategy Code]
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>        Config[Optimization Config]
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    end
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    subgraph &quot;Optimizer Core&quot;
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>        Optimizer[Optimizer Orchestrator]
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>        ParamSpace[ParameterSpace]
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>        ObjFunc[ObjectiveFunction]
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>    end
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>    subgraph &quot;Search Algorithms&quot;
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>        SearchBase[SearchAlgorithm ABC]
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>        GridSearch[GridSearchAlgorithm]
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>        RandomSearch[RandomSearchAlgorithm]
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>        BayesianSearch[BayesianSearchAlgorithm]
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>        GeneticAlgo[GeneticAlgorithm]
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>    end
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>    subgraph &quot;Execution Engine&quot;
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>        Executor[ParallelExecutor]
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>        LocalPool[Multiprocessing Pool]
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>        RayPool[Ray Distributed Pool]
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>        BacktestRunner[Backtest Runner]
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>    end
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a>
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a>    subgraph &quot;Storage &amp; State&quot;
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a>        ResultStore[OptimizationResultStore]
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a>        Checkpoint[CheckpointManager]
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a>        History[HistoryTracker]
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a>    end
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a>
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a>    User --&gt;|configure| Config
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a>    Config --&gt;|initialize| Optimizer
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a>    Optimizer --&gt;|validate| ParamSpace
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a>    Optimizer --&gt;|use| SearchBase
<a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a>    SearchBase -.implements.-&gt; GridSearch
<a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a>    SearchBase -.implements.-&gt; RandomSearch
<a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a>    SearchBase -.implements.-&gt; BayesianSearch
<a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a>    SearchBase -.implements.-&gt; GeneticAlgo
<a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a>
<a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a>    Optimizer --&gt;|ask| SearchBase
<a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a>    SearchBase --&gt;|suggest params| Optimizer
<a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a>    Optimizer --&gt;|submit jobs| Executor
<a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a>    Executor --&gt;|run| BacktestRunner
<a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a>    BacktestRunner --&gt;|extract metrics| ObjFunc
<a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a>    ObjFunc --&gt;|return score| Executor
<a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a>    Executor --&gt;|results| Optimizer
<a id="__codelineno-0-50" name="__codelineno-0-50" href="#__codelineno-0-50"></a>    Optimizer --&gt;|tell| SearchBase
<a id="__codelineno-0-51" name="__codelineno-0-51" href="#__codelineno-0-51"></a>
<a id="__codelineno-0-52" name="__codelineno-0-52" href="#__codelineno-0-52"></a>    Optimizer --&gt;|save| Checkpoint
<a id="__codelineno-0-53" name="__codelineno-0-53" href="#__codelineno-0-53"></a>    Optimizer --&gt;|store| ResultStore
<a id="__codelineno-0-54" name="__codelineno-0-54" href="#__codelineno-0-54"></a>    Optimizer --&gt;|track| History
<a id="__codelineno-0-55" name="__codelineno-0-55" href="#__codelineno-0-55"></a>
<a id="__codelineno-0-56" name="__codelineno-0-56" href="#__codelineno-0-56"></a>    Executor -.local.-&gt; LocalPool
<a id="__codelineno-0-57" name="__codelineno-0-57" href="#__codelineno-0-57"></a>    Executor -.distributed.-&gt; RayPool
<a id="__codelineno-0-58" name="__codelineno-0-58" href="#__codelineno-0-58"></a>
<a id="__codelineno-0-59" name="__codelineno-0-59" href="#__codelineno-0-59"></a>    style Optimizer fill:#4A90E2,color:#fff
<a id="__codelineno-0-60" name="__codelineno-0-60" href="#__codelineno-0-60"></a>    style SearchBase fill:#E27B4A,color:#fff
<a id="__codelineno-0-61" name="__codelineno-0-61" href="#__codelineno-0-61"></a>    style Executor fill:#50C878,color:#fff
<a id="__codelineno-0-62" name="__codelineno-0-62" href="#__codelineno-0-62"></a>    style ResultStore fill:#9B59B6,color:#fff
</code></pre></div>
<h2 id="component-specifications">Component Specifications<a class="headerlink" href="#component-specifications" title="Permanent link">&para;</a></h2>
<h3 id="1-parameterspace">1. ParameterSpace<a class="headerlink" href="#1-parameterspace" title="Permanent link">&para;</a></h3>
<p><strong>Purpose</strong>: Define optimization parameter search space with validation</p>
<p><strong>Interface</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Any</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span><span class="p">,</span> <span class="n">field_validator</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="k">class</span> <span class="nc">ContinuousParameter</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Continuous parameter (float/Decimal) with bounds.&quot;&quot;&quot;</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>    <span class="n">min_value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">]</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>    <span class="n">max_value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">]</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>    <span class="n">prior</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;uniform&quot;</span><span class="p">,</span> <span class="s2">&quot;log-uniform&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;uniform&quot;</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>    <span class="nd">@field_validator</span><span class="p">(</span><span class="s1">&#39;max_value&#39;</span><span class="p">)</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>    <span class="k">def</span> <span class="nf">validate_bounds</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>        <span class="k">if</span> <span class="n">v</span> <span class="o">&lt;=</span> <span class="n">info</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;min_value&#39;</span><span class="p">):</span>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;max_value must be &gt; min_value&quot;</span><span class="p">)</span>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>        <span class="k">return</span> <span class="n">v</span>
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="k">class</span> <span class="nc">DiscreteParameter</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Discrete integer parameter with bounds and step.&quot;&quot;&quot;</span>
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a>    <span class="n">min_value</span><span class="p">:</span> <span class="nb">int</span>
<a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a>    <span class="n">max_value</span><span class="p">:</span> <span class="nb">int</span>
<a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a>    <span class="n">step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a>
<a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a>    <span class="nd">@field_validator</span><span class="p">(</span><span class="s1">&#39;step&#39;</span><span class="p">)</span>
<a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a>    <span class="k">def</span> <span class="nf">validate_step</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span>
<a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a>        <span class="k">if</span> <span class="n">v</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;step must be positive&quot;</span><span class="p">)</span>
<a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a>        <span class="n">range_size</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;max_value&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="n">info</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;min_value&#39;</span><span class="p">)</span>
<a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a>        <span class="k">if</span> <span class="n">range_size</span> <span class="o">%</span> <span class="n">v</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;step </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2"> does not divide range evenly&quot;</span><span class="p">)</span>
<a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a>        <span class="k">return</span> <span class="n">v</span>
<a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a>
<a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a><span class="k">class</span> <span class="nc">CategoricalParameter</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<a id="__codelineno-1-36" name="__codelineno-1-36" href="#__codelineno-1-36"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Categorical parameter with fixed choices.&quot;&quot;&quot;</span>
<a id="__codelineno-1-37" name="__codelineno-1-37" href="#__codelineno-1-37"></a>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-1-38" name="__codelineno-1-38" href="#__codelineno-1-38"></a>    <span class="n">choices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span>
<a id="__codelineno-1-39" name="__codelineno-1-39" href="#__codelineno-1-39"></a>
<a id="__codelineno-1-40" name="__codelineno-1-40" href="#__codelineno-1-40"></a>    <span class="nd">@field_validator</span><span class="p">(</span><span class="s1">&#39;choices&#39;</span><span class="p">)</span>
<a id="__codelineno-1-41" name="__codelineno-1-41" href="#__codelineno-1-41"></a>    <span class="k">def</span> <span class="nf">validate_choices</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
<a id="__codelineno-1-42" name="__codelineno-1-42" href="#__codelineno-1-42"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-1-43" name="__codelineno-1-43" href="#__codelineno-1-43"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must have at least 2 choices&quot;</span><span class="p">)</span>
<a id="__codelineno-1-44" name="__codelineno-1-44" href="#__codelineno-1-44"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">v</span><span class="p">))):</span>
<a id="__codelineno-1-45" name="__codelineno-1-45" href="#__codelineno-1-45"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Choices must be unique&quot;</span><span class="p">)</span>
<a id="__codelineno-1-46" name="__codelineno-1-46" href="#__codelineno-1-46"></a>        <span class="k">return</span> <span class="n">v</span>
<a id="__codelineno-1-47" name="__codelineno-1-47" href="#__codelineno-1-47"></a>
<a id="__codelineno-1-48" name="__codelineno-1-48" href="#__codelineno-1-48"></a><span class="k">class</span> <span class="nc">ParameterSpace</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<a id="__codelineno-1-49" name="__codelineno-1-49" href="#__codelineno-1-49"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Complete parameter space definition.&quot;&quot;&quot;</span>
<a id="__codelineno-1-50" name="__codelineno-1-50" href="#__codelineno-1-50"></a>    <span class="n">parameters</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">ContinuousParameter</span><span class="p">,</span> <span class="n">DiscreteParameter</span><span class="p">,</span> <span class="n">CategoricalParameter</span><span class="p">]]</span>
<a id="__codelineno-1-51" name="__codelineno-1-51" href="#__codelineno-1-51"></a>
<a id="__codelineno-1-52" name="__codelineno-1-52" href="#__codelineno-1-52"></a>    <span class="nd">@field_validator</span><span class="p">(</span><span class="s1">&#39;parameters&#39;</span><span class="p">)</span>
<a id="__codelineno-1-53" name="__codelineno-1-53" href="#__codelineno-1-53"></a>    <span class="k">def</span> <span class="nf">validate_unique_names</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
<a id="__codelineno-1-54" name="__codelineno-1-54" href="#__codelineno-1-54"></a>        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">v</span><span class="p">]</span>
<a id="__codelineno-1-55" name="__codelineno-1-55" href="#__codelineno-1-55"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">names</span><span class="p">)):</span>
<a id="__codelineno-1-56" name="__codelineno-1-56" href="#__codelineno-1-56"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Parameter names must be unique&quot;</span><span class="p">)</span>
<a id="__codelineno-1-57" name="__codelineno-1-57" href="#__codelineno-1-57"></a>        <span class="k">return</span> <span class="n">v</span>
<a id="__codelineno-1-58" name="__codelineno-1-58" href="#__codelineno-1-58"></a>
<a id="__codelineno-1-59" name="__codelineno-1-59" href="#__codelineno-1-59"></a>    <span class="k">def</span> <span class="nf">get_parameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">ContinuousParameter</span><span class="p">,</span> <span class="n">DiscreteParameter</span><span class="p">,</span> <span class="n">CategoricalParameter</span><span class="p">]:</span>
<a id="__codelineno-1-60" name="__codelineno-1-60" href="#__codelineno-1-60"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get parameter by name.&quot;&quot;&quot;</span>
<a id="__codelineno-1-61" name="__codelineno-1-61" href="#__codelineno-1-61"></a>        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
<a id="__codelineno-1-62" name="__codelineno-1-62" href="#__codelineno-1-62"></a>            <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
<a id="__codelineno-1-63" name="__codelineno-1-63" href="#__codelineno-1-63"></a>                <span class="k">return</span> <span class="n">param</span>
<a id="__codelineno-1-64" name="__codelineno-1-64" href="#__codelineno-1-64"></a>        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Parameter &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
<a id="__codelineno-1-65" name="__codelineno-1-65" href="#__codelineno-1-65"></a>
<a id="__codelineno-1-66" name="__codelineno-1-66" href="#__codelineno-1-66"></a>    <span class="k">def</span> <span class="nf">validate_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-1-67" name="__codelineno-1-67" href="#__codelineno-1-67"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate parameter values against space constraints.&quot;&quot;&quot;</span>
<a id="__codelineno-1-68" name="__codelineno-1-68" href="#__codelineno-1-68"></a>        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-1-69" name="__codelineno-1-69" href="#__codelineno-1-69"></a>            <span class="n">param</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<a id="__codelineno-1-70" name="__codelineno-1-70" href="#__codelineno-1-70"></a>
<a id="__codelineno-1-71" name="__codelineno-1-71" href="#__codelineno-1-71"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">ContinuousParameter</span><span class="p">):</span>
<a id="__codelineno-1-72" name="__codelineno-1-72" href="#__codelineno-1-72"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">min_value</span> <span class="o">&lt;=</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="n">param</span><span class="o">.</span><span class="n">max_value</span><span class="p">):</span>
<a id="__codelineno-1-73" name="__codelineno-1-73" href="#__codelineno-1-73"></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-1-74" name="__codelineno-1-74" href="#__codelineno-1-74"></a>                        <span class="sa">f</span><span class="s2">&quot;Parameter &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; value </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2"> outside bounds &quot;</span>
<a id="__codelineno-1-75" name="__codelineno-1-75" href="#__codelineno-1-75"></a>                        <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">param</span><span class="o">.</span><span class="n">min_value</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">param</span><span class="o">.</span><span class="n">max_value</span><span class="si">}</span><span class="s2">]&quot;</span>
<a id="__codelineno-1-76" name="__codelineno-1-76" href="#__codelineno-1-76"></a>                    <span class="p">)</span>
<a id="__codelineno-1-77" name="__codelineno-1-77" href="#__codelineno-1-77"></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">DiscreteParameter</span><span class="p">):</span>
<a id="__codelineno-1-78" name="__codelineno-1-78" href="#__codelineno-1-78"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">min_value</span> <span class="o">&lt;=</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="n">param</span><span class="o">.</span><span class="n">max_value</span><span class="p">):</span>
<a id="__codelineno-1-79" name="__codelineno-1-79" href="#__codelineno-1-79"></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-1-80" name="__codelineno-1-80" href="#__codelineno-1-80"></a>                        <span class="sa">f</span><span class="s2">&quot;Parameter &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; value </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2"> outside bounds &quot;</span>
<a id="__codelineno-1-81" name="__codelineno-1-81" href="#__codelineno-1-81"></a>                        <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">param</span><span class="o">.</span><span class="n">min_value</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">param</span><span class="o">.</span><span class="n">max_value</span><span class="si">}</span><span class="s2">]&quot;</span>
<a id="__codelineno-1-82" name="__codelineno-1-82" href="#__codelineno-1-82"></a>                    <span class="p">)</span>
<a id="__codelineno-1-83" name="__codelineno-1-83" href="#__codelineno-1-83"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">-</span> <span class="n">param</span><span class="o">.</span><span class="n">min_value</span><span class="p">)</span> <span class="o">%</span> <span class="n">param</span><span class="o">.</span><span class="n">step</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-1-84" name="__codelineno-1-84" href="#__codelineno-1-84"></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-1-85" name="__codelineno-1-85" href="#__codelineno-1-85"></a>                        <span class="sa">f</span><span class="s2">&quot;Parameter &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; value </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2"> does not match step </span><span class="si">{</span><span class="n">param</span><span class="o">.</span><span class="n">step</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-1-86" name="__codelineno-1-86" href="#__codelineno-1-86"></a>                    <span class="p">)</span>
<a id="__codelineno-1-87" name="__codelineno-1-87" href="#__codelineno-1-87"></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">CategoricalParameter</span><span class="p">):</span>
<a id="__codelineno-1-88" name="__codelineno-1-88" href="#__codelineno-1-88"></a>                <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">param</span><span class="o">.</span><span class="n">choices</span><span class="p">:</span>
<a id="__codelineno-1-89" name="__codelineno-1-89" href="#__codelineno-1-89"></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-1-90" name="__codelineno-1-90" href="#__codelineno-1-90"></a>                        <span class="sa">f</span><span class="s2">&quot;Parameter &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; value </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2"> not in choices </span><span class="si">{</span><span class="n">param</span><span class="o">.</span><span class="n">choices</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-1-91" name="__codelineno-1-91" href="#__codelineno-1-91"></a>                    <span class="p">)</span>
<a id="__codelineno-1-92" name="__codelineno-1-92" href="#__codelineno-1-92"></a>
<a id="__codelineno-1-93" name="__codelineno-1-93" href="#__codelineno-1-93"></a>        <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-1-94" name="__codelineno-1-94" href="#__codelineno-1-94"></a>
<a id="__codelineno-1-95" name="__codelineno-1-95" href="#__codelineno-1-95"></a>    <span class="k">def</span> <span class="nf">cardinality</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-1-96" name="__codelineno-1-96" href="#__codelineno-1-96"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate total number of possible parameter combinations.&quot;&quot;&quot;</span>
<a id="__codelineno-1-97" name="__codelineno-1-97" href="#__codelineno-1-97"></a>        <span class="n">total</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-1-98" name="__codelineno-1-98" href="#__codelineno-1-98"></a>        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
<a id="__codelineno-1-99" name="__codelineno-1-99" href="#__codelineno-1-99"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">ContinuousParameter</span><span class="p">):</span>
<a id="__codelineno-1-100" name="__codelineno-1-100" href="#__codelineno-1-100"></a>                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>  <span class="c1"># Infinite for continuous spaces</span>
<a id="__codelineno-1-101" name="__codelineno-1-101" href="#__codelineno-1-101"></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">DiscreteParameter</span><span class="p">):</span>
<a id="__codelineno-1-102" name="__codelineno-1-102" href="#__codelineno-1-102"></a>                <span class="n">total</span> <span class="o">*=</span> <span class="p">((</span><span class="n">param</span><span class="o">.</span><span class="n">max_value</span> <span class="o">-</span> <span class="n">param</span><span class="o">.</span><span class="n">min_value</span><span class="p">)</span> <span class="o">//</span> <span class="n">param</span><span class="o">.</span><span class="n">step</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-1-103" name="__codelineno-1-103" href="#__codelineno-1-103"></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">CategoricalParameter</span><span class="p">):</span>
<a id="__codelineno-1-104" name="__codelineno-1-104" href="#__codelineno-1-104"></a>                <span class="n">total</span> <span class="o">*=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">choices</span><span class="p">)</span>
<a id="__codelineno-1-105" name="__codelineno-1-105" href="#__codelineno-1-105"></a>        <span class="k">return</span> <span class="n">total</span>
</code></pre></div></p>
<p><strong>Design Decisions</strong>:
- Uses pydantic for validation and type safety
- Supports three parameter types covering all common use cases
- Validates bounds, steps, uniqueness at construction time
- Provides cardinality calculation for finite spaces (used by GridSearch)
- Prior distribution support for Bayesian methods (uniform vs log-uniform)</p>
<h3 id="2-searchalgorithm-abstract-base-class">2. SearchAlgorithm Abstract Base Class<a class="headerlink" href="#2-searchalgorithm-abstract-base-class" title="Permanent link">&para;</a></h3>
<p><strong>Purpose</strong>: Define interface contract for all search algorithms</p>
<p><strong>Interface</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="k">class</span> <span class="nc">SearchAlgorithm</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Abstract base class for parameter search algorithms.&quot;&quot;&quot;</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameter_space</span><span class="p">:</span> <span class="n">ParameterSpace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize search algorithm with parameter space.&quot;&quot;&quot;</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">parameter_space</span> <span class="o">=</span> <span class="n">parameter_space</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_initialized</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>    <span class="k">def</span> <span class="nf">suggest</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Suggest next parameter configuration to evaluate.</span>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="sd">        Returns:</span>
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a><span class="sd">            Dictionary mapping parameter names to values.</span>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a><span class="sd">        Raises:</span>
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a><span class="sd">            ValueError: If algorithm not initialized or optimization complete.</span>
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a>        <span class="k">pass</span>
<a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a>
<a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">score</span><span class="p">:</span> <span class="n">Decimal</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Update algorithm with evaluation result.</span>
<a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a>
<a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a><span class="sd">        Args:</span>
<a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a><span class="sd">            params: Parameter configuration that was evaluated</span>
<a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a><span class="sd">            score: Objective function score (higher is better)</span>
<a id="__codelineno-2-33" name="__codelineno-2-33" href="#__codelineno-2-33"></a>
<a id="__codelineno-2-34" name="__codelineno-2-34" href="#__codelineno-2-34"></a><span class="sd">        Raises:</span>
<a id="__codelineno-2-35" name="__codelineno-2-35" href="#__codelineno-2-35"></a><span class="sd">            ValueError: If params don&#39;t match suggested parameters.</span>
<a id="__codelineno-2-36" name="__codelineno-2-36" href="#__codelineno-2-36"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-2-37" name="__codelineno-2-37" href="#__codelineno-2-37"></a>        <span class="k">pass</span>
<a id="__codelineno-2-38" name="__codelineno-2-38" href="#__codelineno-2-38"></a>
<a id="__codelineno-2-39" name="__codelineno-2-39" href="#__codelineno-2-39"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-2-40" name="__codelineno-2-40" href="#__codelineno-2-40"></a>    <span class="k">def</span> <span class="nf">is_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-2-41" name="__codelineno-2-41" href="#__codelineno-2-41"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if optimization should terminate.</span>
<a id="__codelineno-2-42" name="__codelineno-2-42" href="#__codelineno-2-42"></a>
<a id="__codelineno-2-43" name="__codelineno-2-43" href="#__codelineno-2-43"></a><span class="sd">        Returns:</span>
<a id="__codelineno-2-44" name="__codelineno-2-44" href="#__codelineno-2-44"></a><span class="sd">            True if optimization is complete, False otherwise.</span>
<a id="__codelineno-2-45" name="__codelineno-2-45" href="#__codelineno-2-45"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-2-46" name="__codelineno-2-46" href="#__codelineno-2-46"></a>        <span class="k">pass</span>
<a id="__codelineno-2-47" name="__codelineno-2-47" href="#__codelineno-2-47"></a>
<a id="__codelineno-2-48" name="__codelineno-2-48" href="#__codelineno-2-48"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-2-49" name="__codelineno-2-49" href="#__codelineno-2-49"></a>    <span class="k">def</span> <span class="nf">get_state</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-2-50" name="__codelineno-2-50" href="#__codelineno-2-50"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get serializable algorithm state for checkpointing.</span>
<a id="__codelineno-2-51" name="__codelineno-2-51" href="#__codelineno-2-51"></a>
<a id="__codelineno-2-52" name="__codelineno-2-52" href="#__codelineno-2-52"></a><span class="sd">        Returns:</span>
<a id="__codelineno-2-53" name="__codelineno-2-53" href="#__codelineno-2-53"></a><span class="sd">            Dictionary containing all state needed to resume optimization.</span>
<a id="__codelineno-2-54" name="__codelineno-2-54" href="#__codelineno-2-54"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-2-55" name="__codelineno-2-55" href="#__codelineno-2-55"></a>        <span class="k">pass</span>
<a id="__codelineno-2-56" name="__codelineno-2-56" href="#__codelineno-2-56"></a>
<a id="__codelineno-2-57" name="__codelineno-2-57" href="#__codelineno-2-57"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-2-58" name="__codelineno-2-58" href="#__codelineno-2-58"></a>    <span class="k">def</span> <span class="nf">set_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-2-59" name="__codelineno-2-59" href="#__codelineno-2-59"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Restore algorithm state from checkpoint.</span>
<a id="__codelineno-2-60" name="__codelineno-2-60" href="#__codelineno-2-60"></a>
<a id="__codelineno-2-61" name="__codelineno-2-61" href="#__codelineno-2-61"></a><span class="sd">        Args:</span>
<a id="__codelineno-2-62" name="__codelineno-2-62" href="#__codelineno-2-62"></a><span class="sd">            state: State dictionary from previous get_state() call.</span>
<a id="__codelineno-2-63" name="__codelineno-2-63" href="#__codelineno-2-63"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-2-64" name="__codelineno-2-64" href="#__codelineno-2-64"></a>        <span class="k">pass</span>
<a id="__codelineno-2-65" name="__codelineno-2-65" href="#__codelineno-2-65"></a>
<a id="__codelineno-2-66" name="__codelineno-2-66" href="#__codelineno-2-66"></a>    <span class="nd">@property</span>
<a id="__codelineno-2-67" name="__codelineno-2-67" href="#__codelineno-2-67"></a>    <span class="k">def</span> <span class="nf">iteration</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-2-68" name="__codelineno-2-68" href="#__codelineno-2-68"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get current iteration number.&quot;&quot;&quot;</span>
<a id="__codelineno-2-69" name="__codelineno-2-69" href="#__codelineno-2-69"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span>
<a id="__codelineno-2-70" name="__codelineno-2-70" href="#__codelineno-2-70"></a>
<a id="__codelineno-2-71" name="__codelineno-2-71" href="#__codelineno-2-71"></a>    <span class="k">def</span> <span class="nf">validate_suggested_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-2-72" name="__codelineno-2-72" href="#__codelineno-2-72"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate suggested parameters against parameter space.&quot;&quot;&quot;</span>
<a id="__codelineno-2-73" name="__codelineno-2-73" href="#__codelineno-2-73"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">parameter_space</span><span class="o">.</span><span class="n">validate_params</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
</code></pre></div></p>
<p><strong>Design Decisions</strong>:
- Required methods: <code>suggest</code>, <code>update</code>, <code>is_complete</code> (minimal interface)
- State management: <code>get_state</code>, <code>set_state</code> (for checkpoint/resume)
- Each algorithm maintains its own state (population, history, models)
- <code>suggest</code> returns params; <code>update</code> receives score (ask-and-tell pattern)
- <code>is_complete</code> allows algorithms to define termination criteria
- Base class provides parameter validation helper</p>
<h3 id="3-objectivefunction">3. ObjectiveFunction<a class="headerlink" href="#3-objectivefunction" title="Permanent link">&para;</a></h3>
<p><strong>Purpose</strong>: Extract optimization metric from backtest results</p>
<p><strong>Interface</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">Callable</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="kn">import</span> <span class="nn">polars</span> <span class="k">as</span> <span class="nn">pl</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="n">ObjectiveMetric</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>    <span class="s2">&quot;sharpe_ratio&quot;</span><span class="p">,</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>    <span class="s2">&quot;sortino_ratio&quot;</span><span class="p">,</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>    <span class="s2">&quot;calmar_ratio&quot;</span><span class="p">,</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>    <span class="s2">&quot;total_return&quot;</span><span class="p">,</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>    <span class="s2">&quot;max_drawdown&quot;</span><span class="p">,</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>    <span class="s2">&quot;win_rate&quot;</span><span class="p">,</span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>    <span class="s2">&quot;profit_factor&quot;</span><span class="p">,</span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>    <span class="s2">&quot;custom&quot;</span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="p">]</span>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="k">class</span> <span class="nc">ObjectiveFunction</span><span class="p">:</span>
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract objective metric from backtest results.&quot;&quot;&quot;</span>
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a>
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a>        <span class="n">metric</span><span class="p">:</span> <span class="n">ObjectiveMetric</span><span class="p">,</span>
<a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a>        <span class="n">custom_function</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">Dict</span><span class="p">],</span> <span class="n">Decimal</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a>        <span class="n">higher_is_better</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a>    <span class="p">):</span>
<a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize objective function.</span>
<a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a>
<a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a><span class="sd">        Args:</span>
<a id="__codelineno-3-28" name="__codelineno-3-28" href="#__codelineno-3-28"></a><span class="sd">            metric: Standard metric name or &quot;custom&quot;</span>
<a id="__codelineno-3-29" name="__codelineno-3-29" href="#__codelineno-3-29"></a><span class="sd">            custom_function: Custom metric extraction function (required if metric=&quot;custom&quot;)</span>
<a id="__codelineno-3-30" name="__codelineno-3-30" href="#__codelineno-3-30"></a><span class="sd">            higher_is_better: Whether higher scores are better (for optimization direction)</span>
<a id="__codelineno-3-31" name="__codelineno-3-31" href="#__codelineno-3-31"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-3-32" name="__codelineno-3-32" href="#__codelineno-3-32"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">metric</span> <span class="o">=</span> <span class="n">metric</span>
<a id="__codelineno-3-33" name="__codelineno-3-33" href="#__codelineno-3-33"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">custom_function</span> <span class="o">=</span> <span class="n">custom_function</span>
<a id="__codelineno-3-34" name="__codelineno-3-34" href="#__codelineno-3-34"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">higher_is_better</span> <span class="o">=</span> <span class="n">higher_is_better</span>
<a id="__codelineno-3-35" name="__codelineno-3-35" href="#__codelineno-3-35"></a>
<a id="__codelineno-3-36" name="__codelineno-3-36" href="#__codelineno-3-36"></a>        <span class="k">if</span> <span class="n">metric</span> <span class="o">==</span> <span class="s2">&quot;custom&quot;</span> <span class="ow">and</span> <span class="n">custom_function</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-3-37" name="__codelineno-3-37" href="#__codelineno-3-37"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;custom_function required when metric=&#39;custom&#39;&quot;</span><span class="p">)</span>
<a id="__codelineno-3-38" name="__codelineno-3-38" href="#__codelineno-3-38"></a>
<a id="__codelineno-3-39" name="__codelineno-3-39" href="#__codelineno-3-39"></a>        <span class="k">if</span> <span class="n">metric</span> <span class="o">!=</span> <span class="s2">&quot;custom&quot;</span> <span class="ow">and</span> <span class="n">custom_function</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-3-40" name="__codelineno-3-40" href="#__codelineno-3-40"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;custom_function only valid when metric=&#39;custom&#39;&quot;</span><span class="p">)</span>
<a id="__codelineno-3-41" name="__codelineno-3-41" href="#__codelineno-3-41"></a>
<a id="__codelineno-3-42" name="__codelineno-3-42" href="#__codelineno-3-42"></a>    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backtest_result</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Decimal</span><span class="p">:</span>
<a id="__codelineno-3-43" name="__codelineno-3-43" href="#__codelineno-3-43"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract objective metric from backtest result.</span>
<a id="__codelineno-3-44" name="__codelineno-3-44" href="#__codelineno-3-44"></a>
<a id="__codelineno-3-45" name="__codelineno-3-45" href="#__codelineno-3-45"></a><span class="sd">        Args:</span>
<a id="__codelineno-3-46" name="__codelineno-3-46" href="#__codelineno-3-46"></a><span class="sd">            backtest_result: Dictionary containing backtest performance metrics</span>
<a id="__codelineno-3-47" name="__codelineno-3-47" href="#__codelineno-3-47"></a>
<a id="__codelineno-3-48" name="__codelineno-3-48" href="#__codelineno-3-48"></a><span class="sd">        Returns:</span>
<a id="__codelineno-3-49" name="__codelineno-3-49" href="#__codelineno-3-49"></a><span class="sd">            Objective score as Decimal (higher is better if higher_is_better=True)</span>
<a id="__codelineno-3-50" name="__codelineno-3-50" href="#__codelineno-3-50"></a>
<a id="__codelineno-3-51" name="__codelineno-3-51" href="#__codelineno-3-51"></a><span class="sd">        Raises:</span>
<a id="__codelineno-3-52" name="__codelineno-3-52" href="#__codelineno-3-52"></a><span class="sd">            KeyError: If required metric not in backtest results</span>
<a id="__codelineno-3-53" name="__codelineno-3-53" href="#__codelineno-3-53"></a><span class="sd">            ValueError: If metric calculation fails</span>
<a id="__codelineno-3-54" name="__codelineno-3-54" href="#__codelineno-3-54"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-3-55" name="__codelineno-3-55" href="#__codelineno-3-55"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metric</span> <span class="o">==</span> <span class="s2">&quot;custom&quot;</span><span class="p">:</span>
<a id="__codelineno-3-56" name="__codelineno-3-56" href="#__codelineno-3-56"></a>            <span class="c1"># Custom function receives full backtest result</span>
<a id="__codelineno-3-57" name="__codelineno-3-57" href="#__codelineno-3-57"></a>            <span class="n">portfolio_value</span> <span class="o">=</span> <span class="n">backtest_result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;portfolio_value&quot;</span><span class="p">)</span>
<a id="__codelineno-3-58" name="__codelineno-3-58" href="#__codelineno-3-58"></a>            <span class="n">trades</span> <span class="o">=</span> <span class="n">backtest_result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;trades&quot;</span><span class="p">)</span>
<a id="__codelineno-3-59" name="__codelineno-3-59" href="#__codelineno-3-59"></a>            <span class="n">score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_function</span><span class="p">(</span><span class="n">portfolio_value</span><span class="p">,</span> <span class="n">trades</span><span class="p">)</span>
<a id="__codelineno-3-60" name="__codelineno-3-60" href="#__codelineno-3-60"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-3-61" name="__codelineno-3-61" href="#__codelineno-3-61"></a>            <span class="c1"># Extract standard metric from backtest results</span>
<a id="__codelineno-3-62" name="__codelineno-3-62" href="#__codelineno-3-62"></a>            <span class="n">metrics</span> <span class="o">=</span> <span class="n">backtest_result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;performance_metrics&quot;</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-3-63" name="__codelineno-3-63" href="#__codelineno-3-63"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metric</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metrics</span><span class="p">:</span>
<a id="__codelineno-3-64" name="__codelineno-3-64" href="#__codelineno-3-64"></a>                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Metric &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metric</span><span class="si">}</span><span class="s2">&#39; not in backtest results&quot;</span><span class="p">)</span>
<a id="__codelineno-3-65" name="__codelineno-3-65" href="#__codelineno-3-65"></a>
<a id="__codelineno-3-66" name="__codelineno-3-66" href="#__codelineno-3-66"></a>            <span class="n">score</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">metrics</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">metric</span><span class="p">]))</span>
<a id="__codelineno-3-67" name="__codelineno-3-67" href="#__codelineno-3-67"></a>
<a id="__codelineno-3-68" name="__codelineno-3-68" href="#__codelineno-3-68"></a>        <span class="c1"># Invert score if lower is better</span>
<a id="__codelineno-3-69" name="__codelineno-3-69" href="#__codelineno-3-69"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">higher_is_better</span><span class="p">:</span>
<a id="__codelineno-3-70" name="__codelineno-3-70" href="#__codelineno-3-70"></a>            <span class="n">score</span> <span class="o">=</span> <span class="o">-</span><span class="n">score</span>
<a id="__codelineno-3-71" name="__codelineno-3-71" href="#__codelineno-3-71"></a>
<a id="__codelineno-3-72" name="__codelineno-3-72" href="#__codelineno-3-72"></a>        <span class="k">return</span> <span class="n">score</span>
<a id="__codelineno-3-73" name="__codelineno-3-73" href="#__codelineno-3-73"></a>
<a id="__codelineno-3-74" name="__codelineno-3-74" href="#__codelineno-3-74"></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-3-75" name="__codelineno-3-75" href="#__codelineno-3-75"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;ObjectiveFunction(metric=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metric</span><span class="si">}</span><span class="s2">, higher_is_better=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">higher_is_better</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div></p>
<p><strong>Design Decisions</strong>:
- Supports common financial metrics out-of-box
- Allows custom metric functions for specialized needs
- Handles optimization direction (maximize vs minimize)
- Returns Decimal for precision consistency
- Validates backtest results contain required metric</p>
<h3 id="4-optimizationresult">4. OptimizationResult<a class="headerlink" href="#4-optimizationresult" title="Permanent link">&para;</a></h3>
<p><strong>Purpose</strong>: Store single parameter evaluation result</p>
<p><strong>Interface</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="k">class</span> <span class="nc">OptimizationResult</span><span class="p">:</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Single optimization trial result.&quot;&quot;&quot;</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>    <span class="n">trial_id</span><span class="p">:</span> <span class="nb">int</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>    <span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>    <span class="n">score</span><span class="p">:</span> <span class="n">Decimal</span>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>    <span class="n">timestamp</span><span class="p">:</span> <span class="n">datetime</span>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>    <span class="n">backtest_metrics</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>    <span class="n">error</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>    <span class="n">duration_seconds</span><span class="p">:</span> <span class="n">Decimal</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)</span>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate result after initialization.&quot;&quot;&quot;</span>
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">score</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">):</span>
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a>            <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">score</span><span class="p">)))</span>
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">duration_seconds</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">):</span>
<a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a>            <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;duration_seconds&#39;</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">duration_seconds</span><span class="p">)))</span>
<a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a>
<a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">!=</span> <span class="n">Decimal</span><span class="p">(</span><span class="s2">&quot;-Infinity&quot;</span><span class="p">):</span>
<a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Failed trials must have score=-Infinity&quot;</span><span class="p">)</span>
<a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a>
<a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a>    <span class="nd">@property</span>
<a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a>    <span class="k">def</span> <span class="nf">is_success</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if trial succeeded.&quot;&quot;&quot;</span>
<a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="kc">None</span>
<a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a>
<a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a>    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert to dictionary for serialization.&quot;&quot;&quot;</span>
<a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a>        <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a>            <span class="s2">&quot;trial_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial_id</span><span class="p">,</span>
<a id="__codelineno-4-37" name="__codelineno-4-37" href="#__codelineno-4-37"></a>            <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span>
<a id="__codelineno-4-38" name="__codelineno-4-38" href="#__codelineno-4-38"></a>            <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">score</span><span class="p">),</span>
<a id="__codelineno-4-39" name="__codelineno-4-39" href="#__codelineno-4-39"></a>            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
<a id="__codelineno-4-40" name="__codelineno-4-40" href="#__codelineno-4-40"></a>            <span class="s2">&quot;backtest_metrics&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">backtest_metrics</span><span class="p">,</span>
<a id="__codelineno-4-41" name="__codelineno-4-41" href="#__codelineno-4-41"></a>            <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">,</span>
<a id="__codelineno-4-42" name="__codelineno-4-42" href="#__codelineno-4-42"></a>            <span class="s2">&quot;duration_seconds&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">duration_seconds</span><span class="p">)</span>
<a id="__codelineno-4-43" name="__codelineno-4-43" href="#__codelineno-4-43"></a>        <span class="p">}</span>
<a id="__codelineno-4-44" name="__codelineno-4-44" href="#__codelineno-4-44"></a>
<a id="__codelineno-4-45" name="__codelineno-4-45" href="#__codelineno-4-45"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-4-46" name="__codelineno-4-46" href="#__codelineno-4-46"></a>    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;OptimizationResult&quot;</span><span class="p">:</span>
<a id="__codelineno-4-47" name="__codelineno-4-47" href="#__codelineno-4-47"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create from dictionary.&quot;&quot;&quot;</span>
<a id="__codelineno-4-48" name="__codelineno-4-48" href="#__codelineno-4-48"></a>        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
<a id="__codelineno-4-49" name="__codelineno-4-49" href="#__codelineno-4-49"></a>            <span class="n">trial_id</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;trial_id&quot;</span><span class="p">],</span>
<a id="__codelineno-4-50" name="__codelineno-4-50" href="#__codelineno-4-50"></a>            <span class="n">params</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">],</span>
<a id="__codelineno-4-51" name="__codelineno-4-51" href="#__codelineno-4-51"></a>            <span class="n">score</span><span class="o">=</span><span class="n">Decimal</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">]),</span>
<a id="__codelineno-4-52" name="__codelineno-4-52" href="#__codelineno-4-52"></a>            <span class="n">timestamp</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]),</span>
<a id="__codelineno-4-53" name="__codelineno-4-53" href="#__codelineno-4-53"></a>            <span class="n">backtest_metrics</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;backtest_metrics&quot;</span><span class="p">],</span>
<a id="__codelineno-4-54" name="__codelineno-4-54" href="#__codelineno-4-54"></a>            <span class="n">error</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">),</span>
<a id="__codelineno-4-55" name="__codelineno-4-55" href="#__codelineno-4-55"></a>            <span class="n">duration_seconds</span><span class="o">=</span><span class="n">Decimal</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;duration_seconds&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">))</span>
<a id="__codelineno-4-56" name="__codelineno-4-56" href="#__codelineno-4-56"></a>        <span class="p">)</span>
</code></pre></div></p>
<p><strong>Design Decisions</strong>:
- Immutable dataclass (frozen=True) prevents accidental modification
- Stores complete trial information (params, score, metrics, timing)
- Tracks failures with error message and -Infinity score
- Provides serialization for persistence
- Uses Decimal for all numeric values</p>
<h3 id="5-optimizer-orchestrator">5. Optimizer Orchestrator<a class="headerlink" href="#5-optimizer-orchestrator" title="Permanent link">&para;</a></h3>
<p><strong>Purpose</strong>: Coordinate optimization loop, manage state, handle persistence</p>
<p><strong>Interface</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">List</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="kn">import</span> <span class="nn">json</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="kn">import</span> <span class="nn">structlog</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="n">logger</span> <span class="o">=</span> <span class="n">structlog</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="k">class</span> <span class="nc">Optimizer</span><span class="p">:</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Main optimizer orchestrator coordinating search and execution.&quot;&quot;&quot;</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>        <span class="n">parameter_space</span><span class="p">:</span> <span class="n">ParameterSpace</span><span class="p">,</span>
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>        <span class="n">search_algorithm</span><span class="p">:</span> <span class="n">SearchAlgorithm</span><span class="p">,</span>
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a>        <span class="n">objective_function</span><span class="p">:</span> <span class="n">ObjectiveFunction</span><span class="p">,</span>
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a>        <span class="n">backtest_function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a>        <span class="n">max_trials</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a>        <span class="n">checkpoint_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a>        <span class="n">checkpoint_frequency</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
<a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a>        <span class="n">parallel_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a>        <span class="n">use_ray</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a>    <span class="p">):</span>
<a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize optimizer.</span>
<a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a>
<a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a><span class="sd">        Args:</span>
<a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a><span class="sd">            parameter_space: Parameter search space</span>
<a id="__codelineno-5-29" name="__codelineno-5-29" href="#__codelineno-5-29"></a><span class="sd">            search_algorithm: Algorithm to use for parameter search</span>
<a id="__codelineno-5-30" name="__codelineno-5-30" href="#__codelineno-5-30"></a><span class="sd">            objective_function: Metric extraction from backtest results</span>
<a id="__codelineno-5-31" name="__codelineno-5-31" href="#__codelineno-5-31"></a><span class="sd">            backtest_function: Function that runs backtest given parameters</span>
<a id="__codelineno-5-32" name="__codelineno-5-32" href="#__codelineno-5-32"></a><span class="sd">            max_trials: Maximum number of trials to run</span>
<a id="__codelineno-5-33" name="__codelineno-5-33" href="#__codelineno-5-33"></a><span class="sd">            checkpoint_dir: Directory for checkpoint files (None disables checkpointing)</span>
<a id="__codelineno-5-34" name="__codelineno-5-34" href="#__codelineno-5-34"></a><span class="sd">            checkpoint_frequency: Save checkpoint every N trials</span>
<a id="__codelineno-5-35" name="__codelineno-5-35" href="#__codelineno-5-35"></a><span class="sd">            parallel_workers: Number of parallel workers (1 = sequential)</span>
<a id="__codelineno-5-36" name="__codelineno-5-36" href="#__codelineno-5-36"></a><span class="sd">            use_ray: Use Ray for distributed execution (vs multiprocessing)</span>
<a id="__codelineno-5-37" name="__codelineno-5-37" href="#__codelineno-5-37"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-5-38" name="__codelineno-5-38" href="#__codelineno-5-38"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">parameter_space</span> <span class="o">=</span> <span class="n">parameter_space</span>
<a id="__codelineno-5-39" name="__codelineno-5-39" href="#__codelineno-5-39"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">search_algorithm</span> <span class="o">=</span> <span class="n">search_algorithm</span>
<a id="__codelineno-5-40" name="__codelineno-5-40" href="#__codelineno-5-40"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">objective_function</span> <span class="o">=</span> <span class="n">objective_function</span>
<a id="__codelineno-5-41" name="__codelineno-5-41" href="#__codelineno-5-41"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">backtest_function</span> <span class="o">=</span> <span class="n">backtest_function</span>
<a id="__codelineno-5-42" name="__codelineno-5-42" href="#__codelineno-5-42"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_trials</span> <span class="o">=</span> <span class="n">max_trials</span>
<a id="__codelineno-5-43" name="__codelineno-5-43" href="#__codelineno-5-43"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">checkpoint_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">checkpoint_dir</span><span class="p">)</span> <span class="k">if</span> <span class="n">checkpoint_dir</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-5-44" name="__codelineno-5-44" href="#__codelineno-5-44"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">checkpoint_frequency</span> <span class="o">=</span> <span class="n">checkpoint_frequency</span>
<a id="__codelineno-5-45" name="__codelineno-5-45" href="#__codelineno-5-45"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">parallel_workers</span> <span class="o">=</span> <span class="n">parallel_workers</span>
<a id="__codelineno-5-46" name="__codelineno-5-46" href="#__codelineno-5-46"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">use_ray</span> <span class="o">=</span> <span class="n">use_ray</span>
<a id="__codelineno-5-47" name="__codelineno-5-47" href="#__codelineno-5-47"></a>
<a id="__codelineno-5-48" name="__codelineno-5-48" href="#__codelineno-5-48"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">OptimizationResult</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-5-49" name="__codelineno-5-49" href="#__codelineno-5-49"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">best_result</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">OptimizationResult</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-5-50" name="__codelineno-5-50" href="#__codelineno-5-50"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">current_trial</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-5-51" name="__codelineno-5-51" href="#__codelineno-5-51"></a>
<a id="__codelineno-5-52" name="__codelineno-5-52" href="#__codelineno-5-52"></a>        <span class="c1"># Create checkpoint directory if needed</span>
<a id="__codelineno-5-53" name="__codelineno-5-53" href="#__codelineno-5-53"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkpoint_dir</span><span class="p">:</span>
<a id="__codelineno-5-54" name="__codelineno-5-54" href="#__codelineno-5-54"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">checkpoint_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-5-55" name="__codelineno-5-55" href="#__codelineno-5-55"></a>
<a id="__codelineno-5-56" name="__codelineno-5-56" href="#__codelineno-5-56"></a>    <span class="k">def</span> <span class="nf">optimize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OptimizationResult</span><span class="p">:</span>
<a id="__codelineno-5-57" name="__codelineno-5-57" href="#__codelineno-5-57"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Run optimization loop.</span>
<a id="__codelineno-5-58" name="__codelineno-5-58" href="#__codelineno-5-58"></a>
<a id="__codelineno-5-59" name="__codelineno-5-59" href="#__codelineno-5-59"></a><span class="sd">        Returns:</span>
<a id="__codelineno-5-60" name="__codelineno-5-60" href="#__codelineno-5-60"></a><span class="sd">            Best optimization result found.</span>
<a id="__codelineno-5-61" name="__codelineno-5-61" href="#__codelineno-5-61"></a>
<a id="__codelineno-5-62" name="__codelineno-5-62" href="#__codelineno-5-62"></a><span class="sd">        Raises:</span>
<a id="__codelineno-5-63" name="__codelineno-5-63" href="#__codelineno-5-63"></a><span class="sd">            ValueError: If optimization fails completely.</span>
<a id="__codelineno-5-64" name="__codelineno-5-64" href="#__codelineno-5-64"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-5-65" name="__codelineno-5-65" href="#__codelineno-5-65"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-5-66" name="__codelineno-5-66" href="#__codelineno-5-66"></a>            <span class="s2">&quot;optimization_started&quot;</span><span class="p">,</span>
<a id="__codelineno-5-67" name="__codelineno-5-67" href="#__codelineno-5-67"></a>            <span class="n">max_trials</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_trials</span><span class="p">,</span>
<a id="__codelineno-5-68" name="__codelineno-5-68" href="#__codelineno-5-68"></a>            <span class="n">parallel_workers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parallel_workers</span><span class="p">,</span>
<a id="__codelineno-5-69" name="__codelineno-5-69" href="#__codelineno-5-69"></a>            <span class="n">algorithm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">search_algorithm</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
<a id="__codelineno-5-70" name="__codelineno-5-70" href="#__codelineno-5-70"></a>        <span class="p">)</span>
<a id="__codelineno-5-71" name="__codelineno-5-71" href="#__codelineno-5-71"></a>
<a id="__codelineno-5-72" name="__codelineno-5-72" href="#__codelineno-5-72"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-5-73" name="__codelineno-5-73" href="#__codelineno-5-73"></a>            <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_should_stop</span><span class="p">():</span>
<a id="__codelineno-5-74" name="__codelineno-5-74" href="#__codelineno-5-74"></a>                <span class="c1"># Ask search algorithm for next parameters</span>
<a id="__codelineno-5-75" name="__codelineno-5-75" href="#__codelineno-5-75"></a>                <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_algorithm</span><span class="o">.</span><span class="n">suggest</span><span class="p">()</span>
<a id="__codelineno-5-76" name="__codelineno-5-76" href="#__codelineno-5-76"></a>
<a id="__codelineno-5-77" name="__codelineno-5-77" href="#__codelineno-5-77"></a>                <span class="c1"># Validate parameters</span>
<a id="__codelineno-5-78" name="__codelineno-5-78" href="#__codelineno-5-78"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">parameter_space</span><span class="o">.</span><span class="n">validate_params</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<a id="__codelineno-5-79" name="__codelineno-5-79" href="#__codelineno-5-79"></a>
<a id="__codelineno-5-80" name="__codelineno-5-80" href="#__codelineno-5-80"></a>                <span class="c1"># Run backtest with parameters</span>
<a id="__codelineno-5-81" name="__codelineno-5-81" href="#__codelineno-5-81"></a>                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_params</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<a id="__codelineno-5-82" name="__codelineno-5-82" href="#__codelineno-5-82"></a>
<a id="__codelineno-5-83" name="__codelineno-5-83" href="#__codelineno-5-83"></a>                <span class="c1"># Tell search algorithm the result</span>
<a id="__codelineno-5-84" name="__codelineno-5-84" href="#__codelineno-5-84"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">search_algorithm</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">score</span><span class="p">)</span>
<a id="__codelineno-5-85" name="__codelineno-5-85" href="#__codelineno-5-85"></a>
<a id="__codelineno-5-86" name="__codelineno-5-86" href="#__codelineno-5-86"></a>                <span class="c1"># Store result</span>
<a id="__codelineno-5-87" name="__codelineno-5-87" href="#__codelineno-5-87"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-5-88" name="__codelineno-5-88" href="#__codelineno-5-88"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">current_trial</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-5-89" name="__codelineno-5-89" href="#__codelineno-5-89"></a>
<a id="__codelineno-5-90" name="__codelineno-5-90" href="#__codelineno-5-90"></a>                <span class="c1"># Update best result</span>
<a id="__codelineno-5-91" name="__codelineno-5-91" href="#__codelineno-5-91"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_result</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">result</span><span class="o">.</span><span class="n">score</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_result</span><span class="o">.</span><span class="n">score</span><span class="p">:</span>
<a id="__codelineno-5-92" name="__codelineno-5-92" href="#__codelineno-5-92"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">best_result</span> <span class="o">=</span> <span class="n">result</span>
<a id="__codelineno-5-93" name="__codelineno-5-93" href="#__codelineno-5-93"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-5-94" name="__codelineno-5-94" href="#__codelineno-5-94"></a>                        <span class="s2">&quot;new_best_result&quot;</span><span class="p">,</span>
<a id="__codelineno-5-95" name="__codelineno-5-95" href="#__codelineno-5-95"></a>                        <span class="n">trial</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_trial</span><span class="p">,</span>
<a id="__codelineno-5-96" name="__codelineno-5-96" href="#__codelineno-5-96"></a>                        <span class="n">score</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">score</span><span class="p">),</span>
<a id="__codelineno-5-97" name="__codelineno-5-97" href="#__codelineno-5-97"></a>                        <span class="n">params</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">params</span>
<a id="__codelineno-5-98" name="__codelineno-5-98" href="#__codelineno-5-98"></a>                    <span class="p">)</span>
<a id="__codelineno-5-99" name="__codelineno-5-99" href="#__codelineno-5-99"></a>
<a id="__codelineno-5-100" name="__codelineno-5-100" href="#__codelineno-5-100"></a>                <span class="c1"># Checkpoint if needed</span>
<a id="__codelineno-5-101" name="__codelineno-5-101" href="#__codelineno-5-101"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_should_checkpoint</span><span class="p">():</span>
<a id="__codelineno-5-102" name="__codelineno-5-102" href="#__codelineno-5-102"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_save_checkpoint</span><span class="p">()</span>
<a id="__codelineno-5-103" name="__codelineno-5-103" href="#__codelineno-5-103"></a>
<a id="__codelineno-5-104" name="__codelineno-5-104" href="#__codelineno-5-104"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-5-105" name="__codelineno-5-105" href="#__codelineno-5-105"></a>                <span class="s2">&quot;optimization_completed&quot;</span><span class="p">,</span>
<a id="__codelineno-5-106" name="__codelineno-5-106" href="#__codelineno-5-106"></a>                <span class="n">total_trials</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_trial</span><span class="p">,</span>
<a id="__codelineno-5-107" name="__codelineno-5-107" href="#__codelineno-5-107"></a>                <span class="n">best_score</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">best_result</span><span class="o">.</span><span class="n">score</span><span class="p">),</span>
<a id="__codelineno-5-108" name="__codelineno-5-108" href="#__codelineno-5-108"></a>                <span class="n">best_params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">best_result</span><span class="o">.</span><span class="n">params</span>
<a id="__codelineno-5-109" name="__codelineno-5-109" href="#__codelineno-5-109"></a>            <span class="p">)</span>
<a id="__codelineno-5-110" name="__codelineno-5-110" href="#__codelineno-5-110"></a>
<a id="__codelineno-5-111" name="__codelineno-5-111" href="#__codelineno-5-111"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_result</span>
<a id="__codelineno-5-112" name="__codelineno-5-112" href="#__codelineno-5-112"></a>
<a id="__codelineno-5-113" name="__codelineno-5-113" href="#__codelineno-5-113"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-5-114" name="__codelineno-5-114" href="#__codelineno-5-114"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;optimization_failed&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
<a id="__codelineno-5-115" name="__codelineno-5-115" href="#__codelineno-5-115"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkpoint_dir</span><span class="p">:</span>
<a id="__codelineno-5-116" name="__codelineno-5-116" href="#__codelineno-5-116"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_save_checkpoint</span><span class="p">()</span>  <span class="c1"># Save progress before failing</span>
<a id="__codelineno-5-117" name="__codelineno-5-117" href="#__codelineno-5-117"></a>            <span class="k">raise</span>
<a id="__codelineno-5-118" name="__codelineno-5-118" href="#__codelineno-5-118"></a>
<a id="__codelineno-5-119" name="__codelineno-5-119" href="#__codelineno-5-119"></a>    <span class="k">def</span> <span class="nf">_should_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-5-120" name="__codelineno-5-120" href="#__codelineno-5-120"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if optimization should terminate.&quot;&quot;&quot;</span>
<a id="__codelineno-5-121" name="__codelineno-5-121" href="#__codelineno-5-121"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_trial</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_trials</span><span class="p">:</span>
<a id="__codelineno-5-122" name="__codelineno-5-122" href="#__codelineno-5-122"></a>            <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-5-123" name="__codelineno-5-123" href="#__codelineno-5-123"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_algorithm</span><span class="o">.</span><span class="n">is_complete</span><span class="p">():</span>
<a id="__codelineno-5-124" name="__codelineno-5-124" href="#__codelineno-5-124"></a>            <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-5-125" name="__codelineno-5-125" href="#__codelineno-5-125"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-5-126" name="__codelineno-5-126" href="#__codelineno-5-126"></a>
<a id="__codelineno-5-127" name="__codelineno-5-127" href="#__codelineno-5-127"></a>    <span class="k">def</span> <span class="nf">_should_checkpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-5-128" name="__codelineno-5-128" href="#__codelineno-5-128"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if checkpoint should be saved.&quot;&quot;&quot;</span>
<a id="__codelineno-5-129" name="__codelineno-5-129" href="#__codelineno-5-129"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkpoint_dir</span><span class="p">:</span>
<a id="__codelineno-5-130" name="__codelineno-5-130" href="#__codelineno-5-130"></a>            <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-5-131" name="__codelineno-5-131" href="#__codelineno-5-131"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_trial</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkpoint_frequency</span> <span class="o">==</span> <span class="mi">0</span>
<a id="__codelineno-5-132" name="__codelineno-5-132" href="#__codelineno-5-132"></a>
<a id="__codelineno-5-133" name="__codelineno-5-133" href="#__codelineno-5-133"></a>    <span class="k">def</span> <span class="nf">_evaluate_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">OptimizationResult</span><span class="p">:</span>
<a id="__codelineno-5-134" name="__codelineno-5-134" href="#__codelineno-5-134"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluate single parameter configuration.&quot;&quot;&quot;</span>
<a id="__codelineno-5-135" name="__codelineno-5-135" href="#__codelineno-5-135"></a>        <span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<a id="__codelineno-5-136" name="__codelineno-5-136" href="#__codelineno-5-136"></a>        <span class="n">trial_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_trial</span>
<a id="__codelineno-5-137" name="__codelineno-5-137" href="#__codelineno-5-137"></a>
<a id="__codelineno-5-138" name="__codelineno-5-138" href="#__codelineno-5-138"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-5-139" name="__codelineno-5-139" href="#__codelineno-5-139"></a>            <span class="c1"># Run backtest</span>
<a id="__codelineno-5-140" name="__codelineno-5-140" href="#__codelineno-5-140"></a>            <span class="n">backtest_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backtest_function</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<a id="__codelineno-5-141" name="__codelineno-5-141" href="#__codelineno-5-141"></a>
<a id="__codelineno-5-142" name="__codelineno-5-142" href="#__codelineno-5-142"></a>            <span class="c1"># Extract objective metric</span>
<a id="__codelineno-5-143" name="__codelineno-5-143" href="#__codelineno-5-143"></a>            <span class="n">score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objective_function</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">backtest_result</span><span class="p">)</span>
<a id="__codelineno-5-144" name="__codelineno-5-144" href="#__codelineno-5-144"></a>
<a id="__codelineno-5-145" name="__codelineno-5-145" href="#__codelineno-5-145"></a>            <span class="n">duration</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="nb">str</span><span class="p">((</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()))</span>
<a id="__codelineno-5-146" name="__codelineno-5-146" href="#__codelineno-5-146"></a>
<a id="__codelineno-5-147" name="__codelineno-5-147" href="#__codelineno-5-147"></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">OptimizationResult</span><span class="p">(</span>
<a id="__codelineno-5-148" name="__codelineno-5-148" href="#__codelineno-5-148"></a>                <span class="n">trial_id</span><span class="o">=</span><span class="n">trial_id</span><span class="p">,</span>
<a id="__codelineno-5-149" name="__codelineno-5-149" href="#__codelineno-5-149"></a>                <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
<a id="__codelineno-5-150" name="__codelineno-5-150" href="#__codelineno-5-150"></a>                <span class="n">score</span><span class="o">=</span><span class="n">score</span><span class="p">,</span>
<a id="__codelineno-5-151" name="__codelineno-5-151" href="#__codelineno-5-151"></a>                <span class="n">timestamp</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span>
<a id="__codelineno-5-152" name="__codelineno-5-152" href="#__codelineno-5-152"></a>                <span class="n">backtest_metrics</span><span class="o">=</span><span class="n">backtest_result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;performance_metrics&quot;</span><span class="p">,</span> <span class="p">{}),</span>
<a id="__codelineno-5-153" name="__codelineno-5-153" href="#__codelineno-5-153"></a>                <span class="n">duration_seconds</span><span class="o">=</span><span class="n">duration</span>
<a id="__codelineno-5-154" name="__codelineno-5-154" href="#__codelineno-5-154"></a>            <span class="p">)</span>
<a id="__codelineno-5-155" name="__codelineno-5-155" href="#__codelineno-5-155"></a>
<a id="__codelineno-5-156" name="__codelineno-5-156" href="#__codelineno-5-156"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-5-157" name="__codelineno-5-157" href="#__codelineno-5-157"></a>                <span class="s2">&quot;trial_completed&quot;</span><span class="p">,</span>
<a id="__codelineno-5-158" name="__codelineno-5-158" href="#__codelineno-5-158"></a>                <span class="n">trial_id</span><span class="o">=</span><span class="n">trial_id</span><span class="p">,</span>
<a id="__codelineno-5-159" name="__codelineno-5-159" href="#__codelineno-5-159"></a>                <span class="n">score</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">score</span><span class="p">),</span>
<a id="__codelineno-5-160" name="__codelineno-5-160" href="#__codelineno-5-160"></a>                <span class="n">duration_seconds</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span>
<a id="__codelineno-5-161" name="__codelineno-5-161" href="#__codelineno-5-161"></a>            <span class="p">)</span>
<a id="__codelineno-5-162" name="__codelineno-5-162" href="#__codelineno-5-162"></a>
<a id="__codelineno-5-163" name="__codelineno-5-163" href="#__codelineno-5-163"></a>            <span class="k">return</span> <span class="n">result</span>
<a id="__codelineno-5-164" name="__codelineno-5-164" href="#__codelineno-5-164"></a>
<a id="__codelineno-5-165" name="__codelineno-5-165" href="#__codelineno-5-165"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-5-166" name="__codelineno-5-166" href="#__codelineno-5-166"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;trial_failed&quot;</span><span class="p">,</span> <span class="n">trial_id</span><span class="o">=</span><span class="n">trial_id</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
<a id="__codelineno-5-167" name="__codelineno-5-167" href="#__codelineno-5-167"></a>
<a id="__codelineno-5-168" name="__codelineno-5-168" href="#__codelineno-5-168"></a>            <span class="c1"># Return failed result</span>
<a id="__codelineno-5-169" name="__codelineno-5-169" href="#__codelineno-5-169"></a>            <span class="n">duration</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="nb">str</span><span class="p">((</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()))</span>
<a id="__codelineno-5-170" name="__codelineno-5-170" href="#__codelineno-5-170"></a>            <span class="k">return</span> <span class="n">OptimizationResult</span><span class="p">(</span>
<a id="__codelineno-5-171" name="__codelineno-5-171" href="#__codelineno-5-171"></a>                <span class="n">trial_id</span><span class="o">=</span><span class="n">trial_id</span><span class="p">,</span>
<a id="__codelineno-5-172" name="__codelineno-5-172" href="#__codelineno-5-172"></a>                <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
<a id="__codelineno-5-173" name="__codelineno-5-173" href="#__codelineno-5-173"></a>                <span class="n">score</span><span class="o">=</span><span class="n">Decimal</span><span class="p">(</span><span class="s2">&quot;-Infinity&quot;</span><span class="p">),</span>
<a id="__codelineno-5-174" name="__codelineno-5-174" href="#__codelineno-5-174"></a>                <span class="n">timestamp</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span>
<a id="__codelineno-5-175" name="__codelineno-5-175" href="#__codelineno-5-175"></a>                <span class="n">backtest_metrics</span><span class="o">=</span><span class="p">{},</span>
<a id="__codelineno-5-176" name="__codelineno-5-176" href="#__codelineno-5-176"></a>                <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
<a id="__codelineno-5-177" name="__codelineno-5-177" href="#__codelineno-5-177"></a>                <span class="n">duration_seconds</span><span class="o">=</span><span class="n">duration</span>
<a id="__codelineno-5-178" name="__codelineno-5-178" href="#__codelineno-5-178"></a>            <span class="p">)</span>
<a id="__codelineno-5-179" name="__codelineno-5-179" href="#__codelineno-5-179"></a>
<a id="__codelineno-5-180" name="__codelineno-5-180" href="#__codelineno-5-180"></a>    <span class="k">def</span> <span class="nf">_save_checkpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-5-181" name="__codelineno-5-181" href="#__codelineno-5-181"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Save optimization state to checkpoint file.&quot;&quot;&quot;</span>
<a id="__codelineno-5-182" name="__codelineno-5-182" href="#__codelineno-5-182"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkpoint_dir</span><span class="p">:</span>
<a id="__codelineno-5-183" name="__codelineno-5-183" href="#__codelineno-5-183"></a>            <span class="k">return</span>
<a id="__codelineno-5-184" name="__codelineno-5-184" href="#__codelineno-5-184"></a>
<a id="__codelineno-5-185" name="__codelineno-5-185" href="#__codelineno-5-185"></a>        <span class="n">checkpoint_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkpoint_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;checkpoint_trial_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_trial</span><span class="si">}</span><span class="s2">.json&quot;</span>
<a id="__codelineno-5-186" name="__codelineno-5-186" href="#__codelineno-5-186"></a>
<a id="__codelineno-5-187" name="__codelineno-5-187" href="#__codelineno-5-187"></a>        <span class="n">state</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-5-188" name="__codelineno-5-188" href="#__codelineno-5-188"></a>            <span class="s2">&quot;current_trial&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_trial</span><span class="p">,</span>
<a id="__codelineno-5-189" name="__codelineno-5-189" href="#__codelineno-5-189"></a>            <span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">],</span>
<a id="__codelineno-5-190" name="__codelineno-5-190" href="#__codelineno-5-190"></a>            <span class="s2">&quot;best_result&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_result</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_result</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-5-191" name="__codelineno-5-191" href="#__codelineno-5-191"></a>            <span class="s2">&quot;algorithm_state&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_algorithm</span><span class="o">.</span><span class="n">get_state</span><span class="p">(),</span>
<a id="__codelineno-5-192" name="__codelineno-5-192" href="#__codelineno-5-192"></a>            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
<a id="__codelineno-5-193" name="__codelineno-5-193" href="#__codelineno-5-193"></a>        <span class="p">}</span>
<a id="__codelineno-5-194" name="__codelineno-5-194" href="#__codelineno-5-194"></a>
<a id="__codelineno-5-195" name="__codelineno-5-195" href="#__codelineno-5-195"></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">checkpoint_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-5-196" name="__codelineno-5-196" href="#__codelineno-5-196"></a>            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-5-197" name="__codelineno-5-197" href="#__codelineno-5-197"></a>
<a id="__codelineno-5-198" name="__codelineno-5-198" href="#__codelineno-5-198"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;checkpoint_saved&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">checkpoint_file</span><span class="p">),</span> <span class="n">trial</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_trial</span><span class="p">)</span>
<a id="__codelineno-5-199" name="__codelineno-5-199" href="#__codelineno-5-199"></a>
<a id="__codelineno-5-200" name="__codelineno-5-200" href="#__codelineno-5-200"></a>    <span class="k">def</span> <span class="nf">load_checkpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">checkpoint_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-5-201" name="__codelineno-5-201" href="#__codelineno-5-201"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Load optimization state from checkpoint file.&quot;&quot;&quot;</span>
<a id="__codelineno-5-202" name="__codelineno-5-202" href="#__codelineno-5-202"></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">checkpoint_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-5-203" name="__codelineno-5-203" href="#__codelineno-5-203"></a>            <span class="n">state</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<a id="__codelineno-5-204" name="__codelineno-5-204" href="#__codelineno-5-204"></a>
<a id="__codelineno-5-205" name="__codelineno-5-205" href="#__codelineno-5-205"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">current_trial</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;current_trial&quot;</span><span class="p">]</span>
<a id="__codelineno-5-206" name="__codelineno-5-206" href="#__codelineno-5-206"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">OptimizationResult</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">]]</span>
<a id="__codelineno-5-207" name="__codelineno-5-207" href="#__codelineno-5-207"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">best_result</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-5-208" name="__codelineno-5-208" href="#__codelineno-5-208"></a>            <span class="n">OptimizationResult</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;best_result&quot;</span><span class="p">])</span>
<a id="__codelineno-5-209" name="__codelineno-5-209" href="#__codelineno-5-209"></a>            <span class="k">if</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;best_result&quot;</span><span class="p">]</span>
<a id="__codelineno-5-210" name="__codelineno-5-210" href="#__codelineno-5-210"></a>            <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-5-211" name="__codelineno-5-211" href="#__codelineno-5-211"></a>        <span class="p">)</span>
<a id="__codelineno-5-212" name="__codelineno-5-212" href="#__codelineno-5-212"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">search_algorithm</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;algorithm_state&quot;</span><span class="p">])</span>
<a id="__codelineno-5-213" name="__codelineno-5-213" href="#__codelineno-5-213"></a>
<a id="__codelineno-5-214" name="__codelineno-5-214" href="#__codelineno-5-214"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-5-215" name="__codelineno-5-215" href="#__codelineno-5-215"></a>            <span class="s2">&quot;checkpoint_loaded&quot;</span><span class="p">,</span>
<a id="__codelineno-5-216" name="__codelineno-5-216" href="#__codelineno-5-216"></a>            <span class="n">file</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">checkpoint_file</span><span class="p">),</span>
<a id="__codelineno-5-217" name="__codelineno-5-217" href="#__codelineno-5-217"></a>            <span class="n">resumed_at_trial</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_trial</span>
<a id="__codelineno-5-218" name="__codelineno-5-218" href="#__codelineno-5-218"></a>        <span class="p">)</span>
<a id="__codelineno-5-219" name="__codelineno-5-219" href="#__codelineno-5-219"></a>
<a id="__codelineno-5-220" name="__codelineno-5-220" href="#__codelineno-5-220"></a>    <span class="k">def</span> <span class="nf">get_history</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">OptimizationResult</span><span class="p">]:</span>
<a id="__codelineno-5-221" name="__codelineno-5-221" href="#__codelineno-5-221"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get complete optimization history.&quot;&quot;&quot;</span>
<a id="__codelineno-5-222" name="__codelineno-5-222" href="#__codelineno-5-222"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-5-223" name="__codelineno-5-223" href="#__codelineno-5-223"></a>
<a id="__codelineno-5-224" name="__codelineno-5-224" href="#__codelineno-5-224"></a>    <span class="k">def</span> <span class="nf">get_best_params</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-5-225" name="__codelineno-5-225" href="#__codelineno-5-225"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get best parameters found.&quot;&quot;&quot;</span>
<a id="__codelineno-5-226" name="__codelineno-5-226" href="#__codelineno-5-226"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_result</span><span class="p">:</span>
<a id="__codelineno-5-227" name="__codelineno-5-227" href="#__codelineno-5-227"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No results available yet&quot;</span><span class="p">)</span>
<a id="__codelineno-5-228" name="__codelineno-5-228" href="#__codelineno-5-228"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_result</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div></p>
<p><strong>Design Decisions</strong>:
- Orchestrates entire optimization loop (ask, evaluate, tell)
- Handles checkpointing at configurable frequency
- Supports resume from checkpoint
- Validates parameters before evaluation
- Tracks best result throughout optimization
- Handles backtest failures gracefully (score = -Infinity)
- Uses structured logging for observability
- Parallel execution delegated to separate executor (future enhancement)</p>
<h3 id="6-parallel-execution-architecture">6. Parallel Execution Architecture<a class="headerlink" href="#6-parallel-execution-architecture" title="Permanent link">&para;</a></h3>
<p><strong>Purpose</strong>: Execute backtest trials in parallel across multiple workers</p>
<p><strong>Design Overview</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>graph LR
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>    Optimizer[Optimizer] --&gt;|submit| Executor[ParallelExecutor]
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>    Executor --&gt;|dispatch| Local[Multiprocessing Pool]
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>    Executor --&gt;|dispatch| Ray[Ray Cluster]
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>    Local --&gt;|results| Executor
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>    Ray --&gt;|results| Executor
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>    Executor --&gt;|aggregate| Optimizer
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>    style Executor fill:#50C878,color:#fff
</code></pre></div></p>
<p><strong>Interface</strong> (Story 5.2-5.5 Implementation):
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ThreadPoolExecutor</span><span class="p">,</span> <span class="n">as_completed</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="k">class</span> <span class="nc">ParallelExecutor</span><span class="p">:</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute backtest trials in parallel.&quot;&quot;&quot;</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_workers</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">use_ray</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize parallel executor.</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="sd">        Args:</span>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="sd">            num_workers: Number of parallel workers</span>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="sd">            use_ray: Use Ray for distributed execution (vs multiprocessing)</span>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">num_workers</span> <span class="o">=</span> <span class="n">num_workers</span>
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">use_ray</span> <span class="o">=</span> <span class="n">use_ray</span>
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a>
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a>        <span class="k">if</span> <span class="n">use_ray</span><span class="p">:</span>
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a>                <span class="kn">import</span> <span class="nn">ray</span>
<a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">ray</span><span class="o">.</span><span class="n">is_initialized</span><span class="p">():</span>
<a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a>                    <span class="n">ray</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
<a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a>            <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
<a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a>                <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;Ray not installed. Install with: pip install ray&quot;</span><span class="p">)</span>
<a id="__codelineno-7-25" name="__codelineno-7-25" href="#__codelineno-7-25"></a>
<a id="__codelineno-7-26" name="__codelineno-7-26" href="#__codelineno-7-26"></a>    <span class="k">def</span> <span class="nf">map</span><span class="p">(</span>
<a id="__codelineno-7-27" name="__codelineno-7-27" href="#__codelineno-7-27"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-7-28" name="__codelineno-7-28" href="#__codelineno-7-28"></a>        <span class="n">function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
<a id="__codelineno-7-29" name="__codelineno-7-29" href="#__codelineno-7-29"></a>        <span class="n">param_configs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
<a id="__codelineno-7-30" name="__codelineno-7-30" href="#__codelineno-7-30"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<a id="__codelineno-7-31" name="__codelineno-7-31" href="#__codelineno-7-31"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute function in parallel for all parameter configurations.</span>
<a id="__codelineno-7-32" name="__codelineno-7-32" href="#__codelineno-7-32"></a>
<a id="__codelineno-7-33" name="__codelineno-7-33" href="#__codelineno-7-33"></a><span class="sd">        Args:</span>
<a id="__codelineno-7-34" name="__codelineno-7-34" href="#__codelineno-7-34"></a><span class="sd">            function: Backtest function to execute</span>
<a id="__codelineno-7-35" name="__codelineno-7-35" href="#__codelineno-7-35"></a><span class="sd">            param_configs: List of parameter configurations</span>
<a id="__codelineno-7-36" name="__codelineno-7-36" href="#__codelineno-7-36"></a>
<a id="__codelineno-7-37" name="__codelineno-7-37" href="#__codelineno-7-37"></a><span class="sd">        Returns:</span>
<a id="__codelineno-7-38" name="__codelineno-7-38" href="#__codelineno-7-38"></a><span class="sd">            List of backtest results (same order as param_configs)</span>
<a id="__codelineno-7-39" name="__codelineno-7-39" href="#__codelineno-7-39"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-7-40" name="__codelineno-7-40" href="#__codelineno-7-40"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_workers</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-7-41" name="__codelineno-7-41" href="#__codelineno-7-41"></a>            <span class="c1"># Sequential execution</span>
<a id="__codelineno-7-42" name="__codelineno-7-42" href="#__codelineno-7-42"></a>            <span class="k">return</span> <span class="p">[</span><span class="n">function</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="k">for</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">param_configs</span><span class="p">]</span>
<a id="__codelineno-7-43" name="__codelineno-7-43" href="#__codelineno-7-43"></a>
<a id="__codelineno-7-44" name="__codelineno-7-44" href="#__codelineno-7-44"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_ray</span><span class="p">:</span>
<a id="__codelineno-7-45" name="__codelineno-7-45" href="#__codelineno-7-45"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map_ray</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">param_configs</span><span class="p">)</span>
<a id="__codelineno-7-46" name="__codelineno-7-46" href="#__codelineno-7-46"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-7-47" name="__codelineno-7-47" href="#__codelineno-7-47"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map_multiprocessing</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">param_configs</span><span class="p">)</span>
<a id="__codelineno-7-48" name="__codelineno-7-48" href="#__codelineno-7-48"></a>
<a id="__codelineno-7-49" name="__codelineno-7-49" href="#__codelineno-7-49"></a>    <span class="k">def</span> <span class="nf">_map_multiprocessing</span><span class="p">(</span>
<a id="__codelineno-7-50" name="__codelineno-7-50" href="#__codelineno-7-50"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-7-51" name="__codelineno-7-51" href="#__codelineno-7-51"></a>        <span class="n">function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
<a id="__codelineno-7-52" name="__codelineno-7-52" href="#__codelineno-7-52"></a>        <span class="n">param_configs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
<a id="__codelineno-7-53" name="__codelineno-7-53" href="#__codelineno-7-53"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<a id="__codelineno-7-54" name="__codelineno-7-54" href="#__codelineno-7-54"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute using multiprocessing pool.&quot;&quot;&quot;</span>
<a id="__codelineno-7-55" name="__codelineno-7-55" href="#__codelineno-7-55"></a>        <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
<a id="__codelineno-7-56" name="__codelineno-7-56" href="#__codelineno-7-56"></a>            <span class="n">results</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">param_configs</span><span class="p">)</span>
<a id="__codelineno-7-57" name="__codelineno-7-57" href="#__codelineno-7-57"></a>        <span class="k">return</span> <span class="n">results</span>
<a id="__codelineno-7-58" name="__codelineno-7-58" href="#__codelineno-7-58"></a>
<a id="__codelineno-7-59" name="__codelineno-7-59" href="#__codelineno-7-59"></a>    <span class="k">def</span> <span class="nf">_map_ray</span><span class="p">(</span>
<a id="__codelineno-7-60" name="__codelineno-7-60" href="#__codelineno-7-60"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-7-61" name="__codelineno-7-61" href="#__codelineno-7-61"></a>        <span class="n">function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
<a id="__codelineno-7-62" name="__codelineno-7-62" href="#__codelineno-7-62"></a>        <span class="n">param_configs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
<a id="__codelineno-7-63" name="__codelineno-7-63" href="#__codelineno-7-63"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<a id="__codelineno-7-64" name="__codelineno-7-64" href="#__codelineno-7-64"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute using Ray distributed execution.&quot;&quot;&quot;</span>
<a id="__codelineno-7-65" name="__codelineno-7-65" href="#__codelineno-7-65"></a>        <span class="kn">import</span> <span class="nn">ray</span>
<a id="__codelineno-7-66" name="__codelineno-7-66" href="#__codelineno-7-66"></a>
<a id="__codelineno-7-67" name="__codelineno-7-67" href="#__codelineno-7-67"></a>        <span class="c1"># Convert function to Ray remote</span>
<a id="__codelineno-7-68" name="__codelineno-7-68" href="#__codelineno-7-68"></a>        <span class="n">remote_function</span> <span class="o">=</span> <span class="n">ray</span><span class="o">.</span><span class="n">remote</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
<a id="__codelineno-7-69" name="__codelineno-7-69" href="#__codelineno-7-69"></a>
<a id="__codelineno-7-70" name="__codelineno-7-70" href="#__codelineno-7-70"></a>        <span class="c1"># Submit all tasks</span>
<a id="__codelineno-7-71" name="__codelineno-7-71" href="#__codelineno-7-71"></a>        <span class="n">futures</span> <span class="o">=</span> <span class="p">[</span><span class="n">remote_function</span><span class="o">.</span><span class="n">remote</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="k">for</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">param_configs</span><span class="p">]</span>
<a id="__codelineno-7-72" name="__codelineno-7-72" href="#__codelineno-7-72"></a>
<a id="__codelineno-7-73" name="__codelineno-7-73" href="#__codelineno-7-73"></a>        <span class="c1"># Wait for all results</span>
<a id="__codelineno-7-74" name="__codelineno-7-74" href="#__codelineno-7-74"></a>        <span class="n">results</span> <span class="o">=</span> <span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">futures</span><span class="p">)</span>
<a id="__codelineno-7-75" name="__codelineno-7-75" href="#__codelineno-7-75"></a>
<a id="__codelineno-7-76" name="__codelineno-7-76" href="#__codelineno-7-76"></a>        <span class="k">return</span> <span class="n">results</span>
</code></pre></div></p>
<p><strong>Design Decisions</strong>:
- Supports both multiprocessing (local) and Ray (distributed)
- Provides simple <code>map</code> interface similar to builtin map
- Sequential fallback when num_workers=1
- Ray is optional dependency (fails gracefully if not installed)
- Thread-safe result aggregation handled by underlying libraries</p>
<h3 id="7-backtest-integration">7. Backtest Integration<a class="headerlink" href="#7-backtest-integration" title="Permanent link">&para;</a></h3>
<p><strong>Integration Flow</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>sequenceDiagram
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>    participant User
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>    participant Optimizer
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>    participant SearchAlg as SearchAlgorithm
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>    participant BacktestFunc as Backtest Function
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>    participant ObjFunc as ObjectiveFunction
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>    User-&gt;&gt;Optimizer: optimize()
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>    loop Until max_trials or complete
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>        Optimizer-&gt;&gt;SearchAlg: suggest()
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>        SearchAlg--&gt;&gt;Optimizer: params
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>        Optimizer-&gt;&gt;Optimizer: validate_params(params)
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>        Optimizer-&gt;&gt;BacktestFunc: run_backtest(params)
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>        BacktestFunc--&gt;&gt;Optimizer: backtest_result
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>        Optimizer-&gt;&gt;ObjFunc: evaluate(backtest_result)
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>        ObjFunc--&gt;&gt;Optimizer: score
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a>        Optimizer-&gt;&gt;SearchAlg: update(params, score)
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>        Optimizer-&gt;&gt;Optimizer: track best result
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a>        Optimizer-&gt;&gt;Optimizer: checkpoint if needed
<a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a>    end
<a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a>    Optimizer--&gt;&gt;User: best_result
</code></pre></div></p>
<p><strong>Backtest Function Contract</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="k">def</span> <span class="nf">backtest_function</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Run backtest with given parameters.</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="sd">    Args:</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="sd">        params: Strategy parameters (e.g., {&quot;sma_fast&quot;: 10, &quot;sma_slow&quot;: 30})</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="sd">    Returns:</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="sd">        Dictionary containing:</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="sd">        - &quot;performance_metrics&quot;: Dict with financial metrics (sharpe_ratio, etc.)</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="sd">        - &quot;portfolio_value&quot;: Polars DataFrame with portfolio value time series</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="sd">        - &quot;trades&quot;: Polars DataFrame with trade details</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="sd">    Raises:</span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="sd">        Exception: If backtest fails (invalid params, data issues, etc.)</span>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>    <span class="c1"># Pseudo-code:</span>
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a>    <span class="c1"># 1. Create strategy instance with params</span>
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a>    <span class="c1"># 2. Run backtest using run_algorithm()</span>
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a>    <span class="c1"># 3. Extract performance metrics</span>
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a>    <span class="c1"># 4. Return result dictionary</span>
<a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a>    <span class="k">pass</span>
</code></pre></div></p>
<p><strong>Example Integration</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="kn">from</span> <span class="nn">rustybt</span> <span class="kn">import</span> <span class="n">TradingAlgorithm</span><span class="p">,</span> <span class="n">run_algorithm</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="kn">from</span> <span class="nn">rustybt.optimization</span> <span class="kn">import</span> <span class="n">Optimizer</span><span class="p">,</span> <span class="n">ParameterSpace</span><span class="p">,</span> <span class="n">ObjectiveFunction</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="kn">from</span> <span class="nn">rustybt.optimization.search</span> <span class="kn">import</span> <span class="n">RandomSearchAlgorithm</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="c1"># Define strategy with configurable parameters</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="k">class</span> <span class="nc">MyStrategy</span><span class="p">(</span><span class="n">TradingAlgorithm</span><span class="p">):</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sma_fast</span><span class="p">,</span> <span class="n">sma_slow</span><span class="p">):</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sma_fast</span> <span class="o">=</span> <span class="n">sma_fast</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sma_slow</span> <span class="o">=</span> <span class="n">sma_slow</span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>        <span class="c1"># ... strategy setup</span>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>    <span class="k">def</span> <span class="nf">handle_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>        <span class="c1"># ... strategy logic using self.sma_fast, self.sma_slow</span>
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>        <span class="k">pass</span>
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a><span class="c1"># Define backtest function</span>
<a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a><span class="k">def</span> <span class="nf">run_backtest</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">run_algorithm</span><span class="p">(</span>
<a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a>        <span class="n">strategy</span><span class="o">=</span><span class="n">MyStrategy</span><span class="p">,</span>
<a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a>        <span class="n">strategy_params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
<a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a>        <span class="n">start_date</span><span class="o">=</span><span class="s2">&quot;2020-01-01&quot;</span><span class="p">,</span>
<a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a>        <span class="n">end_date</span><span class="o">=</span><span class="s2">&quot;2023-12-31&quot;</span><span class="p">,</span>
<a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a>        <span class="n">capital_base</span><span class="o">=</span><span class="mi">100000</span>
<a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a>    <span class="p">)</span>
<a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a>    <span class="k">return</span> <span class="n">result</span>
<a id="__codelineno-10-26" name="__codelineno-10-26" href="#__codelineno-10-26"></a>
<a id="__codelineno-10-27" name="__codelineno-10-27" href="#__codelineno-10-27"></a><span class="c1"># Define parameter space</span>
<a id="__codelineno-10-28" name="__codelineno-10-28" href="#__codelineno-10-28"></a><span class="n">param_space</span> <span class="o">=</span> <span class="n">ParameterSpace</span><span class="p">(</span><span class="n">parameters</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-10-29" name="__codelineno-10-29" href="#__codelineno-10-29"></a>    <span class="n">DiscreteParameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;sma_fast&quot;</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
<a id="__codelineno-10-30" name="__codelineno-10-30" href="#__codelineno-10-30"></a>    <span class="n">DiscreteParameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;sma_slow&quot;</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-10-31" name="__codelineno-10-31" href="#__codelineno-10-31"></a><span class="p">])</span>
<a id="__codelineno-10-32" name="__codelineno-10-32" href="#__codelineno-10-32"></a>
<a id="__codelineno-10-33" name="__codelineno-10-33" href="#__codelineno-10-33"></a><span class="c1"># Create optimizer</span>
<a id="__codelineno-10-34" name="__codelineno-10-34" href="#__codelineno-10-34"></a><span class="n">optimizer</span> <span class="o">=</span> <span class="n">Optimizer</span><span class="p">(</span>
<a id="__codelineno-10-35" name="__codelineno-10-35" href="#__codelineno-10-35"></a>    <span class="n">parameter_space</span><span class="o">=</span><span class="n">param_space</span><span class="p">,</span>
<a id="__codelineno-10-36" name="__codelineno-10-36" href="#__codelineno-10-36"></a>    <span class="n">search_algorithm</span><span class="o">=</span><span class="n">RandomSearchAlgorithm</span><span class="p">(</span><span class="n">param_space</span><span class="p">,</span> <span class="n">n_trials</span><span class="o">=</span><span class="mi">100</span><span class="p">),</span>
<a id="__codelineno-10-37" name="__codelineno-10-37" href="#__codelineno-10-37"></a>    <span class="n">objective_function</span><span class="o">=</span><span class="n">ObjectiveFunction</span><span class="p">(</span><span class="n">metric</span><span class="o">=</span><span class="s2">&quot;sharpe_ratio&quot;</span><span class="p">),</span>
<a id="__codelineno-10-38" name="__codelineno-10-38" href="#__codelineno-10-38"></a>    <span class="n">backtest_function</span><span class="o">=</span><span class="n">run_backtest</span><span class="p">,</span>
<a id="__codelineno-10-39" name="__codelineno-10-39" href="#__codelineno-10-39"></a>    <span class="n">max_trials</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-10-40" name="__codelineno-10-40" href="#__codelineno-10-40"></a>    <span class="n">checkpoint_dir</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;./checkpoints&quot;</span><span class="p">),</span>
<a id="__codelineno-10-41" name="__codelineno-10-41" href="#__codelineno-10-41"></a>    <span class="n">parallel_workers</span><span class="o">=</span><span class="mi">4</span>
<a id="__codelineno-10-42" name="__codelineno-10-42" href="#__codelineno-10-42"></a><span class="p">)</span>
<a id="__codelineno-10-43" name="__codelineno-10-43" href="#__codelineno-10-43"></a>
<a id="__codelineno-10-44" name="__codelineno-10-44" href="#__codelineno-10-44"></a><span class="c1"># Run optimization</span>
<a id="__codelineno-10-45" name="__codelineno-10-45" href="#__codelineno-10-45"></a><span class="n">best_result</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>
<a id="__codelineno-10-46" name="__codelineno-10-46" href="#__codelineno-10-46"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best params: </span><span class="si">{</span><span class="n">best_result</span><span class="o">.</span><span class="n">params</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-10-47" name="__codelineno-10-47" href="#__codelineno-10-47"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best Sharpe: </span><span class="si">{</span><span class="n">best_result</span><span class="o">.</span><span class="n">score</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></p>
<p><strong>Design Decisions</strong>:
- Backtest function is user-provided (flexible integration)
- Parameters passed as dictionary (simple, serializable)
- Backtest failures handled gracefully (exception caught, logged, score = -Infinity)
- Result format standardized (performance_metrics dict)
- Integration point is simple function call (no tight coupling)</p>
<h2 id="extensibility">Extensibility<a class="headerlink" href="#extensibility" title="Permanent link">&para;</a></h2>
<h3 id="adding-new-search-algorithms">Adding New Search Algorithms<a class="headerlink" href="#adding-new-search-algorithms" title="Permanent link">&para;</a></h3>
<p>To add a new search algorithm:</p>
<ol>
<li>
<p><strong>Implement SearchAlgorithm interface</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="kn">from</span> <span class="nn">rustybt.optimization.base</span> <span class="kn">import</span> <span class="n">SearchAlgorithm</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="k">class</span> <span class="nc">MyNewAlgorithm</span><span class="p">(</span><span class="n">SearchAlgorithm</span><span class="p">):</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameter_space</span><span class="p">:</span> <span class="n">ParameterSpace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parameter_space</span><span class="p">)</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>        <span class="c1"># Algorithm-specific initialization</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">my_internal_state</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>    <span class="k">def</span> <span class="nf">suggest</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>        <span class="c1"># Implement parameter suggestion logic</span>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>        <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># ... generate params based on algorithm</span>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">validate_suggested_params</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>        <span class="k">return</span> <span class="n">params</span>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">score</span><span class="p">:</span> <span class="n">Decimal</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>        <span class="c1"># Update internal state with result</span>
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">my_internal_state</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">params</span><span class="p">,</span> <span class="n">score</span><span class="p">))</span>
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a>
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a>    <span class="k">def</span> <span class="nf">is_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a>        <span class="c1"># Define termination criteria</span>
<a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_iterations</span>
<a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a>
<a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a>    <span class="k">def</span> <span class="nf">get_state</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a>        <span class="c1"># Return serializable state</span>
<a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a>        <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a>            <span class="s2">&quot;iteration&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span><span class="p">,</span>
<a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a>            <span class="s2">&quot;my_internal_state&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">my_internal_state</span>
<a id="__codelineno-11-29" name="__codelineno-11-29" href="#__codelineno-11-29"></a>        <span class="p">}</span>
<a id="__codelineno-11-30" name="__codelineno-11-30" href="#__codelineno-11-30"></a>
<a id="__codelineno-11-31" name="__codelineno-11-31" href="#__codelineno-11-31"></a>    <span class="k">def</span> <span class="nf">set_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-11-32" name="__codelineno-11-32" href="#__codelineno-11-32"></a>        <span class="c1"># Restore state from checkpoint</span>
<a id="__codelineno-11-33" name="__codelineno-11-33" href="#__codelineno-11-33"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;iteration&quot;</span><span class="p">]</span>
<a id="__codelineno-11-34" name="__codelineno-11-34" href="#__codelineno-11-34"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">my_internal_state</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;my_internal_state&quot;</span><span class="p">]</span>
</code></pre></div></p>
</li>
<li>
<p><strong>Use with Optimizer</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="n">algorithm</span> <span class="o">=</span> <span class="n">MyNewAlgorithm</span><span class="p">(</span><span class="n">param_space</span><span class="p">,</span> <span class="n">max_iterations</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="n">optimizer</span> <span class="o">=</span> <span class="n">Optimizer</span><span class="p">(</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>    <span class="n">parameter_space</span><span class="o">=</span><span class="n">param_space</span><span class="p">,</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>    <span class="n">search_algorithm</span><span class="o">=</span><span class="n">algorithm</span><span class="p">,</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>    <span class="n">objective_function</span><span class="o">=</span><span class="n">obj_func</span><span class="p">,</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>    <span class="n">backtest_function</span><span class="o">=</span><span class="n">backtest_func</span><span class="p">,</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>    <span class="n">max_trials</span><span class="o">=</span><span class="mi">200</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="p">)</span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="n">best</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>
</code></pre></div></p>
</li>
</ol>
<p><strong>No changes to Optimizer required</strong> - the design is fully extensible.</p>
<h2 id="search-algorithm-implementations">Search Algorithm Implementations<a class="headerlink" href="#search-algorithm-implementations" title="Permanent link">&para;</a></h2>
<h3 id="grid-search-algorithm-story-52">Grid Search Algorithm (Story 5.2)<a class="headerlink" href="#grid-search-algorithm-story-52" title="Permanent link">&para;</a></h3>
<p><strong>Purpose</strong>: Exhaustive search over discrete parameter grid</p>
<p><strong>Implementation</strong>: <code>rustybt/optimization/search/grid_search.py</code></p>
<p><strong>Key Features</strong>:
- Exhaustive Cartesian product of parameter values
- Progress tracking (N/M combinations complete)
- Optional early stopping (stop if no improvement in N rounds)
- Thread-safe for parallel execution
- Result sorting by objective function</p>
<p><strong>When to Use</strong>:
- Small parameter spaces (&lt;100 combinations)
- Discrete/categorical parameters only
- Need guaranteed complete coverage
- Initial parameter space exploration</p>
<p><strong>Limitations</strong>:
- <strong>Combinatorial explosion</strong>: Grid size = n₁ × n₂ × ... × nₖ
- Not suitable for continuous parameters
- Inefficient for large spaces (&gt;1000 combinations)
- No intelligent parameter selection</p>
<p><strong>Example</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="kn">from</span> <span class="nn">rustybt.optimization</span> <span class="kn">import</span> <span class="n">ParameterSpace</span><span class="p">,</span> <span class="n">GridSearchAlgorithm</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="kn">from</span> <span class="nn">rustybt.optimization.parameter_space</span> <span class="kn">import</span> <span class="n">DiscreteParameter</span><span class="p">,</span> <span class="n">CategoricalParameter</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="c1"># Define parameter grid</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="n">param_space</span> <span class="o">=</span> <span class="n">ParameterSpace</span><span class="p">(</span><span class="n">parameters</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>    <span class="n">DiscreteParameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;sma_fast&quot;</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>    <span class="n">DiscreteParameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;sma_slow&quot;</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">25</span><span class="p">),</span>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>    <span class="n">CategoricalParameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;threshold&quot;</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">])</span>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="p">])</span>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="c1"># Create grid search (5 × 3 × 3 = 45 combinations)</span>
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a><span class="n">grid</span> <span class="o">=</span> <span class="n">GridSearchAlgorithm</span><span class="p">(</span>
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>    <span class="n">parameter_space</span><span class="o">=</span><span class="n">param_space</span><span class="p">,</span>
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>    <span class="n">early_stopping_rounds</span><span class="o">=</span><span class="mi">10</span>  <span class="c1"># Optional: stop if no improvement in 10 rounds</span>
<a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a><span class="p">)</span>
<a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a>
<a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a><span class="c1"># Optimization loop</span>
<a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a><span class="k">while</span> <span class="ow">not</span> <span class="n">grid</span><span class="o">.</span><span class="n">is_complete</span><span class="p">():</span>
<a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a>    <span class="n">params</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">suggest</span><span class="p">()</span>
<a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">run_backtest</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a>    <span class="n">score</span> <span class="o">=</span> <span class="n">extract_sharpe_ratio</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a>    <span class="n">grid</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">score</span><span class="p">)</span>
<a id="__codelineno-13-23" name="__codelineno-13-23" href="#__codelineno-13-23"></a>
<a id="__codelineno-13-24" name="__codelineno-13-24" href="#__codelineno-13-24"></a>    <span class="c1"># Progress tracking</span>
<a id="__codelineno-13-25" name="__codelineno-13-25" href="#__codelineno-13-25"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Progress: </span><span class="si">{</span><span class="n">grid</span><span class="o">.</span><span class="n">progress</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
<a id="__codelineno-13-26" name="__codelineno-13-26" href="#__codelineno-13-26"></a>
<a id="__codelineno-13-27" name="__codelineno-13-27" href="#__codelineno-13-27"></a><span class="c1"># Get best parameters</span>
<a id="__codelineno-13-28" name="__codelineno-13-28" href="#__codelineno-13-28"></a><span class="n">best_params</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">get_best_params</span><span class="p">()</span>
<a id="__codelineno-13-29" name="__codelineno-13-29" href="#__codelineno-13-29"></a><span class="n">top_5_results</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">get_results</span><span class="p">(</span><span class="n">top_k</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div></p>
<p><strong>Performance Characteristics</strong>:
- Time complexity: O(n₁ × n₂ × ... × nₖ) where nᵢ is values per parameter
- Space complexity: O(k) for parameters, O(n) for results storage
- Thread-safe: Yes (uses threading.Lock)
- Deterministic: Yes (same grid order every run)</p>
<p><strong>Warnings</strong>:
- Grid search issues a warning for &gt;1000 total combinations
- Raises <code>ValueError</code> if continuous parameters provided
- Recommend RandomSearch or Bayesian for large spaces</p>
<h3 id="random-search-algorithm-story-53">Random Search Algorithm (Story 5.3)<a class="headerlink" href="#random-search-algorithm-story-53" title="Permanent link">&para;</a></h3>
<p><strong>Purpose</strong>: Probabilistic sampling from parameter space</p>
<p><strong>Implementation</strong>: <code>rustybt/optimization/search/random_search.py</code></p>
<p><strong>Key Features</strong>:
- Random sampling from parameter distributions (uniform, log-uniform, normal)
- Duplicate prevention with configurable retry limit
- Best result tracking during optimization
- Thread-safe for parallel execution
- Reproducible with seed parameter
- Support for continuous, discrete, and categorical parameters</p>
<p><strong>When to Use</strong>:
- High-dimensional spaces (&gt;5 parameters)
- Continuous parameter ranges
- Limited computational budget
- Initial exploration before Bayesian optimization
- When some parameters are less important than others</p>
<p><strong>Advantages over Grid Search</strong>:
According to Bergstra &amp; Bengio (2012): "Random search is more efficient than grid search for hyperparameter optimization when only a small number of hyperparameters effectively influence the final performance."</p>
<p><strong>Performance Comparison</strong>:
| Dimension | Grid Search | Random Search (100 samples) | Speedup |
|-----------|-------------|----------------------------|---------|
| 3 params  | 75 evals (3³×3) | 50 evals | 1.5× |
| 5 params  | 243 evals (3⁵) | 100 evals | 2.4× |
| 10 params | 59,049 evals | 500 evals | 118× |</p>
<p><strong>Distribution Types</strong>:</p>
<ol>
<li><strong>Uniform</strong> (<code>prior="uniform"</code>): Equal probability across range</li>
<li>Best for: Parameters with no prior knowledge</li>
<li>
<p>Example: Position size, threshold values</p>
</li>
<li>
<p><strong>Log-Uniform</strong> (<code>prior="log-uniform"</code>): Equal probability in log space</p>
</li>
<li>Best for: Scale-variant parameters (learning rates, regularization)</li>
<li>
<p>Example: Lookback periods (10-1000), decay factors</p>
</li>
<li>
<p><strong>Normal</strong> (<code>prior="normal"</code>): Gaussian distribution (clipped to bounds)</p>
</li>
<li>Best for: Parameters with expected optimal range</li>
<li>Example: Moving average periods when you suspect optimal ~20-30</li>
</ol>
<p><strong>Example</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="kn">from</span> <span class="nn">rustybt.optimization</span> <span class="kn">import</span> <span class="n">ParameterSpace</span><span class="p">,</span> <span class="n">RandomSearchAlgorithm</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="kn">from</span> <span class="nn">rustybt.optimization.parameter_space</span> <span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>    <span class="n">ContinuousParameter</span><span class="p">,</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>    <span class="n">DiscreteParameter</span><span class="p">,</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>    <span class="n">CategoricalParameter</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="p">)</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="c1"># Define parameter space with different distributions</span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="n">param_space</span> <span class="o">=</span> <span class="n">ParameterSpace</span><span class="p">(</span><span class="n">parameters</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>    <span class="n">ContinuousParameter</span><span class="p">(</span>
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;lookback&quot;</span><span class="p">,</span>
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>        <span class="n">min_value</span><span class="o">=</span><span class="n">Decimal</span><span class="p">(</span><span class="s2">&quot;10&quot;</span><span class="p">),</span>
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a>        <span class="n">max_value</span><span class="o">=</span><span class="n">Decimal</span><span class="p">(</span><span class="s2">&quot;100&quot;</span><span class="p">),</span>
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a>        <span class="n">prior</span><span class="o">=</span><span class="s2">&quot;uniform&quot;</span>  <span class="c1"># Uniform sampling</span>
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a>    <span class="p">),</span>
<a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a>    <span class="n">ContinuousParameter</span><span class="p">(</span>
<a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a>        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;learning_rate&quot;</span><span class="p">,</span>
<a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a>        <span class="n">min_value</span><span class="o">=</span><span class="n">Decimal</span><span class="p">(</span><span class="s2">&quot;0.0001&quot;</span><span class="p">),</span>
<a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a>        <span class="n">max_value</span><span class="o">=</span><span class="n">Decimal</span><span class="p">(</span><span class="s2">&quot;0.1&quot;</span><span class="p">),</span>
<a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a>        <span class="n">prior</span><span class="o">=</span><span class="s2">&quot;log-uniform&quot;</span>  <span class="c1"># Log-uniform for scale-variant param</span>
<a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a>    <span class="p">),</span>
<a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a>    <span class="n">ContinuousParameter</span><span class="p">(</span>
<a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a>        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;threshold&quot;</span><span class="p">,</span>
<a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a>        <span class="n">min_value</span><span class="o">=</span><span class="n">Decimal</span><span class="p">(</span><span class="s2">&quot;0.0&quot;</span><span class="p">),</span>
<a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a>        <span class="n">max_value</span><span class="o">=</span><span class="n">Decimal</span><span class="p">(</span><span class="s2">&quot;1.0&quot;</span><span class="p">),</span>
<a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a>        <span class="n">prior</span><span class="o">=</span><span class="s2">&quot;normal&quot;</span>  <span class="c1"># Normal distribution (clusters around 0.5)</span>
<a id="__codelineno-14-28" name="__codelineno-14-28" href="#__codelineno-14-28"></a>    <span class="p">),</span>
<a id="__codelineno-14-29" name="__codelineno-14-29" href="#__codelineno-14-29"></a>    <span class="n">CategoricalParameter</span><span class="p">(</span>
<a id="__codelineno-14-30" name="__codelineno-14-30" href="#__codelineno-14-30"></a>        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;indicator&quot;</span><span class="p">,</span>
<a id="__codelineno-14-31" name="__codelineno-14-31" href="#__codelineno-14-31"></a>        <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ema&quot;</span><span class="p">,</span> <span class="s2">&quot;sma&quot;</span><span class="p">,</span> <span class="s2">&quot;wma&quot;</span><span class="p">]</span>
<a id="__codelineno-14-32" name="__codelineno-14-32" href="#__codelineno-14-32"></a>    <span class="p">)</span>
<a id="__codelineno-14-33" name="__codelineno-14-33" href="#__codelineno-14-33"></a><span class="p">])</span>
<a id="__codelineno-14-34" name="__codelineno-14-34" href="#__codelineno-14-34"></a>
<a id="__codelineno-14-35" name="__codelineno-14-35" href="#__codelineno-14-35"></a><span class="c1"># Create random search with reproducible seed</span>
<a id="__codelineno-14-36" name="__codelineno-14-36" href="#__codelineno-14-36"></a><span class="n">random_search</span> <span class="o">=</span> <span class="n">RandomSearchAlgorithm</span><span class="p">(</span>
<a id="__codelineno-14-37" name="__codelineno-14-37" href="#__codelineno-14-37"></a>    <span class="n">parameter_space</span><span class="o">=</span><span class="n">param_space</span><span class="p">,</span>
<a id="__codelineno-14-38" name="__codelineno-14-38" href="#__codelineno-14-38"></a>    <span class="n">n_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>  <span class="c1"># Sample 100 random configurations</span>
<a id="__codelineno-14-39" name="__codelineno-14-39" href="#__codelineno-14-39"></a>    <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>  <span class="c1"># Reproducible results</span>
<a id="__codelineno-14-40" name="__codelineno-14-40" href="#__codelineno-14-40"></a>    <span class="n">max_retries</span><span class="o">=</span><span class="mi">50</span>  <span class="c1"># Try up to 50 times to avoid duplicates</span>
<a id="__codelineno-14-41" name="__codelineno-14-41" href="#__codelineno-14-41"></a><span class="p">)</span>
<a id="__codelineno-14-42" name="__codelineno-14-42" href="#__codelineno-14-42"></a>
<a id="__codelineno-14-43" name="__codelineno-14-43" href="#__codelineno-14-43"></a><span class="c1"># Optimization loop</span>
<a id="__codelineno-14-44" name="__codelineno-14-44" href="#__codelineno-14-44"></a><span class="k">while</span> <span class="ow">not</span> <span class="n">random_search</span><span class="o">.</span><span class="n">is_complete</span><span class="p">():</span>
<a id="__codelineno-14-45" name="__codelineno-14-45" href="#__codelineno-14-45"></a>    <span class="n">params</span> <span class="o">=</span> <span class="n">random_search</span><span class="o">.</span><span class="n">suggest</span><span class="p">()</span>
<a id="__codelineno-14-46" name="__codelineno-14-46" href="#__codelineno-14-46"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">run_backtest</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<a id="__codelineno-14-47" name="__codelineno-14-47" href="#__codelineno-14-47"></a>    <span class="n">score</span> <span class="o">=</span> <span class="n">extract_sharpe_ratio</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-14-48" name="__codelineno-14-48" href="#__codelineno-14-48"></a>    <span class="n">random_search</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">score</span><span class="p">)</span>
<a id="__codelineno-14-49" name="__codelineno-14-49" href="#__codelineno-14-49"></a>
<a id="__codelineno-14-50" name="__codelineno-14-50" href="#__codelineno-14-50"></a>    <span class="c1"># Progress tracking</span>
<a id="__codelineno-14-51" name="__codelineno-14-51" href="#__codelineno-14-51"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Progress: </span><span class="si">{</span><span class="n">random_search</span><span class="o">.</span><span class="n">progress</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
<a id="__codelineno-14-52" name="__codelineno-14-52" href="#__codelineno-14-52"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Duplicate rate: </span><span class="si">{</span><span class="n">random_search</span><span class="o">.</span><span class="n">duplicate_rate</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
<a id="__codelineno-14-53" name="__codelineno-14-53" href="#__codelineno-14-53"></a>
<a id="__codelineno-14-54" name="__codelineno-14-54" href="#__codelineno-14-54"></a><span class="c1"># Get best parameters and top results</span>
<a id="__codelineno-14-55" name="__codelineno-14-55" href="#__codelineno-14-55"></a><span class="n">best_params</span><span class="p">,</span> <span class="n">best_score</span> <span class="o">=</span> <span class="n">random_search</span><span class="o">.</span><span class="n">get_best_result</span><span class="p">()</span>
<a id="__codelineno-14-56" name="__codelineno-14-56" href="#__codelineno-14-56"></a><span class="n">top_10_results</span> <span class="o">=</span> <span class="n">random_search</span><span class="o">.</span><span class="n">get_results</span><span class="p">(</span><span class="n">top_k</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div></p>
<p><strong>Performance Characteristics</strong>:
- Time complexity: O(n) where n is n_iter
- Space complexity: O(n) for results storage + O(n) for duplicate tracking
- Thread-safe: Yes (uses threading.Lock)
- Deterministic: Yes with seed parameter (uses numpy.random.Generator)</p>
<p><strong>Duplicate Prevention</strong>:
Random Search tracks previously sampled parameter combinations and re-samples if a duplicate is detected (up to <code>max_retries</code> attempts). This is particularly important for:
- Small discrete parameter spaces
- Late in optimization when most combinations have been tried
- Parallel execution where multiple workers might sample similar parameters</p>
<p>If duplicate rate exceeds threshold, a warning is issued suggesting:
- Increase n_iter
- Expand parameter space
- Switch to Grid Search for exhaustive coverage</p>
<p><strong>Comparison Table: Grid Search vs Random Search</strong></p>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Grid Search</th>
<th>Random Search</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Coverage</strong></td>
<td>100% exhaustive</td>
<td>Probabilistic sampling</td>
</tr>
<tr>
<td><strong>Scalability</strong></td>
<td>Poor (exponential)</td>
<td>Excellent (linear)</td>
</tr>
<tr>
<td><strong>Continuous params</strong></td>
<td>❌ No</td>
<td>✅ Yes</td>
</tr>
<tr>
<td><strong>Dimensions</strong></td>
<td>Best for &lt;5</td>
<td>Best for &gt;5</td>
</tr>
<tr>
<td><strong>Deterministic</strong></td>
<td>✅ Always</td>
<td>✅ With seed</td>
</tr>
<tr>
<td><strong>Early stopping</strong></td>
<td>⚠️ Limited value</td>
<td>✅ Very effective</td>
</tr>
<tr>
<td><strong>Parallel execution</strong></td>
<td>✅ Yes</td>
<td>✅ Yes</td>
</tr>
<tr>
<td><strong>Distribution control</strong></td>
<td>❌ No</td>
<td>✅ Yes (uniform/log/normal)</td>
</tr>
</tbody>
</table>
<p><strong>When to Choose Random Search</strong>:
1. ✅ High-dimensional spaces (&gt;5 parameters)
2. ✅ Continuous parameter ranges
3. ✅ Limited time/compute budget
4. ✅ Unknown parameter importance
5. ✅ Quick exploration phase</p>
<p><strong>When to Choose Grid Search</strong>:
1. ✅ Low-dimensional spaces (&lt;5 parameters)
2. ✅ Small discrete parameter sets
3. ✅ Need guaranteed complete coverage
4. ✅ All parameters equally important
5. ✅ Compliance/validation requirements</p>
<p><strong>Recommended Sample Counts</strong>:
- Small spaces (&lt;5 params): 50-100 samples
- Medium spaces (5-10 params): 100-500 samples
- Large spaces (&gt;10 params): 500-1000 samples
- Rule of thumb: 10-100× number of parameters</p>
<p><strong>Example Use Cases</strong>:
1. <strong>Initial Exploration</strong>: Run Random Search (100 samples) to identify promising regions, then refine with Bayesian optimization
2. <strong>Continuous Parameters</strong>: Moving average periods (10.5, 23.7 instead of discrete 10, 20, 30)
3. <strong>Scale-Variant Parameters</strong>: Learning rates, decay factors using log-uniform distribution
4. <strong>Limited Budget</strong>: Need results in 1 hour, Random Search finds 95% optimal in 33% of time</p>
<h3 id="bayesian-optimization-algorithm-story-54">Bayesian Optimization Algorithm (Story 5.4) ✅<a class="headerlink" href="#bayesian-optimization-algorithm-story-54" title="Permanent link">&para;</a></h3>
<p><strong>Status</strong>: Implemented</p>
<p>Bayesian optimization uses Gaussian Process surrogate models to intelligently suggest parameters, balancing exploration (uncertain regions) and exploitation (promising regions). More sample-efficient than grid/random search for expensive objective functions.</p>
<h4 id="key-features">Key Features<a class="headerlink" href="#key-features" title="Permanent link">&para;</a></h4>
<ol>
<li><strong>Gaussian Process Surrogate</strong>: Models objective function as probability distribution over functions</li>
<li><strong>Acquisition Functions</strong>: Three strategies for balancing exploration/exploitation:</li>
<li><strong>Expected Improvement (EI)</strong>: Default, balanced (maximizes expected improvement over current best)</li>
<li><strong>Probability of Improvement (PI)</strong>: Conservative (maximizes probability of any improvement)</li>
<li><strong>Upper Confidence Bound (UCB/LCB)</strong>: Exploration control via kappa parameter</li>
<li><strong>Prior Knowledge Seeding</strong>: Warm-start with known good parameters</li>
<li><strong>Convergence Detection</strong>: Early stopping when acquisition function plateaus</li>
<li><strong>Visualization</strong>: Plot convergence, parameter importance, and evaluations</li>
</ol>
<h4 id="when-to-use-bayesian-optimization">When to Use Bayesian Optimization<a class="headerlink" href="#when-to-use-bayesian-optimization" title="Permanent link">&para;</a></h4>
<p><strong>Best for:</strong>
- Expensive objective functions (minutes per evaluation)
- Moderate parameter count (2-20 parameters)
- Continuous parameter spaces
- Sequential optimization (not massively parallel)
- Limited evaluation budget (&lt;100 iterations)</p>
<p><strong>Avoid when:</strong>
- Very cheap objectives (&lt;1 second) → Random Search faster
- Very high dimensions (&gt;20 params) → Curse of dimensionality
- Need strict guarantees → Grid Search for exhaustive coverage
- Massively parallel (1000+ workers) → Random Search parallelizes better</p>
<h4 id="usage-example">Usage Example<a class="headerlink" href="#usage-example" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="kn">from</span> <span class="nn">rustybt.optimization.parameter_space</span> <span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>    <span class="n">ParameterSpace</span><span class="p">,</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>    <span class="n">ContinuousParameter</span><span class="p">,</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>    <span class="n">CategoricalParameter</span><span class="p">,</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="p">)</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="kn">from</span> <span class="nn">rustybt.optimization.search</span> <span class="kn">import</span> <span class="n">BayesianOptimizer</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="c1"># Define parameter space</span>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="n">param_space</span> <span class="o">=</span> <span class="n">ParameterSpace</span><span class="p">(</span>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>    <span class="n">parameters</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>        <span class="n">ContinuousParameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;lookback&quot;</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">100</span><span class="p">),</span>
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>        <span class="n">ContinuousParameter</span><span class="p">(</span>
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;threshold&quot;</span><span class="p">,</span>
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a>            <span class="n">min_value</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a>            <span class="n">max_value</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a>            <span class="n">prior</span><span class="o">=</span><span class="s2">&quot;log-uniform&quot;</span><span class="p">,</span>  <span class="c1"># Wide range</span>
<a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a>        <span class="p">),</span>
<a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a>        <span class="n">CategoricalParameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;ma_type&quot;</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ema&quot;</span><span class="p">,</span> <span class="s2">&quot;sma&quot;</span><span class="p">]),</span>
<a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a>    <span class="p">]</span>
<a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a><span class="p">)</span>
<a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a>
<a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a><span class="c1"># Create optimizer with Expected Improvement acquisition function</span>
<a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a><span class="n">optimizer</span> <span class="o">=</span> <span class="n">BayesianOptimizer</span><span class="p">(</span>
<a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a>    <span class="n">parameter_space</span><span class="o">=</span><span class="n">param_space</span><span class="p">,</span>
<a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a>    <span class="n">n_iter</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
<a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a>    <span class="n">acq_func</span><span class="o">=</span><span class="s2">&quot;EI&quot;</span><span class="p">,</span>  <span class="c1"># Expected Improvement</span>
<a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a>    <span class="n">kappa</span><span class="o">=</span><span class="mf">1.96</span><span class="p">,</span>  <span class="c1"># Exploration parameter for UCB</span>
<a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a>    <span class="n">xi</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>  <span class="c1"># Exploration parameter for EI/PI</span>
<a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a>    <span class="n">initial_points</span><span class="o">=</span><span class="p">[</span>  <span class="c1"># Optional: seed with prior knowledge</span>
<a id="__codelineno-15-30" name="__codelineno-15-30" href="#__codelineno-15-30"></a>        <span class="p">{</span><span class="s2">&quot;lookback&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;threshold&quot;</span><span class="p">:</span> <span class="mf">0.02</span><span class="p">,</span> <span class="s2">&quot;ma_type&quot;</span><span class="p">:</span> <span class="s2">&quot;ema&quot;</span><span class="p">}</span>
<a id="__codelineno-15-31" name="__codelineno-15-31" href="#__codelineno-15-31"></a>    <span class="p">],</span>
<a id="__codelineno-15-32" name="__codelineno-15-32" href="#__codelineno-15-32"></a>    <span class="n">initial_scores</span><span class="o">=</span><span class="p">[</span><span class="n">Decimal</span><span class="p">(</span><span class="s2">&quot;1.5&quot;</span><span class="p">)],</span>  <span class="c1"># Sharpe ratios for initial points</span>
<a id="__codelineno-15-33" name="__codelineno-15-33" href="#__codelineno-15-33"></a>    <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
<a id="__codelineno-15-34" name="__codelineno-15-34" href="#__codelineno-15-34"></a><span class="p">)</span>
<a id="__codelineno-15-35" name="__codelineno-15-35" href="#__codelineno-15-35"></a>
<a id="__codelineno-15-36" name="__codelineno-15-36" href="#__codelineno-15-36"></a><span class="c1"># Optimization loop</span>
<a id="__codelineno-15-37" name="__codelineno-15-37" href="#__codelineno-15-37"></a><span class="k">while</span> <span class="ow">not</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">is_complete</span><span class="p">():</span>
<a id="__codelineno-15-38" name="__codelineno-15-38" href="#__codelineno-15-38"></a>    <span class="n">params</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">suggest</span><span class="p">()</span>
<a id="__codelineno-15-39" name="__codelineno-15-39" href="#__codelineno-15-39"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">run_backtest</span><span class="p">(</span><span class="n">strategy</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
<a id="__codelineno-15-40" name="__codelineno-15-40" href="#__codelineno-15-40"></a>    <span class="n">optimizer</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;sharpe_ratio&quot;</span><span class="p">])</span>
<a id="__codelineno-15-41" name="__codelineno-15-41" href="#__codelineno-15-41"></a>
<a id="__codelineno-15-42" name="__codelineno-15-42" href="#__codelineno-15-42"></a><span class="c1"># Get best parameters</span>
<a id="__codelineno-15-43" name="__codelineno-15-43" href="#__codelineno-15-43"></a><span class="n">best_params</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">get_best_params</span><span class="p">()</span>
<a id="__codelineno-15-44" name="__codelineno-15-44" href="#__codelineno-15-44"></a><span class="n">best_score</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">get_best_score</span><span class="p">()</span>
<a id="__codelineno-15-45" name="__codelineno-15-45" href="#__codelineno-15-45"></a>
<a id="__codelineno-15-46" name="__codelineno-15-46" href="#__codelineno-15-46"></a><span class="c1"># Visualize results</span>
<a id="__codelineno-15-47" name="__codelineno-15-47" href="#__codelineno-15-47"></a><span class="n">optimizer</span><span class="o">.</span><span class="n">plot_convergence</span><span class="p">(</span><span class="n">save_path</span><span class="o">=</span><span class="s2">&quot;convergence.png&quot;</span><span class="p">)</span>
<a id="__codelineno-15-48" name="__codelineno-15-48" href="#__codelineno-15-48"></a><span class="n">optimizer</span><span class="o">.</span><span class="n">plot_objective</span><span class="p">(</span><span class="n">save_path</span><span class="o">=</span><span class="s2">&quot;param_importance.png&quot;</span><span class="p">)</span>
<a id="__codelineno-15-49" name="__codelineno-15-49" href="#__codelineno-15-49"></a><span class="n">optimizer</span><span class="o">.</span><span class="n">plot_evaluations</span><span class="p">(</span><span class="n">save_path</span><span class="o">=</span><span class="s2">&quot;evaluations.png&quot;</span><span class="p">)</span>
</code></pre></div>
<h4 id="acquisition-functions-explained">Acquisition Functions Explained<a class="headerlink" href="#acquisition-functions-explained" title="Permanent link">&para;</a></h4>
<p><strong>Expected Improvement (EI)</strong> - <em>Default, balanced</em>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="n">acq_func</span><span class="o">=</span><span class="s2">&quot;EI&quot;</span><span class="p">,</span> <span class="n">xi</span><span class="o">=</span><span class="mf">0.01</span>
</code></pre></div>
- Maximizes expected improvement over current best
- Balanced exploration/exploitation
- <code>xi=0.0</code>: Pure exploitation (greedy)
- <code>xi=0.01</code>: Balanced (default)
- <code>xi=0.1</code>: High exploration</p>
<p><strong>Probability of Improvement (PI)</strong> - <em>Conservative</em>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="n">acq_func</span><span class="o">=</span><span class="s2">&quot;PI&quot;</span><span class="p">,</span> <span class="n">xi</span><span class="o">=</span><span class="mf">0.01</span>
</code></pre></div>
- Maximizes probability of any improvement
- More conservative than EI
- Good when small improvements are valuable</p>
<p><strong>Upper Confidence Bound (UCB)</strong> - <em>Exploration control</em>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="n">acq_func</span><span class="o">=</span><span class="s2">&quot;LCB&quot;</span><span class="p">,</span> <span class="n">kappa</span><span class="o">=</span><span class="mf">1.96</span>  <span class="c1"># Note: skopt uses LCB (Lower Confidence Bound)</span>
</code></pre></div>
- Balances mean prediction and uncertainty
- Formula: mean + kappa × std
- <code>kappa=0.0</code>: Pure exploitation (greedy)
- <code>kappa=1.96</code>: Balanced (95% confidence interval)
- <code>kappa=3.0</code>: High exploration</p>
<h4 id="prior-knowledge-seeding">Prior Knowledge Seeding<a class="headerlink" href="#prior-knowledge-seeding" title="Permanent link">&para;</a></h4>
<p>Accelerate optimization by providing known good parameters:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="c1"># Known parameters from previous optimization run</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="n">initial_points</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>    <span class="p">{</span><span class="s2">&quot;lookback&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;threshold&quot;</span><span class="p">:</span> <span class="mf">0.02</span><span class="p">,</span> <span class="s2">&quot;ma_type&quot;</span><span class="p">:</span> <span class="s2">&quot;ema&quot;</span><span class="p">},</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>    <span class="p">{</span><span class="s2">&quot;lookback&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;threshold&quot;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span> <span class="s2">&quot;ma_type&quot;</span><span class="p">:</span> <span class="s2">&quot;sma&quot;</span><span class="p">},</span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="p">]</span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="n">initial_scores</span> <span class="o">=</span> <span class="p">[</span><span class="n">Decimal</span><span class="p">(</span><span class="s2">&quot;1.5&quot;</span><span class="p">),</span> <span class="n">Decimal</span><span class="p">(</span><span class="s2">&quot;1.3&quot;</span><span class="p">)]</span>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a>
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="n">optimizer</span> <span class="o">=</span> <span class="n">BayesianOptimizer</span><span class="p">(</span>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a>    <span class="n">parameter_space</span><span class="o">=</span><span class="n">param_space</span><span class="p">,</span>
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a>    <span class="n">n_iter</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a>    <span class="n">initial_points</span><span class="o">=</span><span class="n">initial_points</span><span class="p">,</span>
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a>    <span class="n">initial_scores</span><span class="o">=</span><span class="n">initial_scores</span><span class="p">,</span>
<a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a><span class="p">)</span>
</code></pre></div>
<p>This "warm-starts" the Gaussian Process, enabling it to focus search on promising regions immediately.</p>
<h4 id="convergence-detection">Convergence Detection<a class="headerlink" href="#convergence-detection" title="Permanent link">&para;</a></h4>
<p>Bayesian optimization can stop early when converged:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="n">optimizer</span> <span class="o">=</span> <span class="n">BayesianOptimizer</span><span class="p">(</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>    <span class="n">parameter_space</span><span class="o">=</span><span class="n">param_space</span><span class="p">,</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>    <span class="n">n_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>    <span class="n">convergence_threshold</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span>  <span class="c1"># Stop if improvement &lt; threshold</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>    <span class="n">convergence_patience</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>  <span class="c1"># for 10 consecutive iterations</span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="p">)</span>
</code></pre></div>
<p>This saves evaluations when the optimizer has found a good solution and further iterations show diminishing returns.</p>
<h4 id="performance-expectations">Performance Expectations<a class="headerlink" href="#performance-expectations" title="Permanent link">&para;</a></h4>
<p>Research (Snoek et al., 2012): <em>"Bayesian optimization can find good hyperparameters in 10-20 evaluations, compared to 100+ for random search."</em></p>
<p><strong>Example Benchmark</strong> (5D Rastrigin function):
- <strong>Grid Search</strong> (5^5=3125 points): 1562 evaluations to reach 95% of optimum
- <strong>Bayesian Optimization</strong>: 50 evaluations to reach 95% of optimum
- <strong>Speedup</strong>: 31× faster</p>
<p><strong>Real-World Example</strong> (5-parameter momentum strategy):
- <strong>Bayesian (EI)</strong>: Sharpe 1.17 in 27 iterations (early convergence)
- <strong>Bayesian + Prior</strong>: Sharpe 1.24 in 11 iterations
- <strong>Random Search</strong>: Sharpe 0.68 in 50 iterations
- <strong>Improvement</strong>: +71% better result with half the evaluations</p>
<h4 id="technical-implementation">Technical Implementation<a class="headerlink" href="#technical-implementation" title="Permanent link">&para;</a></h4>
<p><strong>Library</strong>: <a href="https://scikit-optimize.github.io/">scikit-optimize</a> v0.9.0+</p>
<p><strong>Key Components</strong>:
1. <code>skopt.Optimizer</code>: Main optimization engine
2. <code>skopt.space.Real/Integer/Categorical</code>: Parameter space dimensions
3. Gaussian Process Regressor: Surrogate model (scikit-learn backend)
4. Acquisition function optimization: Finds next point to evaluate</p>
<p><strong>State Management</strong>:
- Full state serialization via pickle (includes Gaussian Process model)
- Checkpoint/resume support
- All evaluations and scores tracked</p>
<p><strong>Discrete Parameter Handling</strong>:
- skopt's <code>Integer</code> doesn't understand step constraints
- BayesianOptimizer automatically rounds integer suggestions to valid steps
- Ensures compatibility with <code>DiscreteParameter(step=...)</code> definitions</p>
<h4 id="limitations">Limitations<a class="headerlink" href="#limitations" title="Permanent link">&para;</a></h4>
<ol>
<li><strong>Dimensionality</strong>: Performance degrades with &gt;20 parameters (curse of dimensionality)</li>
<li><strong>Categorical Handling</strong>: Gaussian Process struggles with many categorical values</li>
<li><strong>Sequential</strong>: Bayesian optimization is inherently sequential (limited parallelism)</li>
<li><strong>Overhead</strong>: Surrogate model training adds overhead (not worth it for cheap objectives)</li>
</ol>
<h4 id="comparison-with-other-algorithms">Comparison with Other Algorithms<a class="headerlink" href="#comparison-with-other-algorithms" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Algorithm</th>
<th>Evaluations</th>
<th>Best For</th>
<th>Parallelism</th>
<th>Sample Efficiency</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Grid Search</strong></td>
<td>O(n^k)</td>
<td>Exhaustive, low-dim</td>
<td>High</td>
<td>Low</td>
</tr>
<tr>
<td><strong>Random Search</strong></td>
<td>User-defined</td>
<td>High-dim, cheap objectives</td>
<td>High</td>
<td>Medium</td>
</tr>
<tr>
<td><strong>Bayesian Opt</strong></td>
<td>10-100</td>
<td>Expensive objectives, moderate-dim</td>
<td>Low</td>
<td><strong>High</strong></td>
</tr>
<tr>
<td>Genetic Algorithm</td>
<td>1000+</td>
<td>Exploration, discrete</td>
<td>Medium</td>
<td>Medium</td>
</tr>
</tbody>
</table>
<p><strong>Rule of Thumb</strong>:
- 1-3 parameters → Grid Search
- 4-7 parameters, expensive objective → <strong>Bayesian Optimization</strong>
- 8-20 parameters, cheap objective → Random Search
- 20+ parameters → Random Search or Genetic Algorithm</p>
<h4 id="example-bayesian-vs-grid-vs-random">Example: Bayesian vs Grid vs Random<a class="headerlink" href="#example-bayesian-vs-grid-vs-random" title="Permanent link">&para;</a></h4>
<p>See <a href="../../examples/optimization/bayesian_optimization_5param.py">examples/optimization/bayesian_optimization_5param.py</a> for a complete comparison on a 5-parameter momentum strategy.</p>
<p><strong>Results Summary</strong> (50 evaluations each):
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>1. Bayesian (EI):     Sharpe 1.17 (converged early at iteration 27)
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>2. Bayesian + Prior:  Sharpe 1.24 (converged at iteration 11)
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>3. Random Search:     Sharpe 0.68 (full 50 iterations)
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>Bayesian improvement over Random: +71%
</code></pre></div></p>
<p>The example demonstrates:
- Bayesian finds better solutions with fewer evaluations
- Prior knowledge significantly accelerates convergence
- Acquisition functions intelligently balance exploration/exploitation
- Visualization tools help understand optimization behavior</p>
<h3 id="genetic-algorithm-story-55">Genetic Algorithm (Story 5.5) ✅<a class="headerlink" href="#genetic-algorithm-story-55" title="Permanent link">&para;</a></h3>
<p><strong>Status</strong>: Implemented</p>
<p>Genetic Algorithm (GA) uses evolutionary principles (selection, crossover, mutation) to optimize parameters. Excels on non-smooth, multimodal landscapes where Bayesian optimization struggles.</p>
<h4 id="key-features_1">Key Features<a class="headerlink" href="#key-features_1" title="Permanent link">&para;</a></h4>
<ol>
<li><strong>Population-Based Search</strong>: Maintains population of candidate solutions evolving over generations</li>
<li><strong>Selection Operators</strong>: Three strategies for selecting parents:</li>
<li><strong>Tournament Selection</strong>: Select best from random subset (default, balanced)</li>
<li><strong>Roulette Wheel Selection</strong>: Fitness-proportional selection</li>
<li><strong>Rank-Based Selection</strong>: Based on fitness rank, robust to outliers</li>
<li><strong>Crossover Operator</strong>: Combines parameters from two parents</li>
<li>Blend crossover (BLX-α) for continuous parameters</li>
<li>Uniform crossover for categorical parameters</li>
<li>Respects parameter bounds</li>
<li><strong>Mutation Operator</strong>: Adds variation to population</li>
<li>Gaussian mutation for continuous parameters</li>
<li>Uniform mutation for categorical parameters</li>
<li>Configurable mutation probability</li>
<li><strong>Elitism</strong>: Preserves best individuals across generations (prevents losing optimal solutions)</li>
<li><strong>Diversity Tracking</strong>: Monitors population diversity to detect premature convergence</li>
<li><strong>Multiple Termination Criteria</strong>: Max generations, fitness plateau, target fitness, time limit</li>
</ol>
<h4 id="when-to-use-genetic-algorithms">When to Use Genetic Algorithms<a class="headerlink" href="#when-to-use-genetic-algorithms" title="Permanent link">&para;</a></h4>
<p><strong>Best for:</strong>
- Non-smooth or discontinuous objective functions
- Multimodal landscapes with many local optima
- Mixed parameter types (continuous + discrete + categorical)
- Cheap evaluations (GA needs 100s-1000s of evaluations)
- Exploration important (want diverse solutions)</p>
<p><strong>Avoid when:</strong>
- Smooth, unimodal objectives → Bayesian optimization more sample-efficient
- Expensive evaluations → Each backtest takes minutes/hours
- Very high dimensions → &gt;50 parameters (curse of dimensionality)
- Limited evaluation budget → &lt;100 evaluations</p>
<h4 id="usage-example_1">Usage Example<a class="headerlink" href="#usage-example_1" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="kn">from</span> <span class="nn">rustybt.optimization.parameter_space</span> <span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>    <span class="n">ParameterSpace</span><span class="p">,</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>    <span class="n">ContinuousParameter</span><span class="p">,</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>    <span class="n">DiscreteParameter</span><span class="p">,</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>    <span class="n">CategoricalParameter</span><span class="p">,</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="p">)</span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="kn">from</span> <span class="nn">rustybt.optimization.search</span> <span class="kn">import</span> <span class="n">GeneticAlgorithm</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="c1"># Define parameter space</span>
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="n">param_space</span> <span class="o">=</span> <span class="n">ParameterSpace</span><span class="p">(</span>
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a>    <span class="n">parameters</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a>        <span class="n">ContinuousParameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;lookback&quot;</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">100</span><span class="p">),</span>
<a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a>        <span class="n">DiscreteParameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;rebalance&quot;</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
<a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a>        <span class="n">CategoricalParameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;method&quot;</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;sma&quot;</span><span class="p">,</span> <span class="s2">&quot;ema&quot;</span><span class="p">,</span> <span class="s2">&quot;wma&quot;</span><span class="p">]),</span>
<a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a>    <span class="p">]</span>
<a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a><span class="p">)</span>
<a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a>
<a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a><span class="c1"># Create genetic algorithm</span>
<a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a><span class="n">ga</span> <span class="o">=</span> <span class="n">GeneticAlgorithm</span><span class="p">(</span>
<a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a>    <span class="n">parameter_space</span><span class="o">=</span><span class="n">param_space</span><span class="p">,</span>
<a id="__codelineno-22-21" name="__codelineno-22-21" href="#__codelineno-22-21"></a>    <span class="n">population_size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>  <span class="c1"># Number of individuals</span>
<a id="__codelineno-22-22" name="__codelineno-22-22" href="#__codelineno-22-22"></a>    <span class="n">max_generations</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>  <span class="c1"># Maximum generations</span>
<a id="__codelineno-22-23" name="__codelineno-22-23" href="#__codelineno-22-23"></a>    <span class="n">selection</span><span class="o">=</span><span class="s2">&quot;tournament&quot;</span><span class="p">,</span>  <span class="c1"># Selection method</span>
<a id="__codelineno-22-24" name="__codelineno-22-24" href="#__codelineno-22-24"></a>    <span class="n">tournament_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>  <span class="c1"># Tournament size</span>
<a id="__codelineno-22-25" name="__codelineno-22-25" href="#__codelineno-22-25"></a>    <span class="n">crossover_prob</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>  <span class="c1"># Crossover probability</span>
<a id="__codelineno-22-26" name="__codelineno-22-26" href="#__codelineno-22-26"></a>    <span class="n">mutation_prob</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>  <span class="c1"># Mutation probability</span>
<a id="__codelineno-22-27" name="__codelineno-22-27" href="#__codelineno-22-27"></a>    <span class="n">elite_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>  <span class="c1"># Preserve top 5 individuals</span>
<a id="__codelineno-22-28" name="__codelineno-22-28" href="#__codelineno-22-28"></a>    <span class="n">patience</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>  <span class="c1"># Early stopping: stop if no improvement for 15 generations</span>
<a id="__codelineno-22-29" name="__codelineno-22-29" href="#__codelineno-22-29"></a>    <span class="n">diversity_threshold</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>  <span class="c1"># Warn if diversity &lt; 1%</span>
<a id="__codelineno-22-30" name="__codelineno-22-30" href="#__codelineno-22-30"></a>    <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>  <span class="c1"># Reproducible results</span>
<a id="__codelineno-22-31" name="__codelineno-22-31" href="#__codelineno-22-31"></a><span class="p">)</span>
<a id="__codelineno-22-32" name="__codelineno-22-32" href="#__codelineno-22-32"></a>
<a id="__codelineno-22-33" name="__codelineno-22-33" href="#__codelineno-22-33"></a><span class="c1"># Optimization loop</span>
<a id="__codelineno-22-34" name="__codelineno-22-34" href="#__codelineno-22-34"></a><span class="k">while</span> <span class="ow">not</span> <span class="n">ga</span><span class="o">.</span><span class="n">is_complete</span><span class="p">():</span>
<a id="__codelineno-22-35" name="__codelineno-22-35" href="#__codelineno-22-35"></a>    <span class="n">params</span> <span class="o">=</span> <span class="n">ga</span><span class="o">.</span><span class="n">suggest</span><span class="p">()</span>
<a id="__codelineno-22-36" name="__codelineno-22-36" href="#__codelineno-22-36"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">run_backtest</span><span class="p">(</span><span class="n">strategy</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
<a id="__codelineno-22-37" name="__codelineno-22-37" href="#__codelineno-22-37"></a>    <span class="n">ga</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;sharpe_ratio&quot;</span><span class="p">])</span>
<a id="__codelineno-22-38" name="__codelineno-22-38" href="#__codelineno-22-38"></a>
<a id="__codelineno-22-39" name="__codelineno-22-39" href="#__codelineno-22-39"></a>    <span class="c1"># Monitor progress</span>
<a id="__codelineno-22-40" name="__codelineno-22-40" href="#__codelineno-22-40"></a>    <span class="k">if</span> <span class="n">ga</span><span class="o">.</span><span class="n">_current_individual_idx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Generation complete</span>
<a id="__codelineno-22-41" name="__codelineno-22-41" href="#__codelineno-22-41"></a>        <span class="n">history</span> <span class="o">=</span> <span class="n">ga</span><span class="o">.</span><span class="n">get_generation_history</span><span class="p">()</span>
<a id="__codelineno-22-42" name="__codelineno-22-42" href="#__codelineno-22-42"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generation </span><span class="si">{</span><span class="n">ga</span><span class="o">.</span><span class="n">current_generation</span><span class="si">}</span><span class="s2">: &quot;</span>
<a id="__codelineno-22-43" name="__codelineno-22-43" href="#__codelineno-22-43"></a>              <span class="sa">f</span><span class="s2">&quot;Best=</span><span class="si">{</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;best_fitness&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, &quot;</span>
<a id="__codelineno-22-44" name="__codelineno-22-44" href="#__codelineno-22-44"></a>              <span class="sa">f</span><span class="s2">&quot;Avg=</span><span class="si">{</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;avg_fitness&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, &quot;</span>
<a id="__codelineno-22-45" name="__codelineno-22-45" href="#__codelineno-22-45"></a>              <span class="sa">f</span><span class="s2">&quot;Diversity=</span><span class="si">{</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;diversity&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-22-46" name="__codelineno-22-46" href="#__codelineno-22-46"></a>
<a id="__codelineno-22-47" name="__codelineno-22-47" href="#__codelineno-22-47"></a><span class="c1"># Get best parameters</span>
<a id="__codelineno-22-48" name="__codelineno-22-48" href="#__codelineno-22-48"></a><span class="n">best_params</span> <span class="o">=</span> <span class="n">ga</span><span class="o">.</span><span class="n">get_best_params</span><span class="p">()</span>
<a id="__codelineno-22-49" name="__codelineno-22-49" href="#__codelineno-22-49"></a><span class="n">best_score</span> <span class="o">=</span> <span class="n">ga</span><span class="o">.</span><span class="n">get_best_result</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-22-50" name="__codelineno-22-50" href="#__codelineno-22-50"></a>
<a id="__codelineno-22-51" name="__codelineno-22-51" href="#__codelineno-22-51"></a><span class="c1"># Analyze evolution</span>
<a id="__codelineno-22-52" name="__codelineno-22-52" href="#__codelineno-22-52"></a><span class="n">history</span> <span class="o">=</span> <span class="n">ga</span><span class="o">.</span><span class="n">get_generation_history</span><span class="p">()</span>
<a id="__codelineno-22-53" name="__codelineno-22-53" href="#__codelineno-22-53"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generations run: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;generation&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-22-54" name="__codelineno-22-54" href="#__codelineno-22-54"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Final diversity: </span><span class="si">{</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;diversity&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-22-55" name="__codelineno-22-55" href="#__codelineno-22-55"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fitness improvement: </span><span class="si">{</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;best_fitness&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;best_fitness&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h4 id="operator-configuration-guide">Operator Configuration Guide<a class="headerlink" href="#operator-configuration-guide" title="Permanent link">&para;</a></h4>
<p><strong>Selection Operators:</strong></p>
<ol>
<li><strong>Tournament Selection</strong> (default, recommended)
   <div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="n">selection</span><span class="o">=</span><span class="s2">&quot;tournament&quot;</span><span class="p">,</span> <span class="n">tournament_size</span><span class="o">=</span><span class="mi">3</span>
</code></pre></div></li>
<li>Randomly select K individuals, pick best</li>
<li>Balances diversity and selection pressure</li>
<li>
<p>Tournament size controls pressure: larger = more greedy</p>
</li>
<li>
<p><strong>Roulette Wheel Selection</strong>
   <div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="n">selection</span><span class="o">=</span><span class="s2">&quot;roulette&quot;</span>
</code></pre></div></p>
</li>
<li>Probability proportional to fitness</li>
<li>Can lead to premature convergence if fitness range is large</li>
<li>
<p>Good for evenly-distributed fitness</p>
</li>
<li>
<p><strong>Rank-Based Selection</strong>
   <div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="n">selection</span><span class="o">=</span><span class="s2">&quot;rank&quot;</span>
</code></pre></div></p>
</li>
<li>Based on fitness rank, not magnitude</li>
<li>Robust to fitness outliers</li>
<li>Maintains diversity better than roulette</li>
</ol>
<p><strong>Crossover Probability:</strong>
- <strong>0.7-0.9</strong>: Standard range (0.8 default)
- Higher → More exploitation (focus on combining good solutions)
- Lower → More reliance on mutation for exploration</p>
<p><strong>Mutation Probability:</strong>
- <strong>0.1-0.3</strong>: Standard range (0.2 default)
- Higher → More exploration (more variation)
- Lower → More exploitation (refinement)</p>
<p><strong>Elite Size:</strong>
- <strong>10-20% of population</strong>: Standard (default: 10%)
- Prevents losing best solutions
- Too large → Reduces diversity
- Too small → Risk losing best solutions</p>
<h4 id="diversity-tracking">Diversity Tracking<a class="headerlink" href="#diversity-tracking" title="Permanent link">&para;</a></h4>
<p>GA monitors population diversity to detect premature convergence:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="n">history</span> <span class="o">=</span> <span class="n">ga</span><span class="o">.</span><span class="n">get_generation_history</span><span class="p">()</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;generation&#39;</span><span class="p">],</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;diversity&#39;</span><span class="p">])</span>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">ga</span><span class="o">.</span><span class="n">diversity_threshold</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Threshold&#39;</span><span class="p">)</span>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Generation&#39;</span><span class="p">)</span>
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Population Diversity&#39;</span><span class="p">)</span>
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Diversity Over Generations&#39;</span><span class="p">)</span>
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<p><strong>Low diversity warning</strong>: Issued when diversity falls below threshold, indicating premature convergence risk. Solutions:
- Increase mutation probability
- Decrease elite size
- Increase population size
- Use rank-based selection (maintains diversity better)</p>
<h4 id="termination-criteria">Termination Criteria<a class="headerlink" href="#termination-criteria" title="Permanent link">&para;</a></h4>
<p>GA supports multiple termination conditions:</p>
<ol>
<li>
<p><strong>Max Generations</strong> (always active)
   <div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="n">max_generations</span><span class="o">=</span><span class="mi">100</span>
</code></pre></div></p>
</li>
<li>
<p><strong>Patience</strong> (early stopping)
   <div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="n">patience</span><span class="o">=</span><span class="mi">15</span>  <span class="c1"># Stop if no improvement for 15 generations</span>
</code></pre></div></p>
</li>
<li>
<p><strong>Target Fitness</strong>
   <div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="n">target_fitness</span><span class="o">=</span><span class="n">Decimal</span><span class="p">(</span><span class="s2">&quot;2.0&quot;</span><span class="p">)</span>  <span class="c1"># Stop if Sharpe ratio &gt;= 2.0</span>
</code></pre></div></p>
</li>
<li>
<p><strong>Time Limit</strong>
   <div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="n">max_time_seconds</span><span class="o">=</span><span class="mi">3600</span>  <span class="c1"># Stop after 1 hour</span>
</code></pre></div></p>
</li>
</ol>
<p>Termination reason available in <code>ga._termination_reason</code>.</p>
<h4 id="performance-expectations_1">Performance Expectations<a class="headerlink" href="#performance-expectations_1" title="Permanent link">&para;</a></h4>
<p><strong>Example Benchmark</strong> (2D Rastrigin function, 50 individuals × 50 generations):
- <strong>Genetic Algorithm</strong>: Score -0.15 (95% of optimum) in 2500 evaluations
- <strong>Bayesian Optimization</strong>: Score -5.42 (gets trapped in local optima) in 2500 evaluations
- <strong>GA Advantage</strong>: 36× better on non-smooth function</p>
<p><strong>Real-World Example</strong> (5-parameter strategy, non-smooth P&amp;L landscape):
- <strong>GA</strong>: Sharpe 1.82 in 1500 evaluations (30 gen × 50 pop)
- <strong>Bayesian</strong>: Sharpe 0.94 in 1500 evaluations (trapped in local optimum)
- <strong>Random</strong>: Sharpe 1.12 in 1500 evaluations
- <strong>GA Improvement</strong>: +94% over Bayesian, +63% over Random</p>
<h4 id="technical-implementation_1">Technical Implementation<a class="headerlink" href="#technical-implementation_1" title="Permanent link">&para;</a></h4>
<p><strong>Library</strong>: <a href="https://github.com/DEAP/deap">DEAP</a> v1.4.0+ (Distributed Evolutionary Algorithms in Python)</p>
<p><strong>Key Components</strong>:
1. <code>creator.Individual</code>: Population member with fitness attribute
2. <code>toolbox.select/mate/mutate</code>: Genetic operators
3. Population evolution: Selection → Crossover → Mutation → Elite preservation
4. Fitness tracking: Best/average fitness per generation</p>
<p><strong>State Management</strong>:
- Full state serialization via pickle (includes entire population)
- Checkpoint/resume support
- Generation history (best/avg fitness, diversity)
- All evaluations tracked</p>
<p><strong>Genotype Encoding</strong>:
- Continuous params: Float values
- Discrete params: Float values (rounded to valid steps)
- Categorical params: Float indices (converted to choices)</p>
<h4 id="comparison-ga-vs-bayesian-optimization">Comparison: GA vs Bayesian Optimization<a class="headerlink" href="#comparison-ga-vs-bayesian-optimization" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Characteristic</th>
<th>Genetic Algorithm</th>
<th>Bayesian Optimization</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Objective type</strong></td>
<td>Non-smooth, multimodal</td>
<td>Smooth, unimodal</td>
</tr>
<tr>
<td><strong>Evaluations needed</strong></td>
<td>1000-5000</td>
<td>20-100</td>
</tr>
<tr>
<td><strong>Parallelism</strong></td>
<td>High (population-based)</td>
<td>Low (sequential)</td>
</tr>
<tr>
<td><strong>Exploration</strong></td>
<td>Excellent (population diversity)</td>
<td>Good (acquisition function)</td>
</tr>
<tr>
<td><strong>Sample efficiency</strong></td>
<td>Medium</td>
<td><strong>High</strong></td>
</tr>
<tr>
<td><strong>Categorical params</strong></td>
<td>Excellent</td>
<td>Limited</td>
</tr>
<tr>
<td><strong>Local optima</strong></td>
<td>Escapes easily</td>
<td>Can get trapped</td>
</tr>
</tbody>
</table>
<p><strong>Rule of Thumb</strong>:
- Smooth objective + expensive evals → <strong>Bayesian Optimization</strong>
- Non-smooth objective + cheap evals → <strong>Genetic Algorithm</strong>
- Unknown landscape → Try both (Bayesian first, then GA if poor results)</p>
<h4 id="example-ga-on-non-smooth-function">Example: GA on Non-Smooth Function<a class="headerlink" href="#example-ga-on-non-smooth-function" title="Permanent link">&para;</a></h4>
<p>See <a href="../../examples/optimization/genetic_algorithm_nonsmooth.ipynb">examples/optimization/genetic_algorithm_nonsmooth.ipynb</a> for complete comparison on Rastrigin function.</p>
<p><strong>Visualization Example</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="c1"># Get generation history</span>
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="n">history</span> <span class="o">=</span> <span class="n">ga</span><span class="o">.</span><span class="n">get_generation_history</span><span class="p">()</span>
<a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a>
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a>
<a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a><span class="c1"># Plot 1: Fitness evolution</span>
<a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a><span class="n">ax1</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a><span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;generation&#39;</span><span class="p">],</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;best_fitness&#39;</span><span class="p">]],</span>
<a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a>         <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Best fitness&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a><span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;generation&#39;</span><span class="p">],</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;avg_fitness&#39;</span><span class="p">]],</span>
<a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a>         <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Avg fitness&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<a id="__codelineno-31-15" name="__codelineno-31-15" href="#__codelineno-31-15"></a><span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Generation&#39;</span><span class="p">)</span>
<a id="__codelineno-31-16" name="__codelineno-31-16" href="#__codelineno-31-16"></a><span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Fitness&#39;</span><span class="p">)</span>
<a id="__codelineno-31-17" name="__codelineno-31-17" href="#__codelineno-31-17"></a><span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Fitness Evolution&#39;</span><span class="p">)</span>
<a id="__codelineno-31-18" name="__codelineno-31-18" href="#__codelineno-31-18"></a><span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<a id="__codelineno-31-19" name="__codelineno-31-19" href="#__codelineno-31-19"></a><span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-31-20" name="__codelineno-31-20" href="#__codelineno-31-20"></a>
<a id="__codelineno-31-21" name="__codelineno-31-21" href="#__codelineno-31-21"></a><span class="c1"># Plot 2: Diversity tracking</span>
<a id="__codelineno-31-22" name="__codelineno-31-22" href="#__codelineno-31-22"></a><span class="n">ax2</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-31-23" name="__codelineno-31-23" href="#__codelineno-31-23"></a><span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;generation&#39;</span><span class="p">],</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;diversity&#39;</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
<a id="__codelineno-31-24" name="__codelineno-31-24" href="#__codelineno-31-24"></a><span class="n">ax2</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">ga</span><span class="o">.</span><span class="n">diversity_threshold</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
<a id="__codelineno-31-25" name="__codelineno-31-25" href="#__codelineno-31-25"></a>            <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Threshold (</span><span class="si">{</span><span class="n">ga</span><span class="o">.</span><span class="n">diversity_threshold</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
<a id="__codelineno-31-26" name="__codelineno-31-26" href="#__codelineno-31-26"></a><span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Generation&#39;</span><span class="p">)</span>
<a id="__codelineno-31-27" name="__codelineno-31-27" href="#__codelineno-31-27"></a><span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Population Diversity&#39;</span><span class="p">)</span>
<a id="__codelineno-31-28" name="__codelineno-31-28" href="#__codelineno-31-28"></a><span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Diversity Tracking&#39;</span><span class="p">)</span>
<a id="__codelineno-31-29" name="__codelineno-31-29" href="#__codelineno-31-29"></a><span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<a id="__codelineno-31-30" name="__codelineno-31-30" href="#__codelineno-31-30"></a><span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-31-31" name="__codelineno-31-31" href="#__codelineno-31-31"></a>
<a id="__codelineno-31-32" name="__codelineno-31-32" href="#__codelineno-31-32"></a><span class="c1"># Plot 3: Fitness improvement per generation</span>
<a id="__codelineno-31-33" name="__codelineno-31-33" href="#__codelineno-31-33"></a><span class="n">ax3</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-31-34" name="__codelineno-31-34" href="#__codelineno-31-34"></a><span class="n">best_fitness</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;best_fitness&#39;</span><span class="p">]]</span>
<a id="__codelineno-31-35" name="__codelineno-31-35" href="#__codelineno-31-35"></a><span class="n">improvement</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">best_fitness</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">best_fitness</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-31-36" name="__codelineno-31-36" href="#__codelineno-31-36"></a>                     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">best_fitness</span><span class="p">))]</span>
<a id="__codelineno-31-37" name="__codelineno-31-37" href="#__codelineno-31-37"></a><span class="n">ax3</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;generation&#39;</span><span class="p">],</span> <span class="n">improvement</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<a id="__codelineno-31-38" name="__codelineno-31-38" href="#__codelineno-31-38"></a><span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Generation&#39;</span><span class="p">)</span>
<a id="__codelineno-31-39" name="__codelineno-31-39" href="#__codelineno-31-39"></a><span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Fitness Improvement&#39;</span><span class="p">)</span>
<a id="__codelineno-31-40" name="__codelineno-31-40" href="#__codelineno-31-40"></a><span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Generation-to-Generation Improvement&#39;</span><span class="p">)</span>
<a id="__codelineno-31-41" name="__codelineno-31-41" href="#__codelineno-31-41"></a><span class="n">ax3</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-31-42" name="__codelineno-31-42" href="#__codelineno-31-42"></a>
<a id="__codelineno-31-43" name="__codelineno-31-43" href="#__codelineno-31-43"></a><span class="c1"># Plot 4: Convergence curve</span>
<a id="__codelineno-31-44" name="__codelineno-31-44" href="#__codelineno-31-44"></a><span class="n">ax4</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-31-45" name="__codelineno-31-45" href="#__codelineno-31-45"></a><span class="n">cumulative_evals</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">ga</span><span class="o">.</span><span class="n">population_size</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;generation&#39;</span><span class="p">]]</span>
<a id="__codelineno-31-46" name="__codelineno-31-46" href="#__codelineno-31-46"></a><span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cumulative_evals</span><span class="p">,</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;best_fitness&#39;</span><span class="p">]],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-31-47" name="__codelineno-31-47" href="#__codelineno-31-47"></a><span class="n">ax4</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Total Evaluations&#39;</span><span class="p">)</span>
<a id="__codelineno-31-48" name="__codelineno-31-48" href="#__codelineno-31-48"></a><span class="n">ax4</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Best Fitness&#39;</span><span class="p">)</span>
<a id="__codelineno-31-49" name="__codelineno-31-49" href="#__codelineno-31-49"></a><span class="n">ax4</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Convergence Curve&#39;</span><span class="p">)</span>
<a id="__codelineno-31-50" name="__codelineno-31-50" href="#__codelineno-31-50"></a><span class="n">ax4</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-31-51" name="__codelineno-31-51" href="#__codelineno-31-51"></a>
<a id="__codelineno-31-52" name="__codelineno-31-52" href="#__codelineno-31-52"></a><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<a id="__codelineno-31-53" name="__codelineno-31-53" href="#__codelineno-31-53"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></p>
<h4 id="configuration-recommendations">Configuration Recommendations<a class="headerlink" href="#configuration-recommendations" title="Permanent link">&para;</a></h4>
<p><strong>Small parameter space</strong> (2-5 parameters):
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="n">population_size</span><span class="o">=</span><span class="mi">30</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="n">max_generations</span><span class="o">=</span><span class="mi">50</span>
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="n">selection</span><span class="o">=</span><span class="s2">&quot;tournament&quot;</span>
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="n">tournament_size</span><span class="o">=</span><span class="mi">3</span>
<a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="n">crossover_prob</span><span class="o">=</span><span class="mf">0.8</span>
<a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a><span class="n">mutation_prob</span><span class="o">=</span><span class="mf">0.2</span>
<a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a><span class="n">elite_size</span><span class="o">=</span><span class="mi">3</span>
</code></pre></div></p>
<p><strong>Medium parameter space</strong> (6-15 parameters):
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="n">population_size</span><span class="o">=</span><span class="mi">50</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="n">max_generations</span><span class="o">=</span><span class="mi">100</span>
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="n">selection</span><span class="o">=</span><span class="s2">&quot;tournament&quot;</span>
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="n">tournament_size</span><span class="o">=</span><span class="mi">5</span>
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="n">crossover_prob</span><span class="o">=</span><span class="mf">0.8</span>
<a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="n">mutation_prob</span><span class="o">=</span><span class="mf">0.25</span>
<a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a><span class="n">elite_size</span><span class="o">=</span><span class="mi">5</span>
</code></pre></div></p>
<p><strong>Large parameter space</strong> (16-30 parameters):
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="n">population_size</span><span class="o">=</span><span class="mi">100</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="n">max_generations</span><span class="o">=</span><span class="mi">200</span>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="n">selection</span><span class="o">=</span><span class="s2">&quot;tournament&quot;</span>
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="n">tournament_size</span><span class="o">=</span><span class="mi">7</span>
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="n">crossover_prob</span><span class="o">=</span><span class="mf">0.7</span>
<a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="n">mutation_prob</span><span class="o">=</span><span class="mf">0.3</span>
<a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a><span class="n">elite_size</span><span class="o">=</span><span class="mi">10</span>
<a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a><span class="n">diversity_threshold</span><span class="o">=</span><span class="mf">0.05</span>  <span class="c1"># Higher threshold</span>
</code></pre></div></p>
<p><strong>Non-smooth objective</strong> (many local optima):
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="n">mutation_prob</span><span class="o">=</span><span class="mf">0.3</span>  <span class="c1"># Higher exploration</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="n">selection</span><span class="o">=</span><span class="s2">&quot;rank&quot;</span>  <span class="c1"># Better diversity maintenance</span>
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="n">patience</span><span class="o">=</span><span class="kc">None</span>  <span class="c1"># Disable early stopping</span>
</code></pre></div></p>
<p><strong>Smooth objective</strong> (few local optima):
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="n">mutation_prob</span><span class="o">=</span><span class="mf">0.15</span>  <span class="c1"># Lower exploration</span>
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="n">selection</span><span class="o">=</span><span class="s2">&quot;tournament&quot;</span>
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="n">tournament_size</span><span class="o">=</span><span class="mi">5</span>  <span class="c1"># Higher selection pressure</span>
<a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="n">patience</span><span class="o">=</span><span class="mi">20</span>  <span class="c1"># Enable early stopping</span>
</code></pre></div></p>
<h2 id="implementation-roadmap">Implementation Roadmap<a class="headerlink" href="#implementation-roadmap" title="Permanent link">&para;</a></h2>
<p>This design story (5.1) establishes the architecture. Subsequent stories implement:</p>
<ul>
<li><strong>Story 5.1</strong>: Optimization Framework Architecture ✅</li>
<li><strong>Story 5.2</strong>: Grid Search Algorithm ✅</li>
<li><strong>Story 5.3</strong>: Random Search Algorithm ✅</li>
<li><strong>Story 5.4</strong>: Bayesian Optimization (scikit-optimize integration) ✅</li>
<li><strong>Story 5.5</strong>: Genetic Algorithm (DEAP integration) ✅</li>
<li><strong>Story 5.6</strong>: Walk-Forward Optimization</li>
<li><strong>Story 5.7</strong>: Parallel Execution (multiprocessing + Ray)</li>
</ul>
<h2 id="technology-stack">Technology Stack<a class="headerlink" href="#technology-stack" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>pydantic 2.x</strong>: Parameter validation and config management</li>
<li><strong>structlog</strong>: Structured logging</li>
<li><strong>multiprocessing</strong>: Local parallelization (stdlib)</li>
<li><strong>ray</strong> (optional): Distributed execution</li>
<li><strong>scikit-optimize</strong>: Bayesian optimization (Story 5.3)</li>
<li><strong>DEAP</strong>: Genetic algorithms (Story 5.4)</li>
<li><strong>pyarrow/polars</strong>: Results storage and analysis</li>
</ul>
<h2 id="testing-strategy">Testing Strategy<a class="headerlink" href="#testing-strategy" title="Permanent link">&para;</a></h2>
<h3 id="unit-tests">Unit Tests<a class="headerlink" href="#unit-tests" title="Permanent link">&para;</a></h3>
<ul>
<li>Parameter space validation (bounds, types, uniqueness)</li>
<li>SearchAlgorithm interface compliance</li>
<li>ObjectiveFunction metric extraction</li>
<li>OptimizationResult serialization</li>
</ul>
<h3 id="integration-tests">Integration Tests<a class="headerlink" href="#integration-tests" title="Permanent link">&para;</a></h3>
<ul>
<li>Full optimization loop with simple backtest function</li>
<li>Checkpoint save/load with optimization resume</li>
<li>Parameter validation integration</li>
</ul>
<h3 id="property-tests-hypothesis">Property Tests (Hypothesis)<a class="headerlink" href="#property-tests-hypothesis" title="Permanent link">&para;</a></h3>
<ul>
<li>Parameter space invariants (all suggested params in bounds)</li>
<li>Optimization history ordering (trial IDs sequential)</li>
<li>Best result tracking (always best score seen)</li>
</ul>
<h3 id="no-mocking">No Mocking<a class="headerlink" href="#no-mocking" title="Permanent link">&para;</a></h3>
<ul>
<li>Use real search algorithms with simple parameter spaces</li>
<li>Use real backtest functions (minimal but functional)</li>
<li>All tests exercise actual optimization loops</li>
</ul>
<h2 id="design-review-checklist">Design Review Checklist<a class="headerlink" href="#design-review-checklist" title="Permanent link">&para;</a></h2>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Architecture diagram showing component relationships</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> SearchAlgorithm interface with required methods defined</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> ParameterSpace supporting continuous, discrete, categorical</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Parallel execution architecture (multiprocessing + Ray)</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Result storage with optimization history</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Checkpoint/resume support designed</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Backtest engine integration defined</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Extensibility validated (easy to add new algorithms)</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Full documentation with examples</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Design review by senior developer</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Design approved for implementation</li>
</ul>
<hr />
<h2 id="walk-forward-optimization">Walk-Forward Optimization<a class="headerlink" href="#walk-forward-optimization" title="Permanent link">&para;</a></h2>
<h3 id="overview_1">Overview<a class="headerlink" href="#overview_1" title="Permanent link">&para;</a></h3>
<p>Walk-forward optimization validates strategy robustness by testing on out-of-sample data across multiple time windows. This prevents overfitting to specific time periods and provides realistic performance expectations.</p>
<h3 id="architecture">Architecture<a class="headerlink" href="#architecture" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>graph TB
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>    subgraph &quot;Walk-Forward Process&quot;
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>        Data[Time-Series Data] --&gt; WindowGen[Window Generator]
<a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a>        WindowGen --&gt; W1[Window 1: Train/Val/Test]
<a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a>        WindowGen --&gt; W2[Window 2: Train/Val/Test]
<a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a>        WindowGen --&gt; W3[Window 3: Train/Val/Test]
<a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a>
<a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a>        W1 --&gt; Opt1[Optimize on Train]
<a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a>        Opt1 --&gt; Val1[Validate]
<a id="__codelineno-37-10" name="__codelineno-37-10" href="#__codelineno-37-10"></a>        Val1 --&gt; Test1[Test OOS]
<a id="__codelineno-37-11" name="__codelineno-37-11" href="#__codelineno-37-11"></a>
<a id="__codelineno-37-12" name="__codelineno-37-12" href="#__codelineno-37-12"></a>        W2 --&gt; Opt2[Optimize on Train]
<a id="__codelineno-37-13" name="__codelineno-37-13" href="#__codelineno-37-13"></a>        Opt2 --&gt; Val2[Validate]
<a id="__codelineno-37-14" name="__codelineno-37-14" href="#__codelineno-37-14"></a>        Val2 --&gt; Test2[Test OOS]
<a id="__codelineno-37-15" name="__codelineno-37-15" href="#__codelineno-37-15"></a>
<a id="__codelineno-37-16" name="__codelineno-37-16" href="#__codelineno-37-16"></a>        W3 --&gt; Opt3[Optimize on Train]
<a id="__codelineno-37-17" name="__codelineno-37-17" href="#__codelineno-37-17"></a>        Opt3 --&gt; Val3[Validate]
<a id="__codelineno-37-18" name="__codelineno-37-18" href="#__codelineno-37-18"></a>        Val3 --&gt; Test3[Test OOS]
<a id="__codelineno-37-19" name="__codelineno-37-19" href="#__codelineno-37-19"></a>
<a id="__codelineno-37-20" name="__codelineno-37-20" href="#__codelineno-37-20"></a>        Test1 --&gt; Agg[Aggregate Results]
<a id="__codelineno-37-21" name="__codelineno-37-21" href="#__codelineno-37-21"></a>        Test2 --&gt; Agg
<a id="__codelineno-37-22" name="__codelineno-37-22" href="#__codelineno-37-22"></a>        Test3 --&gt; Agg
<a id="__codelineno-37-23" name="__codelineno-37-23" href="#__codelineno-37-23"></a>
<a id="__codelineno-37-24" name="__codelineno-37-24" href="#__codelineno-37-24"></a>        Agg --&gt; ParamStability[Parameter Stability]
<a id="__codelineno-37-25" name="__codelineno-37-25" href="#__codelineno-37-25"></a>        Agg --&gt; PerfMetrics[Performance Metrics]
<a id="__codelineno-37-26" name="__codelineno-37-26" href="#__codelineno-37-26"></a>        Agg --&gt; OverfitDetect[Overfitting Detection]
<a id="__codelineno-37-27" name="__codelineno-37-27" href="#__codelineno-37-27"></a>    end
</code></pre></div>
<h3 id="window-types">Window Types<a class="headerlink" href="#window-types" title="Permanent link">&para;</a></h3>
<p><strong>Rolling Window</strong> (Fixed Size):
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>Window 1: [====Train====][Val][Test]
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>Window 2:      [====Train====][Val][Test]
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a>Window 3:           [====Train====][Val][Test]
</code></pre></div>
- Fixed window size slides forward
- Use when: Market regime relatively stable, want consistent data quantity</p>
<p><strong>Expanding Window</strong> (Growing Train):
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>Window 1: [====Train====][Val][Test]
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a>Window 2: [========Train========][Val][Test]
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a>Window 3: [============Train============][Val][Test]
</code></pre></div>
- Train window grows to include all historical data
- Use when: Want to incorporate all history, market evolves slowly</p>
<h3 id="key-components">Key Components<a class="headerlink" href="#key-components" title="Permanent link">&para;</a></h3>
<h4 id="1-windowconfig">1. WindowConfig<a class="headerlink" href="#1-windowconfig" title="Permanent link">&para;</a></h4>
<p>Configuration for walk-forward windows:
- <code>train_period</code>: Days for in-sample optimization
- <code>validation_period</code>: Days for parameter selection
- <code>test_period</code>: Days for out-of-sample testing
- <code>step_size</code>: Days to advance each window
- <code>window_type</code>: 'rolling' or 'expanding'</p>
<h4 id="2-windowdata">2. WindowData<a class="headerlink" href="#2-windowdata" title="Permanent link">&para;</a></h4>
<p>Data container for a single window with temporal ordering enforcement:
- Validates that validation starts after train ends
- Validates that test starts after validation ends
- Prevents lookahead bias at the data structure level</p>
<h4 id="3-walkforwardoptimizer">3. WalkForwardOptimizer<a class="headerlink" href="#3-walkforwardoptimizer" title="Permanent link">&para;</a></h4>
<p>Main orchestrator that:
- Generates windows from time-series data
- Runs optimization on train data
- Validates parameters on validation data
- Tests on out-of-sample test data
- Aggregates performance across all windows
- Analyzes parameter stability</p>
<h3 id="usage-pattern">Usage Pattern<a class="headerlink" href="#usage-pattern" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="kn">from</span> <span class="nn">rustybt.optimization</span> <span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>    <span class="n">ParameterSpace</span><span class="p">,</span>
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a>    <span class="n">DiscreteParameter</span><span class="p">,</span>
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a>    <span class="n">ObjectiveFunction</span><span class="p">,</span>
<a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="p">)</span>
<a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a><span class="kn">from</span> <span class="nn">rustybt.optimization.search</span> <span class="kn">import</span> <span class="n">RandomSearchAlgorithm</span>
<a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a><span class="kn">from</span> <span class="nn">rustybt.optimization.walk_forward</span> <span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a>    <span class="n">WalkForwardOptimizer</span><span class="p">,</span>
<a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a>    <span class="n">WindowConfig</span><span class="p">,</span>
<a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a><span class="p">)</span>
<a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a>
<a id="__codelineno-40-12" name="__codelineno-40-12" href="#__codelineno-40-12"></a><span class="c1"># Configure windows</span>
<a id="__codelineno-40-13" name="__codelineno-40-13" href="#__codelineno-40-13"></a><span class="n">config</span> <span class="o">=</span> <span class="n">WindowConfig</span><span class="p">(</span>
<a id="__codelineno-40-14" name="__codelineno-40-14" href="#__codelineno-40-14"></a>    <span class="n">train_period</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span>      <span class="c1"># 250 days for training</span>
<a id="__codelineno-40-15" name="__codelineno-40-15" href="#__codelineno-40-15"></a>    <span class="n">validation_period</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>  <span class="c1"># 50 days for validation</span>
<a id="__codelineno-40-16" name="__codelineno-40-16" href="#__codelineno-40-16"></a>    <span class="n">test_period</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>        <span class="c1"># 50 days for OOS testing</span>
<a id="__codelineno-40-17" name="__codelineno-40-17" href="#__codelineno-40-17"></a>    <span class="n">step_size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>          <span class="c1"># Advance 50 days each window</span>
<a id="__codelineno-40-18" name="__codelineno-40-18" href="#__codelineno-40-18"></a>    <span class="n">window_type</span><span class="o">=</span><span class="s1">&#39;rolling&#39;</span><span class="p">,</span> <span class="c1"># Fixed window size</span>
<a id="__codelineno-40-19" name="__codelineno-40-19" href="#__codelineno-40-19"></a><span class="p">)</span>
<a id="__codelineno-40-20" name="__codelineno-40-20" href="#__codelineno-40-20"></a>
<a id="__codelineno-40-21" name="__codelineno-40-21" href="#__codelineno-40-21"></a><span class="c1"># Create optimizer</span>
<a id="__codelineno-40-22" name="__codelineno-40-22" href="#__codelineno-40-22"></a><span class="n">wf_optimizer</span> <span class="o">=</span> <span class="n">WalkForwardOptimizer</span><span class="p">(</span>
<a id="__codelineno-40-23" name="__codelineno-40-23" href="#__codelineno-40-23"></a>    <span class="n">parameter_space</span><span class="o">=</span><span class="n">param_space</span><span class="p">,</span>
<a id="__codelineno-40-24" name="__codelineno-40-24" href="#__codelineno-40-24"></a>    <span class="n">search_algorithm_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">RandomSearchAlgorithm</span><span class="p">(</span>
<a id="__codelineno-40-25" name="__codelineno-40-25" href="#__codelineno-40-25"></a>        <span class="n">param_space</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span>
<a id="__codelineno-40-26" name="__codelineno-40-26" href="#__codelineno-40-26"></a>    <span class="p">),</span>
<a id="__codelineno-40-27" name="__codelineno-40-27" href="#__codelineno-40-27"></a>    <span class="n">objective_function</span><span class="o">=</span><span class="n">ObjectiveFunction</span><span class="p">(</span><span class="n">metric</span><span class="o">=</span><span class="s1">&#39;sharpe_ratio&#39;</span><span class="p">),</span>
<a id="__codelineno-40-28" name="__codelineno-40-28" href="#__codelineno-40-28"></a>    <span class="n">backtest_function</span><span class="o">=</span><span class="n">run_backtest</span><span class="p">,</span>
<a id="__codelineno-40-29" name="__codelineno-40-29" href="#__codelineno-40-29"></a>    <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
<a id="__codelineno-40-30" name="__codelineno-40-30" href="#__codelineno-40-30"></a>    <span class="n">max_trials_per_window</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-40-31" name="__codelineno-40-31" href="#__codelineno-40-31"></a><span class="p">)</span>
<a id="__codelineno-40-32" name="__codelineno-40-32" href="#__codelineno-40-32"></a>
<a id="__codelineno-40-33" name="__codelineno-40-33" href="#__codelineno-40-33"></a><span class="c1"># Run walk-forward optimization</span>
<a id="__codelineno-40-34" name="__codelineno-40-34" href="#__codelineno-40-34"></a><span class="n">result</span> <span class="o">=</span> <span class="n">wf_optimizer</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-40-35" name="__codelineno-40-35" href="#__codelineno-40-35"></a>
<a id="__codelineno-40-36" name="__codelineno-40-36" href="#__codelineno-40-36"></a><span class="c1"># Analyze results</span>
<a id="__codelineno-40-37" name="__codelineno-40-37" href="#__codelineno-40-37"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test Sharpe: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">aggregate_metrics</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">][</span><span class="s1">&#39;sharpe_ratio_mean&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-40-38" name="__codelineno-40-38" href="#__codelineno-40-38"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Parameter Stability: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">parameter_stability</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="overfitting-detection">Overfitting Detection<a class="headerlink" href="#overfitting-detection" title="Permanent link">&para;</a></h3>
<p>Walk-forward provides multiple overfitting indicators:</p>
<p><strong>1. Train vs Test Degradation</strong>
- Validation Sharpe = 2.0, Test Sharpe = 0.5 → Overfit!
- Validation Sharpe = 1.5, Test Sharpe = 1.4 → Robust</p>
<p><strong>2. Parameter Stability</strong>
- Low CV (coefficient of variation) → Stable, likely robust
- High CV → Parameters jump around, potentially overfit to noise</p>
<p><strong>3. Performance Variability</strong>
- Consistent test performance across windows → Robust
- Wild swings in test performance → Strategy sensitive to regime</p>
<h3 id="best-practices">Best Practices<a class="headerlink" href="#best-practices" title="Permanent link">&para;</a></h3>
<p><strong>Window Sizing</strong>:
- Train: 150-250 days for daily strategies
- Validation: 20-50 days (enough to measure performance)
- Test: 20-50 days (true out-of-sample)
- Step size: 25-50% of train period (balance coverage vs overlap)</p>
<p><strong>Interpretation</strong>:
- Focus on <strong>test metrics</strong> (out-of-sample reality)
- Parameter stability is a robustness indicator
- Consistent test &gt; validation suggests conservative validation period (good!)
- Test &lt;&lt; validation suggests overfitting (bad!)</p>
<p><strong>Configuration</strong>:
- Use rolling windows for stable markets
- Use expanding windows for evolving markets
- Smaller step size = more windows = better statistics (but slower)</p>
<h3 id="implementation-details">Implementation Details<a class="headerlink" href="#implementation-details" title="Permanent link">&para;</a></h3>
<p><strong>Lookahead Bias Prevention</strong>:
- WindowData validates temporal ordering in <strong>post_init</strong>
- Test data NEVER influences parameter selection
- Parameters selected based on validation performance only</p>
<p><strong>Performance Aggregation</strong>:
- Mean, median, std dev across all windows
- Separate metrics for train/validation/test
- Tracks all standard metrics (Sharpe, return, drawdown, win rate)</p>
<p><strong>Parameter Stability Analysis</strong>:
- Tracks optimal parameters for each window
- Calculates coefficient of variation (CV) for numeric parameters
- Flags parameters with CV &gt; 20% as unstable</p>
<hr />
<p><strong>Status</strong>: Ready for Review
<strong>Created</strong>: 2025-10-02
<strong>Updated</strong>: 2025-10-02 (Added Walk-Forward Optimization)
<strong>Author</strong>: James (Dev Agent)
<strong>Model</strong>: Claude Sonnet 4.5</p>
<h2 id="parameter-sensitivity-and-stability-analysis-story-58">Parameter Sensitivity and Stability Analysis (Story 5.8)<a class="headerlink" href="#parameter-sensitivity-and-stability-analysis-story-58" title="Permanent link">&para;</a></h2>
<h3 id="overview_2">Overview<a class="headerlink" href="#overview_2" title="Permanent link">&para;</a></h3>
<p>Parameter sensitivity analysis validates optimization results by measuring how performance varies across parameter ranges. This identifies <strong>robust parameters</strong> (stable performance) vs. <strong>sensitive parameters</strong> (potential overfitting).</p>
<p><strong>Purpose</strong>: Distinguish between truly optimal parameters and those overfit to specific values.</p>
<p><strong>Implementation</strong>: <code>rustybt/optimization/sensitivity.py</code></p>
<h3 id="core-concepts">Core Concepts<a class="headerlink" href="#core-concepts" title="Permanent link">&para;</a></h3>
<h4 id="sensitivity-vs-stability">Sensitivity vs. Stability<a class="headerlink" href="#sensitivity-vs-stability" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Sensitive Parameter</strong>: Performance changes sharply with small parameter changes (steep gradient, sharp peak)</li>
<li><strong>Stable (Robust) Parameter</strong>: Performance relatively flat across parameter range (gentle gradient, broad optimum)</li>
</ul>
<p><strong>Analogy</strong>:
- Robust parameter = Hilltop plateau (easy to stay on top)
- Sensitive parameter = Mountain peak (easy to fall off)</p>
<h4 id="overfitting-detection_1">Overfitting Detection<a class="headerlink" href="#overfitting-detection_1" title="Permanent link">&para;</a></h4>
<p>Parameters with high sensitivity are <strong>overfitting indicators</strong>:
- Optimal value sits on a "cliff edge"
- Small parameter change → large performance drop
- Likely won't generalize to new data</p>
<h3 id="sensitivity-analysis-workflow">Sensitivity Analysis Workflow<a class="headerlink" href="#sensitivity-analysis-workflow" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>graph TB
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>    A[Optimal Parameters&lt;br/&gt;from Optimization] --&gt; B[SensitivityAnalyzer]
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a>    B --&gt; C[Single-Parameter&lt;br/&gt;Variation]
<a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a>    B --&gt; D[Interaction&lt;br/&gt;Analysis]
<a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a>
<a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a>    C --&gt; E[Calculate Metrics]
<a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a>    E --&gt; F[Variance]
<a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a>    E --&gt; G[Gradient]
<a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a>    E --&gt; H[Curvature]
<a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a>
<a id="__codelineno-41-11" name="__codelineno-41-11" href="#__codelineno-41-11"></a>    F --&gt; I[Stability Score]
<a id="__codelineno-41-12" name="__codelineno-41-12" href="#__codelineno-41-12"></a>    G --&gt; I
<a id="__codelineno-41-13" name="__codelineno-41-13" href="#__codelineno-41-13"></a>    H --&gt; I
<a id="__codelineno-41-14" name="__codelineno-41-14" href="#__codelineno-41-14"></a>
<a id="__codelineno-41-15" name="__codelineno-41-15" href="#__codelineno-41-15"></a>    I --&gt; J{Classification}
<a id="__codelineno-41-16" name="__codelineno-41-16" href="#__codelineno-41-16"></a>    J --&gt;|Score &gt; 0.8| K[Robust]
<a id="__codelineno-41-17" name="__codelineno-41-17" href="#__codelineno-41-17"></a>    J --&gt;|0.5 &lt; Score ≤ 0.8| L[Moderate]
<a id="__codelineno-41-18" name="__codelineno-41-18" href="#__codelineno-41-18"></a>    J --&gt;|Score ≤ 0.5| M[Sensitive/Overfit]
<a id="__codelineno-41-19" name="__codelineno-41-19" href="#__codelineno-41-19"></a>
<a id="__codelineno-41-20" name="__codelineno-41-20" href="#__codelineno-41-20"></a>    D --&gt; N[2D Performance&lt;br/&gt;Surface]
<a id="__codelineno-41-21" name="__codelineno-41-21" href="#__codelineno-41-21"></a>    N --&gt; O[Cross-Derivative]
<a id="__codelineno-41-22" name="__codelineno-41-22" href="#__codelineno-41-22"></a>    O --&gt; P{Interaction?}
<a id="__codelineno-41-23" name="__codelineno-41-23" href="#__codelineno-41-23"></a>    P --&gt;|Yes| Q[Optimize Jointly]
<a id="__codelineno-41-24" name="__codelineno-41-24" href="#__codelineno-41-24"></a>    P --&gt;|No| R[Optimize Independently]
<a id="__codelineno-41-25" name="__codelineno-41-25" href="#__codelineno-41-25"></a>
<a id="__codelineno-41-26" name="__codelineno-41-26" href="#__codelineno-41-26"></a>    K --&gt; S[Generate Report]
<a id="__codelineno-41-27" name="__codelineno-41-27" href="#__codelineno-41-27"></a>    L --&gt; S
<a id="__codelineno-41-28" name="__codelineno-41-28" href="#__codelineno-41-28"></a>    M --&gt; S
<a id="__codelineno-41-29" name="__codelineno-41-29" href="#__codelineno-41-29"></a>    Q --&gt; S
<a id="__codelineno-41-30" name="__codelineno-41-30" href="#__codelineno-41-30"></a>    R --&gt; S
<a id="__codelineno-41-31" name="__codelineno-41-31" href="#__codelineno-41-31"></a>
<a id="__codelineno-41-32" name="__codelineno-41-32" href="#__codelineno-41-32"></a>    S --&gt; T[Recommendations]
</code></pre></div>
<h3 id="key-components_1">Key Components<a class="headerlink" href="#key-components_1" title="Permanent link">&para;</a></h3>
<h4 id="1-sensitivityanalyzer">1. SensitivityAnalyzer<a class="headerlink" href="#1-sensitivityanalyzer" title="Permanent link">&para;</a></h4>
<p><strong>Purpose</strong>: Orchestrate sensitivity analysis and generate reports</p>
<p><strong>Key Methods</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="k">class</span> <span class="nc">SensitivityAnalyzer</span><span class="p">:</span>
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>    <span class="k">def</span> <span class="nf">analyze</span><span class="p">(</span>
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a>        <span class="n">objective</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
<a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a>        <span class="n">param_ranges</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
<a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a>        <span class="n">calculate_ci</span><span class="p">:</span> <span class="nb">bool</span>
<a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">SensitivityResult</span><span class="p">]</span>
<a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a>
<a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a>    <span class="k">def</span> <span class="nf">analyze_interaction</span><span class="p">(</span>
<a id="__codelineno-42-9" name="__codelineno-42-9" href="#__codelineno-42-9"></a>        <span class="n">param1</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-42-10" name="__codelineno-42-10" href="#__codelineno-42-10"></a>        <span class="n">param2</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-42-11" name="__codelineno-42-11" href="#__codelineno-42-11"></a>        <span class="n">objective</span><span class="p">:</span> <span class="n">Callable</span>
<a id="__codelineno-42-12" name="__codelineno-42-12" href="#__codelineno-42-12"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InteractionResult</span>
<a id="__codelineno-42-13" name="__codelineno-42-13" href="#__codelineno-42-13"></a>
<a id="__codelineno-42-14" name="__codelineno-42-14" href="#__codelineno-42-14"></a>    <span class="k">def</span> <span class="nf">plot_sensitivity</span><span class="p">(</span><span class="n">parameter_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Figure</span>
<a id="__codelineno-42-15" name="__codelineno-42-15" href="#__codelineno-42-15"></a>    <span class="k">def</span> <span class="nf">plot_interaction</span><span class="p">(</span><span class="n">param1</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">param2</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Figure</span>
<a id="__codelineno-42-16" name="__codelineno-42-16" href="#__codelineno-42-16"></a>    <span class="k">def</span> <span class="nf">generate_report</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</code></pre></div></p>
<h4 id="2-single-parameter-variation">2. Single-Parameter Variation<a class="headerlink" href="#2-single-parameter-variation" title="Permanent link">&para;</a></h4>
<p><strong>Method</strong>: Vary one parameter while holding others constant at base values</p>
<p><strong>Process</strong>:
1. Fix base parameters: <code>{'lookback': 20, 'threshold': 0.02}</code>
2. Vary lookback: <code>[10, 12, 14, ..., 28, 30]</code> (threshold = 0.02)
3. Run backtest for each lookback value
4. Calculate stability metrics
5. Repeat for each parameter independently</p>
<p><strong>Example</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="n">analyzer</span> <span class="o">=</span> <span class="n">SensitivityAnalyzer</span><span class="p">(</span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>    <span class="n">base_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lookback&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;threshold&#39;</span><span class="p">:</span> <span class="mf">0.02</span><span class="p">},</span>
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a>    <span class="n">n_points</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>  <span class="c1"># Sample 20 points</span>
<a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a>    <span class="n">perturbation_pct</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>  <span class="c1"># ±50% around base</span>
<a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a><span class="p">)</span>
<a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a>
<a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a><span class="n">results</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="n">run_backtest</span><span class="p">)</span>
<a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a>
<a id="__codelineno-43-9" name="__codelineno-43-9" href="#__codelineno-43-9"></a><span class="c1"># Check stability</span>
<a id="__codelineno-43-10" name="__codelineno-43-10" href="#__codelineno-43-10"></a><span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;lookback&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">stability_score</span><span class="p">)</span>  <span class="c1"># 0.85 (robust)</span>
<a id="__codelineno-43-11" name="__codelineno-43-11" href="#__codelineno-43-11"></a><span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;threshold&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">stability_score</span><span class="p">)</span>  <span class="c1"># 0.42 (sensitive)</span>
</code></pre></div></p>
<h4 id="3-stability-metrics">3. Stability Metrics<a class="headerlink" href="#3-stability-metrics" title="Permanent link">&para;</a></h4>
<p><strong>Variance</strong> (performance spread):
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="n">variance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">objective_values</span><span class="p">)</span>
</code></pre></div>
- Low variance → Stable
- High variance → Sensitive</p>
<p><strong>Gradient</strong> (rate of change):
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="n">gradient</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">objective_values</span><span class="p">,</span> <span class="n">param_values</span><span class="p">)</span>
<a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="n">max_gradient</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gradient</span><span class="p">))</span>
</code></pre></div>
- Low gradient → Flat surface → Robust
- High gradient → Steep surface → Sensitive</p>
<p><strong>Curvature</strong> (convexity):
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="n">curvature</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">gradient</span><span class="p">,</span> <span class="n">param_values</span><span class="p">)</span>
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="n">max_curvature</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">curvature</span><span class="p">))</span>
</code></pre></div>
- Low curvature → Gradual → Stable
- High curvature → Sharp peak → Sensitive</p>
<p><strong>Stability Score</strong> (composite metric, 0-1):
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="n">instability</span> <span class="o">=</span> <span class="n">variance</span> <span class="o">+</span> <span class="n">max_gradient</span> <span class="o">+</span> <span class="n">max_curvature</span>
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="n">stability_score</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">instability</span><span class="p">)</span>  <span class="c1"># Higher = more stable</span>
</code></pre></div></p>
<p><strong>Classification</strong>:
| Score Range | Classification | Interpretation |
|-------------|----------------|----------------|
| &gt; 0.8       | <strong>Robust</strong>     | Safe to use, performance stable |
| 0.5 - 0.8   | <strong>Moderate</strong>   | Use with caution, monitor changes |
| &lt; 0.5       | <strong>Sensitive</strong>  | Overfit risk, consider alternatives |</p>
<h4 id="4-interaction-analysis">4. Interaction Analysis<a class="headerlink" href="#4-interaction-analysis" title="Permanent link">&para;</a></h4>
<p><strong>Purpose</strong>: Detect when parameters interact (optimizing one depends on value of another)</p>
<p><strong>Method</strong>: 2D grid search over parameter pairs</p>
<p><strong>Interaction Metric</strong> (cross-derivative):
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="c1"># If separable (no interaction): f(x,y) ≈ g(x) + h(y)</span>
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="c1"># Cross-derivative ≈ 0</span>
<a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="n">grad_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">objective_matrix</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="n">cross_deriv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">grad_x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a><span class="n">interaction_strength</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cross_deriv</span><span class="p">))</span>
<a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a>
<a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a><span class="n">has_interaction</span> <span class="o">=</span> <span class="n">interaction_strength</span> <span class="o">&gt;</span> <span class="n">threshold</span>
</code></pre></div></p>
<p><strong>Interpretation</strong>:
- <strong>No interaction</strong> → Parameters separable → Optimize independently
- <strong>Interaction detected</strong> → Parameters coupled → Optimize jointly</p>
<p><strong>Example</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="n">interaction</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">analyze_interaction</span><span class="p">(</span>
<a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a>    <span class="n">param1</span><span class="o">=</span><span class="s1">&#39;lookback&#39;</span><span class="p">,</span>
<a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a>    <span class="n">param2</span><span class="o">=</span><span class="s1">&#39;threshold&#39;</span><span class="p">,</span>
<a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a>    <span class="n">objective</span><span class="o">=</span><span class="n">run_backtest</span><span class="p">,</span>
<a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a><span class="p">)</span>
<a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a>
<a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a><span class="k">if</span> <span class="n">interaction</span><span class="o">.</span><span class="n">has_interaction</span><span class="p">:</span>
<a id="__codelineno-49-8" name="__codelineno-49-8" href="#__codelineno-49-8"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Optimize lookback and threshold jointly&quot;</span><span class="p">)</span>
<a id="__codelineno-49-9" name="__codelineno-49-9" href="#__codelineno-49-9"></a>    <span class="c1"># Use 2D optimization (grid, Bayesian, genetic)</span>
<a id="__codelineno-49-10" name="__codelineno-49-10" href="#__codelineno-49-10"></a><span class="k">else</span><span class="p">:</span>
<a id="__codelineno-49-11" name="__codelineno-49-11" href="#__codelineno-49-11"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Can optimize parameters independently&quot;</span><span class="p">)</span>
<a id="__codelineno-49-12" name="__codelineno-49-12" href="#__codelineno-49-12"></a>    <span class="c1"># 1D optimization sufficient</span>
</code></pre></div></p>
<h4 id="5-confidence-intervals">5. Confidence Intervals<a class="headerlink" href="#5-confidence-intervals" title="Permanent link">&para;</a></h4>
<p><strong>Purpose</strong>: Quantify uncertainty in stability scores</p>
<p><strong>Method</strong>: Bootstrap resampling</p>
<p><strong>Process</strong>:
1. Resample objective values (with replacement)
2. Recalculate stability metrics
3. Repeat N times (default: 100)
4. Compute 95% CI from percentiles</p>
<p><strong>Example</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="n">results</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">calculate_ci</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a>
<a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="n">result</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;lookback&#39;</span><span class="p">]</span>
<a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stability: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">stability_score</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;95% CI: [</span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">confidence_lower</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">confidence_upper</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
<a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a><span class="c1"># Output: Stability: 0.850</span>
<a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a><span class="c1">#         95% CI: [0.782, 0.901]</span>
</code></pre></div></p>
<h4 id="6-visualization">6. Visualization<a class="headerlink" href="#6-visualization" title="Permanent link">&para;</a></h4>
<p><strong>1D Sensitivity Plot</strong> (parameter vs. objective):
- X-axis: Parameter value
- Y-axis: Objective function (e.g., Sharpe ratio)
- Red line: Base parameter value
- Blue curve: Performance surface</p>
<p><strong>Interpretation</strong>:
- <strong>Flat curve</strong> → Robust parameter
- <strong>Steep curve</strong> → Sensitive parameter
- <strong>Cliff near base</strong> → Overfit risk</p>
<p><strong>2D Interaction Heatmap</strong>:
- Axes: Two parameter values
- Color: Objective function value
- Star: Base parameter values</p>
<p><strong>Interpretation</strong>:
- <strong>Diagonal bands</strong> → Interaction present
- <strong>Horizontal/vertical bands</strong> → No interaction</p>
<p><strong>Example</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="c1"># 1D plot</span>
<a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="n">fig</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">plot_sensitivity</span><span class="p">(</span><span class="s1">&#39;lookback&#39;</span><span class="p">,</span> <span class="n">show_ci</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;lookback_sensitivity.png&#39;</span><span class="p">)</span>
<a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a>
<a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a><span class="c1"># 2D heatmap</span>
<a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a><span class="n">fig</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">plot_interaction</span><span class="p">(</span><span class="s1">&#39;lookback&#39;</span><span class="p">,</span> <span class="s1">&#39;threshold&#39;</span><span class="p">)</span>
<a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;interaction_heatmap.png&#39;</span><span class="p">)</span>
</code></pre></div></p>
<h4 id="7-analysis-report">7. Analysis Report<a class="headerlink" href="#7-analysis-report" title="Permanent link">&para;</a></h4>
<p><strong>Purpose</strong>: Comprehensive markdown report with recommendations</p>
<p><strong>Includes</strong>:
- Parameter summary table (stability scores, classifications)
- Overall robustness assessment
- Detailed recommendations per parameter
- Parameter interaction matrix
- Overfitting indicators</p>
<p><strong>Example</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="n">report</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">generate_report</span><span class="p">()</span>
<a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a>
<a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a><span class="c1"># Save to file</span>
<a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sensitivity_report.md&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>
</code></pre></div></p>
<p><strong>Sample Report</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="gh"># Parameter Sensitivity Analysis Report</span>
<a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a>
<a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a><span class="gu">## Summary</span>
<a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a>
<a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a>| Parameter | Base Value | Stability Score | Classification | Recommendation |
<a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a>|-----------|------------|-----------------|----------------|----------------|
<a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a>| lookback  | 20         | 0.85            | Robust         | ✓ Safe to use  |
<a id="__codelineno-53-8" name="__codelineno-53-8" href="#__codelineno-53-8"></a>| threshold | 0.02       | 0.45            | Sensitive      | ⚠ Use caution  |
<a id="__codelineno-53-9" name="__codelineno-53-9" href="#__codelineno-53-9"></a>
<a id="__codelineno-53-10" name="__codelineno-53-10" href="#__codelineno-53-10"></a><span class="gu">## Robustness Assessment</span>
<a id="__codelineno-53-11" name="__codelineno-53-11" href="#__codelineno-53-11"></a>
<a id="__codelineno-53-12" name="__codelineno-53-12" href="#__codelineno-53-12"></a>Overall strategy robustness: <span class="gs">**Moderate**</span> (1/2 parameters robust)
<a id="__codelineno-53-13" name="__codelineno-53-13" href="#__codelineno-53-13"></a>
<a id="__codelineno-53-14" name="__codelineno-53-14" href="#__codelineno-53-14"></a><span class="gu">## Recommendations</span>
<a id="__codelineno-53-15" name="__codelineno-53-15" href="#__codelineno-53-15"></a>
<a id="__codelineno-53-16" name="__codelineno-53-16" href="#__codelineno-53-16"></a><span class="k">1.</span> <span class="gs">**lookback=20**</span>: Robust parameter, performance stable across ±50% range
<a id="__codelineno-53-17" name="__codelineno-53-17" href="#__codelineno-53-17"></a><span class="k">2.</span> <span class="gs">**threshold=0.02**</span>: Sensitive parameter, consider widening search or using stable alternative
<a id="__codelineno-53-18" name="__codelineno-53-18" href="#__codelineno-53-18"></a>
<a id="__codelineno-53-19" name="__codelineno-53-19" href="#__codelineno-53-19"></a><span class="gu">## Overfitting Indicators</span>
<a id="__codelineno-53-20" name="__codelineno-53-20" href="#__codelineno-53-20"></a>
<a id="__codelineno-53-21" name="__codelineno-53-21" href="#__codelineno-53-21"></a>⚠️ <span class="gs">**High-risk parameters detected:**</span>
<a id="__codelineno-53-22" name="__codelineno-53-22" href="#__codelineno-53-22"></a>
<a id="__codelineno-53-23" name="__codelineno-53-23" href="#__codelineno-53-23"></a><span class="k">-</span><span class="w"> </span><span class="gs">**threshold**</span>: High sensitivity (score: 0.45)
<a id="__codelineno-53-24" name="__codelineno-53-24" href="#__codelineno-53-24"></a><span class="w">  </span><span class="k">-</span><span class="w"> </span>Variance: 0.0234
<a id="__codelineno-53-25" name="__codelineno-53-25" href="#__codelineno-53-25"></a><span class="w">  </span><span class="k">-</span><span class="w"> </span>Max gradient: 0.0891
<a id="__codelineno-53-26" name="__codelineno-53-26" href="#__codelineno-53-26"></a><span class="w">  </span><span class="k">-</span><span class="w"> </span>Max curvature: 0.0156
<a id="__codelineno-53-27" name="__codelineno-53-27" href="#__codelineno-53-27"></a>
<a id="__codelineno-53-28" name="__codelineno-53-28" href="#__codelineno-53-28"></a><span class="gs">**Recommendation**</span>: This parameter may be overfit. Consider:
<a id="__codelineno-53-29" name="__codelineno-53-29" href="#__codelineno-53-29"></a><span class="k">1.</span> Using parameters from stable regions instead
<a id="__codelineno-53-30" name="__codelineno-53-30" href="#__codelineno-53-30"></a><span class="k">2.</span> Widening parameter search space
<a id="__codelineno-53-31" name="__codelineno-53-31" href="#__codelineno-53-31"></a><span class="k">3.</span> Adding regularization to optimization
<a id="__codelineno-53-32" name="__codelineno-53-32" href="#__codelineno-53-32"></a><span class="k">4.</span> Performing walk-forward validation
</code></pre></div></p>
<h3 id="integration-with-optimization-workflow">Integration with Optimization Workflow<a class="headerlink" href="#integration-with-optimization-workflow" title="Permanent link">&para;</a></h3>
<p><strong>Recommended workflow</strong>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="c1"># 1. Optimize parameters</span>
<a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="kn">from</span> <span class="nn">rustybt.optimization</span> <span class="kn">import</span> <span class="n">Optimizer</span><span class="p">,</span> <span class="n">RandomSearchAlgorithm</span><span class="p">,</span> <span class="n">ParameterSpace</span>
<a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a>
<a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a><span class="n">optimizer</span> <span class="o">=</span> <span class="n">Optimizer</span><span class="p">(</span>
<a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a>    <span class="n">search_algorithm</span><span class="o">=</span><span class="n">RandomSearchAlgorithm</span><span class="p">(</span><span class="o">...</span><span class="p">),</span>
<a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a>    <span class="n">parameter_space</span><span class="o">=</span><span class="n">param_space</span><span class="p">,</span>
<a id="__codelineno-54-7" name="__codelineno-54-7" href="#__codelineno-54-7"></a><span class="p">)</span>
<a id="__codelineno-54-8" name="__codelineno-54-8" href="#__codelineno-54-8"></a>
<a id="__codelineno-54-9" name="__codelineno-54-9" href="#__codelineno-54-9"></a><span class="n">best_params</span><span class="p">,</span> <span class="n">best_result</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">n_trials</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<a id="__codelineno-54-10" name="__codelineno-54-10" href="#__codelineno-54-10"></a>
<a id="__codelineno-54-11" name="__codelineno-54-11" href="#__codelineno-54-11"></a><span class="c1"># 2. Validate with sensitivity analysis</span>
<a id="__codelineno-54-12" name="__codelineno-54-12" href="#__codelineno-54-12"></a><span class="kn">from</span> <span class="nn">rustybt.optimization</span> <span class="kn">import</span> <span class="n">SensitivityAnalyzer</span>
<a id="__codelineno-54-13" name="__codelineno-54-13" href="#__codelineno-54-13"></a>
<a id="__codelineno-54-14" name="__codelineno-54-14" href="#__codelineno-54-14"></a><span class="n">analyzer</span> <span class="o">=</span> <span class="n">SensitivityAnalyzer</span><span class="p">(</span><span class="n">base_params</span><span class="o">=</span><span class="n">best_params</span><span class="p">)</span>
<a id="__codelineno-54-15" name="__codelineno-54-15" href="#__codelineno-54-15"></a><span class="n">sensitivity_results</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">objective</span><span class="p">)</span>
<a id="__codelineno-54-16" name="__codelineno-54-16" href="#__codelineno-54-16"></a>
<a id="__codelineno-54-17" name="__codelineno-54-17" href="#__codelineno-54-17"></a><span class="c1"># 3. Check for overfitting</span>
<a id="__codelineno-54-18" name="__codelineno-54-18" href="#__codelineno-54-18"></a><span class="n">sensitive_params</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-54-19" name="__codelineno-54-19" href="#__codelineno-54-19"></a>    <span class="n">name</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">sensitivity_results</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<a id="__codelineno-54-20" name="__codelineno-54-20" href="#__codelineno-54-20"></a>    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">classification</span> <span class="o">==</span> <span class="s1">&#39;sensitive&#39;</span>
<a id="__codelineno-54-21" name="__codelineno-54-21" href="#__codelineno-54-21"></a><span class="p">]</span>
<a id="__codelineno-54-22" name="__codelineno-54-22" href="#__codelineno-54-22"></a>
<a id="__codelineno-54-23" name="__codelineno-54-23" href="#__codelineno-54-23"></a><span class="k">if</span> <span class="n">sensitive_params</span><span class="p">:</span>
<a id="__codelineno-54-24" name="__codelineno-54-24" href="#__codelineno-54-24"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;⚠ Warning: Sensitive parameters: </span><span class="si">{</span><span class="n">sensitive_params</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-54-25" name="__codelineno-54-25" href="#__codelineno-54-25"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Consider walk-forward validation or parameter adjustment&quot;</span><span class="p">)</span>
<a id="__codelineno-54-26" name="__codelineno-54-26" href="#__codelineno-54-26"></a>
<a id="__codelineno-54-27" name="__codelineno-54-27" href="#__codelineno-54-27"></a><span class="c1"># 4. Analyze interactions</span>
<a id="__codelineno-54-28" name="__codelineno-54-28" href="#__codelineno-54-28"></a><span class="k">for</span> <span class="n">param1</span><span class="p">,</span> <span class="n">param2</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="n">best_params</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="mi">2</span><span class="p">):</span>
<a id="__codelineno-54-29" name="__codelineno-54-29" href="#__codelineno-54-29"></a>    <span class="n">interaction</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">analyze_interaction</span><span class="p">(</span><span class="n">param1</span><span class="p">,</span> <span class="n">param2</span><span class="p">,</span> <span class="n">objective</span><span class="p">)</span>
<a id="__codelineno-54-30" name="__codelineno-54-30" href="#__codelineno-54-30"></a>    <span class="k">if</span> <span class="n">interaction</span><span class="o">.</span><span class="n">has_interaction</span><span class="p">:</span>
<a id="__codelineno-54-31" name="__codelineno-54-31" href="#__codelineno-54-31"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Parameters </span><span class="si">{</span><span class="n">param1</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">param2</span><span class="si">}</span><span class="s2"> interact - optimize jointly&quot;</span><span class="p">)</span>
<a id="__codelineno-54-32" name="__codelineno-54-32" href="#__codelineno-54-32"></a>
<a id="__codelineno-54-33" name="__codelineno-54-33" href="#__codelineno-54-33"></a><span class="c1"># 5. Generate report</span>
<a id="__codelineno-54-34" name="__codelineno-54-34" href="#__codelineno-54-34"></a><span class="n">report</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">generate_report</span><span class="p">()</span>
<a id="__codelineno-54-35" name="__codelineno-54-35" href="#__codelineno-54-35"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sensitivity_report.md&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-54-36" name="__codelineno-54-36" href="#__codelineno-54-36"></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>
</code></pre></div>
<h3 id="synthetic-test-functions">Synthetic Test Functions<a class="headerlink" href="#synthetic-test-functions" title="Permanent link">&para;</a></h3>
<p><strong>Purpose</strong>: Validate sensitivity analysis with known stable/unstable functions</p>
<p><strong>Stable Function</strong> (broad minimum):
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="k">def</span> <span class="nf">stable_quadratic</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
<a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Gentle surface - parameters robust.&quot;&quot;&quot;</span>
<a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a>    <span class="k">return</span> <span class="o">-</span><span class="p">(</span><span class="mf">0.01</span> <span class="o">*</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># Very gradual</span>
<a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a>
<a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a><span class="c1"># Expected: High stability score (&gt; 0.8)</span>
</code></pre></div></p>
<p><strong>Sensitive Function</strong> (sharp peak):
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="k">def</span> <span class="nf">sensitive_gaussian</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
<a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Sharp peak - parameters sensitive.&quot;&quot;&quot;</span>
<a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a>    <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span> <span class="o">*</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># Very sharp</span>
<a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a>
<a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a><span class="c1"># Expected: Low stability score (&lt; 0.5)</span>
</code></pre></div></p>
<p><strong>Interacting Function</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="k">def</span> <span class="nf">interacting_function</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
<a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Parameters have cross-term.&quot;&quot;&quot;</span>
<a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a>    <span class="k">return</span> <span class="o">-</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">])</span>
<a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a>
<a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a><span class="c1"># Expected: Interaction detected</span>
</code></pre></div></p>
<p><strong>Non-Interacting Function</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="k">def</span> <span class="nf">separable_function</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
<a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Parameters separable.&quot;&quot;&quot;</span>
<a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a>    <span class="k">return</span> <span class="o">-</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a>
<a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a><span class="c1"># Expected: No interaction</span>
</code></pre></div></p>
<h3 id="use-cases">Use Cases<a class="headerlink" href="#use-cases" title="Permanent link">&para;</a></h3>
<h4 id="1-post-optimization-validation">1. Post-Optimization Validation<a class="headerlink" href="#1-post-optimization-validation" title="Permanent link">&para;</a></h4>
<p>After finding optimal parameters, validate they're not overfit:
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="n">best_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;lookback&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;threshold&#39;</span><span class="p">:</span> <span class="mf">0.02</span><span class="p">}</span>
<a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a><span class="n">analyzer</span> <span class="o">=</span> <span class="n">SensitivityAnalyzer</span><span class="p">(</span><span class="n">base_params</span><span class="o">=</span><span class="n">best_params</span><span class="p">)</span>
<a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a><span class="n">results</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">objective</span><span class="p">)</span>
<a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a>
<a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a><span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">classification</span> <span class="o">==</span> <span class="s1">&#39;sensitive&#39;</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
<a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;⚠ Potential overfitting detected&quot;</span><span class="p">)</span>
</code></pre></div></p>
<h4 id="2-parameter-selection">2. Parameter Selection<a class="headerlink" href="#2-parameter-selection" title="Permanent link">&para;</a></h4>
<p>Choose parameters from stable regions instead of sharp peaks:
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="c1"># Optimization found: threshold=0.0231 (on sharp peak)</span>
<a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a><span class="c1"># Sensitivity analysis: threshold in [0.015, 0.030] has similar performance</span>
<a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a><span class="c1"># Recommendation: Use threshold=0.020 (center of stable region)</span>
</code></pre></div></p>
<h4 id="3-search-space-refinement">3. Search Space Refinement<a class="headerlink" href="#3-search-space-refinement" title="Permanent link">&para;</a></h4>
<p>Identify which parameters need wider search ranges:
<div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="n">results</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">objective</span><span class="p">)</span>
<a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a>
<a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a>    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">variance</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">:</span>
<a id="__codelineno-61-5" name="__codelineno-61-5" href="#__codelineno-61-5"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: Performance insensitive - widen search space&quot;</span><span class="p">)</span>
<a id="__codelineno-61-6" name="__codelineno-61-6" href="#__codelineno-61-6"></a>    <span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">max_gradient</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
<a id="__codelineno-61-7" name="__codelineno-61-7" href="#__codelineno-61-7"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: Steep gradient - use finer sampling&quot;</span><span class="p">)</span>
</code></pre></div></p>
<h4 id="4-algorithm-selection">4. Algorithm Selection<a class="headerlink" href="#4-algorithm-selection" title="Permanent link">&para;</a></h4>
<p>Choose optimization algorithm based on sensitivity:
- <strong>All robust</strong>: Simple grid search sufficient
- <strong>Mixed sensitivity</strong>: Bayesian optimization (handles mixed landscapes)
- <strong>High interaction</strong>: Genetic algorithm (good for coupled parameters)</p>
<h3 id="performance-considerations">Performance Considerations<a class="headerlink" href="#performance-considerations" title="Permanent link">&para;</a></h3>
<p><strong>Computational Cost</strong>:
- <strong>Single-parameter analysis</strong>: n_points × n_params backtest runs
- <strong>Interaction analysis</strong>: n_points² × n_pairs backtest runs
- <strong>Confidence intervals</strong>: n_bootstrap × (single-parameter cost)</p>
<p><strong>Example</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="c1"># 3 parameters, 20 points each, 2 interactions, 100 bootstrap</span>
<a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a><span class="n">single_param_cost</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">=</span> <span class="mi">60</span> <span class="n">backtests</span>
<a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a><span class="n">interaction_cost</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span> <span class="o">=</span> <span class="mi">800</span> <span class="n">backtests</span>
<a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a><span class="n">bootstrap_cost</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">=</span> <span class="mi">6000</span> <span class="n">backtests</span> <span class="p">(</span><span class="k">if</span> <span class="n">calculate_ci</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a>
<a id="__codelineno-62-6" name="__codelineno-62-6" href="#__codelineno-62-6"></a><span class="n">total_cost</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">+</span> <span class="mi">800</span> <span class="o">+</span> <span class="mi">6000</span> <span class="o">=</span> <span class="mi">6860</span> <span class="n">backtests</span>
</code></pre></div></p>
<p><strong>Optimization strategies</strong>:
1. <strong>Skip CI initially</strong> (calculate_ci=False) for faster iteration
2. <strong>Analyze key parameters only</strong> (not all parameters)
3. <strong>Reduce n_points</strong> for initial exploration (10-15 instead of 30)
4. <strong>Parallelize backtests</strong> (use multiprocessing)
5. <strong>Cache backtest results</strong> (avoid re-running identical parameter sets)</p>
<h3 id="limitations-and-caveats">Limitations and Caveats<a class="headerlink" href="#limitations-and-caveats" title="Permanent link">&para;</a></h3>
<h4 id="1-local-analysis-only">1. Local Analysis Only<a class="headerlink" href="#1-local-analysis-only" title="Permanent link">&para;</a></h4>
<p>Sensitivity analysis explores <strong>neighborhood</strong> around base parameters, not entire space.</p>
<p><strong>Implication</strong>: May miss:
- Alternative stable regions far from base
- Global structure of performance surface</p>
<p><strong>Mitigation</strong>: Combine with grid search or random search for global view.</p>
<h4 id="2-assumes-smooth-objective">2. Assumes Smooth Objective<a class="headerlink" href="#2-assumes-smooth-objective" title="Permanent link">&para;</a></h4>
<p>Stability metrics (gradient, curvature) assume smooth objective function.</p>
<p><strong>Problematic for</strong>:
- Highly stochastic objectives (noisy backtests)
- Discontinuous parameters (e.g., integer thresholds)</p>
<p><strong>Mitigation</strong>:
- Increase n_points for better gradient estimation
- Use confidence intervals to quantify uncertainty</p>
<h4 id="3-correlation-vs-interaction">3. Correlation vs. Interaction<a class="headerlink" href="#3-correlation-vs-interaction" title="Permanent link">&para;</a></h4>
<p>High correlation ≠ interaction (in optimization sense).</p>
<p><strong>Example</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="c1"># Correlated but separable</span>
<a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span><span class="err">²</span> <span class="o">+</span> <span class="n">y</span><span class="err">²</span>  <span class="p">(</span><span class="n">correlation</span> <span class="n">exists</span><span class="p">,</span> <span class="n">no</span> <span class="n">interaction</span> <span class="k">for</span> <span class="n">optimization</span><span class="p">)</span>
<a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a>
<a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a><span class="c1"># Interacting (cross-term)</span>
<a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span><span class="err">²</span> <span class="o">+</span> <span class="n">y</span><span class="err">²</span> <span class="o">+</span> <span class="n">xy</span>  <span class="p">(</span><span class="n">interaction</span> <span class="n">present</span><span class="p">,</span> <span class="n">optimize</span> <span class="n">jointly</span><span class="p">)</span>
</code></pre></div></p>
<p><strong>Distinction</strong>: Sensitivity analysis detects <strong>cross-derivatives</strong> (optimization interaction), not statistical correlation.</p>
<h4 id="4-no-causality-claims">4. No Causality Claims<a class="headerlink" href="#4-no-causality-claims" title="Permanent link">&para;</a></h4>
<p>Sensitivity analysis measures <strong>association</strong>, not causation.</p>
<p><strong>Example</strong>: Low sensitivity might indicate:
- Parameter truly unimportant (causally)
- Parameter effect masked by other factors
- Insufficient parameter range tested</p>
<h3 id="implementation-notes">Implementation Notes<a class="headerlink" href="#implementation-notes" title="Permanent link">&para;</a></h3>
<p><strong>Data Structures</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a><span class="k">class</span> <span class="nc">SensitivityResult</span><span class="p">:</span>
<a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a>    <span class="n">parameter_name</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a>    <span class="n">param_values</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>
<a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a>    <span class="n">objective_values</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>
<a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a>    <span class="n">base_value</span><span class="p">:</span> <span class="nb">float</span>
<a id="__codelineno-64-7" name="__codelineno-64-7" href="#__codelineno-64-7"></a>    <span class="n">base_objective</span><span class="p">:</span> <span class="nb">float</span>
<a id="__codelineno-64-8" name="__codelineno-64-8" href="#__codelineno-64-8"></a>    <span class="n">variance</span><span class="p">:</span> <span class="nb">float</span>
<a id="__codelineno-64-9" name="__codelineno-64-9" href="#__codelineno-64-9"></a>    <span class="n">max_gradient</span><span class="p">:</span> <span class="nb">float</span>
<a id="__codelineno-64-10" name="__codelineno-64-10" href="#__codelineno-64-10"></a>    <span class="n">max_curvature</span><span class="p">:</span> <span class="nb">float</span>
<a id="__codelineno-64-11" name="__codelineno-64-11" href="#__codelineno-64-11"></a>    <span class="n">stability_score</span><span class="p">:</span> <span class="nb">float</span>
<a id="__codelineno-64-12" name="__codelineno-64-12" href="#__codelineno-64-12"></a>    <span class="n">classification</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># &#39;robust&#39;, &#39;moderate&#39;, &#39;sensitive&#39;</span>
<a id="__codelineno-64-13" name="__codelineno-64-13" href="#__codelineno-64-13"></a>    <span class="n">confidence_lower</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span>
<a id="__codelineno-64-14" name="__codelineno-64-14" href="#__codelineno-64-14"></a>    <span class="n">confidence_upper</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span>
<a id="__codelineno-64-15" name="__codelineno-64-15" href="#__codelineno-64-15"></a>
<a id="__codelineno-64-16" name="__codelineno-64-16" href="#__codelineno-64-16"></a><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-64-17" name="__codelineno-64-17" href="#__codelineno-64-17"></a><span class="k">class</span> <span class="nc">InteractionResult</span><span class="p">:</span>
<a id="__codelineno-64-18" name="__codelineno-64-18" href="#__codelineno-64-18"></a>    <span class="n">param1_name</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-64-19" name="__codelineno-64-19" href="#__codelineno-64-19"></a>    <span class="n">param2_name</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-64-20" name="__codelineno-64-20" href="#__codelineno-64-20"></a>    <span class="n">param1_values</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>
<a id="__codelineno-64-21" name="__codelineno-64-21" href="#__codelineno-64-21"></a>    <span class="n">param2_values</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>
<a id="__codelineno-64-22" name="__codelineno-64-22" href="#__codelineno-64-22"></a>    <span class="n">objective_matrix</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>
<a id="__codelineno-64-23" name="__codelineno-64-23" href="#__codelineno-64-23"></a>    <span class="n">interaction_strength</span><span class="p">:</span> <span class="nb">float</span>
<a id="__codelineno-64-24" name="__codelineno-64-24" href="#__codelineno-64-24"></a>    <span class="n">has_interaction</span><span class="p">:</span> <span class="nb">bool</span>
</code></pre></div></p>
<p><strong>Type Safety</strong>:
- Full type hints (mypy --strict compliant)
- Immutable dataclasses (frozen=True)
- pydantic validation for inputs</p>
<p><strong>Reproducibility</strong>:
- Random seed support for bootstrap
- Deterministic parameter sampling (linspace)</p>
<h3 id="example-complete-analysis">Example: Complete Analysis<a class="headerlink" href="#example-complete-analysis" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="kn">from</span> <span class="nn">rustybt.optimization</span> <span class="kn">import</span> <span class="n">SensitivityAnalyzer</span>
<a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a>
<a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a><span class="c1"># Setup</span>
<a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a><span class="n">analyzer</span> <span class="o">=</span> <span class="n">SensitivityAnalyzer</span><span class="p">(</span>
<a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a>    <span class="n">base_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fast_ma&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;slow_ma&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s1">&#39;threshold&#39;</span><span class="p">:</span> <span class="mf">0.02</span><span class="p">},</span>
<a id="__codelineno-65-6" name="__codelineno-65-6" href="#__codelineno-65-6"></a>    <span class="n">n_points</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span>
<a id="__codelineno-65-7" name="__codelineno-65-7" href="#__codelineno-65-7"></a>    <span class="n">perturbation_pct</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<a id="__codelineno-65-8" name="__codelineno-65-8" href="#__codelineno-65-8"></a>    <span class="n">n_bootstrap</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-65-9" name="__codelineno-65-9" href="#__codelineno-65-9"></a>    <span class="n">interaction_threshold</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
<a id="__codelineno-65-10" name="__codelineno-65-10" href="#__codelineno-65-10"></a>    <span class="n">random_seed</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
<a id="__codelineno-65-11" name="__codelineno-65-11" href="#__codelineno-65-11"></a><span class="p">)</span>
<a id="__codelineno-65-12" name="__codelineno-65-12" href="#__codelineno-65-12"></a>
<a id="__codelineno-65-13" name="__codelineno-65-13" href="#__codelineno-65-13"></a><span class="c1"># Single-parameter sensitivity</span>
<a id="__codelineno-65-14" name="__codelineno-65-14" href="#__codelineno-65-14"></a><span class="n">results</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span>
<a id="__codelineno-65-15" name="__codelineno-65-15" href="#__codelineno-65-15"></a>    <span class="n">objective</span><span class="o">=</span><span class="n">run_backtest</span><span class="p">,</span>
<a id="__codelineno-65-16" name="__codelineno-65-16" href="#__codelineno-65-16"></a>    <span class="n">calculate_ci</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-65-17" name="__codelineno-65-17" href="#__codelineno-65-17"></a><span class="p">)</span>
<a id="__codelineno-65-18" name="__codelineno-65-18" href="#__codelineno-65-18"></a>
<a id="__codelineno-65-19" name="__codelineno-65-19" href="#__codelineno-65-19"></a><span class="c1"># Interaction analysis</span>
<a id="__codelineno-65-20" name="__codelineno-65-20" href="#__codelineno-65-20"></a><span class="n">interaction</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">analyze_interaction</span><span class="p">(</span>
<a id="__codelineno-65-21" name="__codelineno-65-21" href="#__codelineno-65-21"></a>    <span class="n">param1</span><span class="o">=</span><span class="s1">&#39;fast_ma&#39;</span><span class="p">,</span>
<a id="__codelineno-65-22" name="__codelineno-65-22" href="#__codelineno-65-22"></a>    <span class="n">param2</span><span class="o">=</span><span class="s1">&#39;slow_ma&#39;</span><span class="p">,</span>
<a id="__codelineno-65-23" name="__codelineno-65-23" href="#__codelineno-65-23"></a>    <span class="n">objective</span><span class="o">=</span><span class="n">run_backtest</span><span class="p">,</span>
<a id="__codelineno-65-24" name="__codelineno-65-24" href="#__codelineno-65-24"></a><span class="p">)</span>
<a id="__codelineno-65-25" name="__codelineno-65-25" href="#__codelineno-65-25"></a>
<a id="__codelineno-65-26" name="__codelineno-65-26" href="#__codelineno-65-26"></a><span class="c1"># Visualizations</span>
<a id="__codelineno-65-27" name="__codelineno-65-27" href="#__codelineno-65-27"></a><span class="n">analyzer</span><span class="o">.</span><span class="n">plot_sensitivity</span><span class="p">(</span><span class="s1">&#39;fast_ma&#39;</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="s1">&#39;fast_ma_sensitivity.png&#39;</span><span class="p">)</span>
<a id="__codelineno-65-28" name="__codelineno-65-28" href="#__codelineno-65-28"></a><span class="n">analyzer</span><span class="o">.</span><span class="n">plot_sensitivity</span><span class="p">(</span><span class="s1">&#39;slow_ma&#39;</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="s1">&#39;slow_ma_sensitivity.png&#39;</span><span class="p">)</span>
<a id="__codelineno-65-29" name="__codelineno-65-29" href="#__codelineno-65-29"></a><span class="n">analyzer</span><span class="o">.</span><span class="n">plot_sensitivity</span><span class="p">(</span><span class="s1">&#39;threshold&#39;</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="s1">&#39;threshold_sensitivity.png&#39;</span><span class="p">)</span>
<a id="__codelineno-65-30" name="__codelineno-65-30" href="#__codelineno-65-30"></a><span class="n">analyzer</span><span class="o">.</span><span class="n">plot_interaction</span><span class="p">(</span><span class="s1">&#39;fast_ma&#39;</span><span class="p">,</span> <span class="s1">&#39;slow_ma&#39;</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="s1">&#39;ma_interaction.png&#39;</span><span class="p">)</span>
<a id="__codelineno-65-31" name="__codelineno-65-31" href="#__codelineno-65-31"></a>
<a id="__codelineno-65-32" name="__codelineno-65-32" href="#__codelineno-65-32"></a><span class="c1"># Generate report</span>
<a id="__codelineno-65-33" name="__codelineno-65-33" href="#__codelineno-65-33"></a><span class="n">report</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">generate_report</span><span class="p">()</span>
<a id="__codelineno-65-34" name="__codelineno-65-34" href="#__codelineno-65-34"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sensitivity_report.md&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-65-35" name="__codelineno-65-35" href="#__codelineno-65-35"></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>
<a id="__codelineno-65-36" name="__codelineno-65-36" href="#__codelineno-65-36"></a>
<a id="__codelineno-65-37" name="__codelineno-65-37" href="#__codelineno-65-37"></a><span class="c1"># Actionable insights</span>
<a id="__codelineno-65-38" name="__codelineno-65-38" href="#__codelineno-65-38"></a><span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-65-39" name="__codelineno-65-39" href="#__codelineno-65-39"></a>    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">classification</span> <span class="o">==</span> <span class="s1">&#39;sensitive&#39;</span><span class="p">:</span>
<a id="__codelineno-65-40" name="__codelineno-65-40" href="#__codelineno-65-40"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;⚠ </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">: Potential overfit (score=</span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">stability_score</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<a id="__codelineno-65-41" name="__codelineno-65-41" href="#__codelineno-65-41"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  → Consider walk-forward validation&quot;</span><span class="p">)</span>
<a id="__codelineno-65-42" name="__codelineno-65-42" href="#__codelineno-65-42"></a>    <span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">classification</span> <span class="o">==</span> <span class="s1">&#39;robust&#39;</span><span class="p">:</span>
<a id="__codelineno-65-43" name="__codelineno-65-43" href="#__codelineno-65-43"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">: Robust parameter (score=</span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">stability_score</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<a id="__codelineno-65-44" name="__codelineno-65-44" href="#__codelineno-65-44"></a>
<a id="__codelineno-65-45" name="__codelineno-65-45" href="#__codelineno-65-45"></a><span class="k">if</span> <span class="n">interaction</span><span class="o">.</span><span class="n">has_interaction</span><span class="p">:</span>
<a id="__codelineno-65-46" name="__codelineno-65-46" href="#__codelineno-65-46"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;⚠ fast_ma and slow_ma interact (strength=</span><span class="si">{</span><span class="n">interaction</span><span class="o">.</span><span class="n">interaction_strength</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<a id="__codelineno-65-47" name="__codelineno-65-47" href="#__codelineno-65-47"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  → Use 2D optimization instead of 1D&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="references">References<a class="headerlink" href="#references" title="Permanent link">&para;</a></h3>
<p><strong>Theoretical Foundation</strong>:
- <strong>Numerical Differentiation</strong>: Gradient and curvature estimation via finite differences
- <strong>Bootstrap Methods</strong>: Efron &amp; Tibshirani (1993) - confidence interval estimation
- <strong>Sensitivity Analysis</strong>: Saltelli et al. (2008) - Global Sensitivity Analysis
- <strong>Interaction Detection</strong>: Sobol indices, ANOVA decomposition</p>
<p><strong>Related Work</strong>:
- <strong>Optuna</strong>: Hyperparameter importance via fANOVA
- <strong>HyperOpt</strong>: Gaussian Process sensitivity (sklearn.inspection)
- <strong>scikit-optimize</strong>: Expected Improvement surface analysis</p>
<h2 id="monte-carlo-simulation-with-data-permutation-story-59">Monte Carlo Simulation with Data Permutation (Story 5.9)<a class="headerlink" href="#monte-carlo-simulation-with-data-permutation-story-59" title="Permanent link">&para;</a></h2>
<h3 id="overview_3">Overview<a class="headerlink" href="#overview_3" title="Permanent link">&para;</a></h3>
<p>Monte Carlo simulation with trade permutation validates if strategy performance is due to skill or lucky trade sequencing. By shuffling trade order and generating performance distributions, it detects whether observed results are statistically robust or potentially due to chance.</p>
<p><strong>Purpose</strong>: Distinguish between genuine strategy edge and random luck in trade sequencing.</p>
<p><strong>Implementation</strong>: <code>rustybt/optimization/monte_carlo.py</code></p>
<h3 id="core-concepts_1">Core Concepts<a class="headerlink" href="#core-concepts_1" title="Permanent link">&para;</a></h3>
<h4 id="the-central-question">The Central Question<a class="headerlink" href="#the-central-question" title="Permanent link">&para;</a></h4>
<p><strong>Is my strategy's performance due to skill or lucky trade order?</strong></p>
<p>A strategy with Sharpe ratio = 2.0 might have:
- <strong>Genuine edge</strong>: Performance holds across different trade sequences
- <strong>Lucky sequence</strong>: Specific trade order happened to work well</p>
<p>Monte Carlo permutation answers this by testing thousands of alternative trade sequences.</p>
<h4 id="permutation-method">Permutation Method<a class="headerlink" href="#permutation-method" title="Permanent link">&para;</a></h4>
<p><strong>Concept</strong>: Shuffle trade order while preserving individual trade outcomes.</p>
<p><strong>Process</strong>:
1. Extract trades from backtest: <code>[trade1, trade2, ..., tradeN]</code>
2. Randomly shuffle order: <code>[trade5, trade1, trade3, ...]</code>
3. Recalculate equity curve from shuffled trades
4. Recalculate performance metrics (Sharpe, return, drawdown)
5. Repeat 1000 times → distribution of possible outcomes</p>
<p><strong>Invariant</strong>: Total return identical, but sequence differs.</p>
<p><strong>Example</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="c1"># Original trades</span>
<a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a><span class="n">trades</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a>    <span class="p">{</span><span class="s1">&#39;return&#39;</span><span class="p">:</span> <span class="mf">0.02</span><span class="p">,</span> <span class="s1">&#39;pnl&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span>   <span class="c1"># Win</span>
<a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a>    <span class="p">{</span><span class="s1">&#39;return&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="s1">&#39;pnl&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">50</span><span class="p">},</span>  <span class="c1"># Loss</span>
<a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a>    <span class="p">{</span><span class="s1">&#39;return&#39;</span><span class="p">:</span> <span class="mf">0.03</span><span class="p">,</span> <span class="s1">&#39;pnl&#39;</span><span class="p">:</span> <span class="mi">150</span><span class="p">},</span>   <span class="c1"># Win</span>
<a id="__codelineno-66-6" name="__codelineno-66-6" href="#__codelineno-66-6"></a><span class="p">]</span>
<a id="__codelineno-66-7" name="__codelineno-66-7" href="#__codelineno-66-7"></a>
<a id="__codelineno-66-8" name="__codelineno-66-8" href="#__codelineno-66-8"></a><span class="c1"># Permutation 1: [trade2, trade3, trade1]</span>
<a id="__codelineno-66-9" name="__codelineno-66-9" href="#__codelineno-66-9"></a><span class="c1"># Permutation 2: [trade3, trade1, trade2]</span>
<a id="__codelineno-66-10" name="__codelineno-66-10" href="#__codelineno-66-10"></a><span class="c1"># ...</span>
<a id="__codelineno-66-11" name="__codelineno-66-11" href="#__codelineno-66-11"></a><span class="c1"># Permutation 1000: [trade1, trade3, trade2]</span>
<a id="__codelineno-66-12" name="__codelineno-66-12" href="#__codelineno-66-12"></a>
<a id="__codelineno-66-13" name="__codelineno-66-13" href="#__codelineno-66-13"></a><span class="c1"># Each permutation: Different equity curve, different Sharpe ratio</span>
<a id="__codelineno-66-14" name="__codelineno-66-14" href="#__codelineno-66-14"></a><span class="c1"># But: Same total return (sum = 200)</span>
</code></pre></div></p>
<h4 id="bootstrap-method">Bootstrap Method<a class="headerlink" href="#bootstrap-method" title="Permanent link">&para;</a></h4>
<p><strong>Alternative approach</strong>: Resample trades with replacement.</p>
<p><strong>Difference from permutation</strong>:
- <strong>Permutation</strong>: Every trade appears exactly once (just reordered)
- <strong>Bootstrap</strong>: Some trades appear multiple times, some not at all</p>
<p><strong>When to use</strong>:
- <strong>Permutation</strong> (recommended): Test if observed sequence is special
- <strong>Bootstrap</strong>: Estimate sampling uncertainty</p>
<h3 id="key-components_2">Key Components<a class="headerlink" href="#key-components_2" title="Permanent link">&para;</a></h3>
<h4 id="1-montecarlosimulator">1. MonteCarloSimulator<a class="headerlink" href="#1-montecarlosimulator" title="Permanent link">&para;</a></h4>
<p><strong>Purpose</strong>: Run Monte Carlo simulations and generate statistical analysis</p>
<p><strong>Interface</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="kn">from</span> <span class="nn">rustybt.optimization.monte_carlo</span> <span class="kn">import</span> <span class="n">MonteCarloSimulator</span>
<a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a><span class="kn">import</span> <span class="nn">polars</span> <span class="k">as</span> <span class="nn">pl</span>
<a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a><span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span>
<a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a>
<a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a><span class="c1"># Create trades DataFrame</span>
<a id="__codelineno-67-6" name="__codelineno-67-6" href="#__codelineno-67-6"></a><span class="n">trades</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
<a id="__codelineno-67-7" name="__codelineno-67-7" href="#__codelineno-67-7"></a>    <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">...</span><span class="p">],</span>
<a id="__codelineno-67-8" name="__codelineno-67-8" href="#__codelineno-67-8"></a>    <span class="s1">&#39;return&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">...</span><span class="p">],</span>     <span class="c1"># Trade returns</span>
<a id="__codelineno-67-9" name="__codelineno-67-9" href="#__codelineno-67-9"></a>    <span class="s1">&#39;pnl&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">...</span><span class="p">],</span>        <span class="c1"># Trade P&amp;L</span>
<a id="__codelineno-67-10" name="__codelineno-67-10" href="#__codelineno-67-10"></a>    <span class="s1">&#39;asset&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span>
<a id="__codelineno-67-11" name="__codelineno-67-11" href="#__codelineno-67-11"></a><span class="p">})</span>
<a id="__codelineno-67-12" name="__codelineno-67-12" href="#__codelineno-67-12"></a>
<a id="__codelineno-67-13" name="__codelineno-67-13" href="#__codelineno-67-13"></a><span class="c1"># Observed metrics from backtest</span>
<a id="__codelineno-67-14" name="__codelineno-67-14" href="#__codelineno-67-14"></a><span class="n">observed_metrics</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-67-15" name="__codelineno-67-15" href="#__codelineno-67-15"></a>    <span class="s1">&#39;sharpe_ratio&#39;</span><span class="p">:</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;2.0&#39;</span><span class="p">),</span>
<a id="__codelineno-67-16" name="__codelineno-67-16" href="#__codelineno-67-16"></a>    <span class="s1">&#39;total_return&#39;</span><span class="p">:</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;0.25&#39;</span><span class="p">),</span>
<a id="__codelineno-67-17" name="__codelineno-67-17" href="#__codelineno-67-17"></a>    <span class="s1">&#39;max_drawdown&#39;</span><span class="p">:</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;0.08&#39;</span><span class="p">),</span>
<a id="__codelineno-67-18" name="__codelineno-67-18" href="#__codelineno-67-18"></a>    <span class="s1">&#39;win_rate&#39;</span><span class="p">:</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;0.60&#39;</span><span class="p">),</span>
<a id="__codelineno-67-19" name="__codelineno-67-19" href="#__codelineno-67-19"></a><span class="p">}</span>
<a id="__codelineno-67-20" name="__codelineno-67-20" href="#__codelineno-67-20"></a>
<a id="__codelineno-67-21" name="__codelineno-67-21" href="#__codelineno-67-21"></a><span class="c1"># Create simulator</span>
<a id="__codelineno-67-22" name="__codelineno-67-22" href="#__codelineno-67-22"></a><span class="n">mc</span> <span class="o">=</span> <span class="n">MonteCarloSimulator</span><span class="p">(</span>
<a id="__codelineno-67-23" name="__codelineno-67-23" href="#__codelineno-67-23"></a>    <span class="n">n_simulations</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>        <span class="c1"># Run 1000 permutations</span>
<a id="__codelineno-67-24" name="__codelineno-67-24" href="#__codelineno-67-24"></a>    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;permutation&#39;</span><span class="p">,</span>      <span class="c1"># &#39;permutation&#39; or &#39;bootstrap&#39;</span>
<a id="__codelineno-67-25" name="__codelineno-67-25" href="#__codelineno-67-25"></a>    <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>                   <span class="c1"># Reproducible results</span>
<a id="__codelineno-67-26" name="__codelineno-67-26" href="#__codelineno-67-26"></a>    <span class="n">confidence_level</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span>     <span class="c1"># 95% confidence intervals</span>
<a id="__codelineno-67-27" name="__codelineno-67-27" href="#__codelineno-67-27"></a><span class="p">)</span>
<a id="__codelineno-67-28" name="__codelineno-67-28" href="#__codelineno-67-28"></a>
<a id="__codelineno-67-29" name="__codelineno-67-29" href="#__codelineno-67-29"></a><span class="c1"># Run simulation</span>
<a id="__codelineno-67-30" name="__codelineno-67-30" href="#__codelineno-67-30"></a><span class="n">result</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<a id="__codelineno-67-31" name="__codelineno-67-31" href="#__codelineno-67-31"></a>    <span class="n">trades</span><span class="o">=</span><span class="n">trades</span><span class="p">,</span>
<a id="__codelineno-67-32" name="__codelineno-67-32" href="#__codelineno-67-32"></a>    <span class="n">observed_metrics</span><span class="o">=</span><span class="n">observed_metrics</span><span class="p">,</span>
<a id="__codelineno-67-33" name="__codelineno-67-33" href="#__codelineno-67-33"></a>    <span class="n">initial_capital</span><span class="o">=</span><span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;100000&#39;</span><span class="p">),</span>
<a id="__codelineno-67-34" name="__codelineno-67-34" href="#__codelineno-67-34"></a><span class="p">)</span>
<a id="__codelineno-67-35" name="__codelineno-67-35" href="#__codelineno-67-35"></a>
<a id="__codelineno-67-36" name="__codelineno-67-36" href="#__codelineno-67-36"></a><span class="c1"># Analyze results</span>
<a id="__codelineno-67-37" name="__codelineno-67-37" href="#__codelineno-67-37"></a><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">get_summary</span><span class="p">(</span><span class="s1">&#39;sharpe_ratio&#39;</span><span class="p">))</span>
<a id="__codelineno-67-38" name="__codelineno-67-38" href="#__codelineno-67-38"></a><span class="n">result</span><span class="o">.</span><span class="n">plot_distribution</span><span class="p">(</span><span class="s1">&#39;sharpe_ratio&#39;</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="s1">&#39;sharpe_distribution.png&#39;</span><span class="p">)</span>
</code></pre></div></p>
<h4 id="2-statistical-analysis">2. Statistical Analysis<a class="headerlink" href="#2-statistical-analysis" title="Permanent link">&para;</a></h4>
<p><strong>Confidence Intervals</strong> (95% CI):
<div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="n">ci_lower</span><span class="p">,</span> <span class="n">ci_upper</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">confidence_intervals</span><span class="p">[</span><span class="s1">&#39;sharpe_ratio&#39;</span><span class="p">]</span>
<a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a><span class="n">observed</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">observed_metrics</span><span class="p">[</span><span class="s1">&#39;sharpe_ratio&#39;</span><span class="p">]</span>
<a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a>
<a id="__codelineno-68-4" name="__codelineno-68-4" href="#__codelineno-68-4"></a><span class="c1"># Interpretation:</span>
<a id="__codelineno-68-5" name="__codelineno-68-5" href="#__codelineno-68-5"></a><span class="c1"># - Observed outside CI → Likely robust</span>
<a id="__codelineno-68-6" name="__codelineno-68-6" href="#__codelineno-68-6"></a><span class="c1"># - Observed inside CI → Possibly lucky</span>
</code></pre></div></p>
<p><strong>P-Value</strong> (statistical significance):
<div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a><span class="n">p_value</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">p_values</span><span class="p">[</span><span class="s1">&#39;sharpe_ratio&#39;</span><span class="p">]</span>
<a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a>
<a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a><span class="c1"># P-value = fraction of simulations with Sharpe ≥ observed</span>
<a id="__codelineno-69-4" name="__codelineno-69-4" href="#__codelineno-69-4"></a><span class="c1"># p &lt; 0.05 → Statistically significant (less than 5% chance due to luck)</span>
<a id="__codelineno-69-5" name="__codelineno-69-5" href="#__codelineno-69-5"></a><span class="c1"># p &gt; 0.10 → Not significant (could be random)</span>
</code></pre></div></p>
<p><strong>Percentile Rank</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="n">percentile</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">percentile_ranks</span><span class="p">[</span><span class="s1">&#39;sharpe_ratio&#39;</span><span class="p">]</span>
<a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a>
<a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a><span class="c1"># Percentile = 95 → Observed better than 95% of permutations</span>
<a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a><span class="c1"># Percentile = 50 → Observed is median (average)</span>
</code></pre></div></p>
<h4 id="3-robustness-classification">3. Robustness Classification<a class="headerlink" href="#3-robustness-classification" title="Permanent link">&para;</a></h4>
<p><strong>Automatic classification</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="c1"># Check if significant and robust</span>
<a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a><span class="n">is_significant</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">is_significant</span><span class="p">[</span><span class="s1">&#39;sharpe_ratio&#39;</span><span class="p">]</span>  <span class="c1"># p &lt; 0.05</span>
<a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a><span class="n">is_robust</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">is_robust</span><span class="p">[</span><span class="s1">&#39;sharpe_ratio&#39;</span><span class="p">]</span>            <span class="c1"># Outside 95% CI</span>
<a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a>
<a id="__codelineno-71-5" name="__codelineno-71-5" href="#__codelineno-71-5"></a><span class="c1"># Interpretation:</span>
<a id="__codelineno-71-6" name="__codelineno-71-6" href="#__codelineno-71-6"></a><span class="k">if</span> <span class="n">is_significant</span> <span class="ow">and</span> <span class="n">is_robust</span><span class="p">:</span>
<a id="__codelineno-71-7" name="__codelineno-71-7" href="#__codelineno-71-7"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✅ ROBUST: Strategy has genuine edge&quot;</span><span class="p">)</span>
<a id="__codelineno-71-8" name="__codelineno-71-8" href="#__codelineno-71-8"></a><span class="k">elif</span> <span class="n">is_significant</span><span class="p">:</span>
<a id="__codelineno-71-9" name="__codelineno-71-9" href="#__codelineno-71-9"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;⚠️  SIGNIFICANT: Borderline robust&quot;</span><span class="p">)</span>
<a id="__codelineno-71-10" name="__codelineno-71-10" href="#__codelineno-71-10"></a><span class="k">elif</span> <span class="n">is_robust</span><span class="p">:</span>
<a id="__codelineno-71-11" name="__codelineno-71-11" href="#__codelineno-71-11"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;⚠️  UNUSUAL: Outside CI but not significant&quot;</span><span class="p">)</span>
<a id="__codelineno-71-12" name="__codelineno-71-12" href="#__codelineno-71-12"></a><span class="k">else</span><span class="p">:</span>
<a id="__codelineno-71-13" name="__codelineno-71-13" href="#__codelineno-71-13"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;❌ NOT ROBUST: Performance may be due to luck&quot;</span><span class="p">)</span>
</code></pre></div></p>
<h4 id="4-visualization">4. Visualization<a class="headerlink" href="#4-visualization" title="Permanent link">&para;</a></h4>
<p><strong>Distribution Plot</strong> with annotations:
<div class="highlight"><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="n">result</span><span class="o">.</span><span class="n">plot_distribution</span><span class="p">(</span>
<a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a>    <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;sharpe_ratio&#39;</span><span class="p">,</span>
<a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a>    <span class="n">output_path</span><span class="o">=</span><span class="s1">&#39;sharpe_mc.png&#39;</span><span class="p">,</span>
<a id="__codelineno-72-4" name="__codelineno-72-4" href="#__codelineno-72-4"></a>    <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-72-5" name="__codelineno-72-5" href="#__codelineno-72-5"></a><span class="p">)</span>
</code></pre></div></p>
<p><strong>Plot includes</strong>:
- Histogram of simulated Sharpe ratios
- Observed Sharpe ratio (red line)
- 95% confidence interval bounds (green lines)
- P-value and percentile rank
- Robustness classification</p>
<h4 id="5-monte-carlo-results">5. Monte Carlo Results<a class="headerlink" href="#5-monte-carlo-results" title="Permanent link">&para;</a></h4>
<p><strong>Complete statistical summary</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a><span class="k">class</span> <span class="nc">MonteCarloResult</span><span class="p">:</span>
<a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a>    <span class="n">observed_metrics</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">]</span>
<a id="__codelineno-73-4" name="__codelineno-73-4" href="#__codelineno-73-4"></a>    <span class="n">simulated_metrics</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">Decimal</span><span class="p">]]</span>
<a id="__codelineno-73-5" name="__codelineno-73-5" href="#__codelineno-73-5"></a>    <span class="n">confidence_intervals</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Decimal</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">]]</span>
<a id="__codelineno-73-6" name="__codelineno-73-6" href="#__codelineno-73-6"></a>    <span class="n">p_values</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">]</span>
<a id="__codelineno-73-7" name="__codelineno-73-7" href="#__codelineno-73-7"></a>    <span class="n">percentile_ranks</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">]</span>
<a id="__codelineno-73-8" name="__codelineno-73-8" href="#__codelineno-73-8"></a>    <span class="n">n_simulations</span><span class="p">:</span> <span class="nb">int</span>
<a id="__codelineno-73-9" name="__codelineno-73-9" href="#__codelineno-73-9"></a>    <span class="n">method</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;permutation&#39;</span><span class="p">,</span> <span class="s1">&#39;bootstrap&#39;</span><span class="p">]</span>
<a id="__codelineno-73-10" name="__codelineno-73-10" href="#__codelineno-73-10"></a>    <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div></p>
<h3 id="usage-patterns">Usage Patterns<a class="headerlink" href="#usage-patterns" title="Permanent link">&para;</a></h3>
<h4 id="1-post-backtest-validation">1. Post-Backtest Validation<a class="headerlink" href="#1-post-backtest-validation" title="Permanent link">&para;</a></h4>
<p><strong>After backtesting, validate results</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="c1"># Run backtest</span>
<a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a><span class="n">backtest_result</span> <span class="o">=</span> <span class="n">run_backtest</span><span class="p">(</span><span class="n">strategy</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
<a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a>
<a id="__codelineno-74-4" name="__codelineno-74-4" href="#__codelineno-74-4"></a><span class="c1"># Extract trades and metrics</span>
<a id="__codelineno-74-5" name="__codelineno-74-5" href="#__codelineno-74-5"></a><span class="n">trades_df</span> <span class="o">=</span> <span class="n">backtest_result</span><span class="o">.</span><span class="n">transactions</span>
<a id="__codelineno-74-6" name="__codelineno-74-6" href="#__codelineno-74-6"></a><span class="n">observed_sharpe</span> <span class="o">=</span> <span class="n">backtest_result</span><span class="o">.</span><span class="n">sharpe_ratio</span>
<a id="__codelineno-74-7" name="__codelineno-74-7" href="#__codelineno-74-7"></a>
<a id="__codelineno-74-8" name="__codelineno-74-8" href="#__codelineno-74-8"></a><span class="c1"># Monte Carlo validation</span>
<a id="__codelineno-74-9" name="__codelineno-74-9" href="#__codelineno-74-9"></a><span class="n">mc</span> <span class="o">=</span> <span class="n">MonteCarloSimulator</span><span class="p">(</span><span class="n">n_simulations</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<a id="__codelineno-74-10" name="__codelineno-74-10" href="#__codelineno-74-10"></a><span class="n">mc_result</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<a id="__codelineno-74-11" name="__codelineno-74-11" href="#__codelineno-74-11"></a>    <span class="n">trades</span><span class="o">=</span><span class="n">trades_df</span><span class="p">,</span>
<a id="__codelineno-74-12" name="__codelineno-74-12" href="#__codelineno-74-12"></a>    <span class="n">observed_metrics</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;sharpe_ratio&#39;</span><span class="p">:</span> <span class="n">observed_sharpe</span><span class="p">},</span>
<a id="__codelineno-74-13" name="__codelineno-74-13" href="#__codelineno-74-13"></a><span class="p">)</span>
<a id="__codelineno-74-14" name="__codelineno-74-14" href="#__codelineno-74-14"></a>
<a id="__codelineno-74-15" name="__codelineno-74-15" href="#__codelineno-74-15"></a><span class="c1"># Interpret</span>
<a id="__codelineno-74-16" name="__codelineno-74-16" href="#__codelineno-74-16"></a><span class="k">if</span> <span class="n">mc_result</span><span class="o">.</span><span class="n">is_robust</span><span class="p">[</span><span class="s1">&#39;sharpe_ratio&#39;</span><span class="p">]:</span>
<a id="__codelineno-74-17" name="__codelineno-74-17" href="#__codelineno-74-17"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✅ Strategy validated: Performance likely genuine&quot;</span><span class="p">)</span>
<a id="__codelineno-74-18" name="__codelineno-74-18" href="#__codelineno-74-18"></a><span class="k">else</span><span class="p">:</span>
<a id="__codelineno-74-19" name="__codelineno-74-19" href="#__codelineno-74-19"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;⚠️  Warning: Performance may be due to lucky trade sequence&quot;</span><span class="p">)</span>
</code></pre></div></p>
<h4 id="2-integration-with-optimization">2. Integration with Optimization<a class="headerlink" href="#2-integration-with-optimization" title="Permanent link">&para;</a></h4>
<p><strong>Combine with parameter optimization</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="c1"># 1. Optimize parameters</span>
<a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a><span class="n">optimizer</span> <span class="o">=</span> <span class="n">RandomSearchAlgorithm</span><span class="p">(</span><span class="n">param_space</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a><span class="n">best_params</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">objective</span><span class="p">)</span>
<a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a>
<a id="__codelineno-75-5" name="__codelineno-75-5" href="#__codelineno-75-5"></a><span class="c1"># 2. Run backtest with best params</span>
<a id="__codelineno-75-6" name="__codelineno-75-6" href="#__codelineno-75-6"></a><span class="n">best_result</span> <span class="o">=</span> <span class="n">run_backtest</span><span class="p">(</span><span class="n">strategy</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">best_params</span><span class="p">)</span>
<a id="__codelineno-75-7" name="__codelineno-75-7" href="#__codelineno-75-7"></a>
<a id="__codelineno-75-8" name="__codelineno-75-8" href="#__codelineno-75-8"></a><span class="c1"># 3. Validate with Monte Carlo</span>
<a id="__codelineno-75-9" name="__codelineno-75-9" href="#__codelineno-75-9"></a><span class="n">mc</span> <span class="o">=</span> <span class="n">MonteCarloSimulator</span><span class="p">(</span><span class="n">n_simulations</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<a id="__codelineno-75-10" name="__codelineno-75-10" href="#__codelineno-75-10"></a><span class="n">mc_result</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">best_result</span><span class="o">.</span><span class="n">transactions</span><span class="p">,</span> <span class="n">best_result</span><span class="o">.</span><span class="n">metrics</span><span class="p">)</span>
<a id="__codelineno-75-11" name="__codelineno-75-11" href="#__codelineno-75-11"></a>
<a id="__codelineno-75-12" name="__codelineno-75-12" href="#__codelineno-75-12"></a><span class="c1"># 4. Check robustness</span>
<a id="__codelineno-75-13" name="__codelineno-75-13" href="#__codelineno-75-13"></a><span class="k">if</span> <span class="ow">not</span> <span class="n">mc_result</span><span class="o">.</span><span class="n">is_robust</span><span class="p">[</span><span class="s1">&#39;sharpe_ratio&#39;</span><span class="p">]:</span>
<a id="__codelineno-75-14" name="__codelineno-75-14" href="#__codelineno-75-14"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;⚠️  Optimized parameters may be overfit&quot;</span><span class="p">)</span>
<a id="__codelineno-75-15" name="__codelineno-75-15" href="#__codelineno-75-15"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Consider walk-forward validation&quot;</span><span class="p">)</span>
</code></pre></div></p>
<h4 id="3-multiple-metrics-analysis">3. Multiple Metrics Analysis<a class="headerlink" href="#3-multiple-metrics-analysis" title="Permanent link">&para;</a></h4>
<p><strong>Test robustness of multiple metrics</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="n">observed</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a>    <span class="s1">&#39;sharpe_ratio&#39;</span><span class="p">:</span> <span class="n">backtest_result</span><span class="o">.</span><span class="n">sharpe_ratio</span><span class="p">,</span>
<a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a>    <span class="s1">&#39;total_return&#39;</span><span class="p">:</span> <span class="n">backtest_result</span><span class="o">.</span><span class="n">total_return</span><span class="p">,</span>
<a id="__codelineno-76-4" name="__codelineno-76-4" href="#__codelineno-76-4"></a>    <span class="s1">&#39;max_drawdown&#39;</span><span class="p">:</span> <span class="n">backtest_result</span><span class="o">.</span><span class="n">max_drawdown</span><span class="p">,</span>
<a id="__codelineno-76-5" name="__codelineno-76-5" href="#__codelineno-76-5"></a>    <span class="s1">&#39;win_rate&#39;</span><span class="p">:</span> <span class="n">backtest_result</span><span class="o">.</span><span class="n">win_rate</span><span class="p">,</span>
<a id="__codelineno-76-6" name="__codelineno-76-6" href="#__codelineno-76-6"></a><span class="p">}</span>
<a id="__codelineno-76-7" name="__codelineno-76-7" href="#__codelineno-76-7"></a>
<a id="__codelineno-76-8" name="__codelineno-76-8" href="#__codelineno-76-8"></a><span class="n">mc_result</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">trades</span><span class="p">,</span> <span class="n">observed</span><span class="p">)</span>
<a id="__codelineno-76-9" name="__codelineno-76-9" href="#__codelineno-76-9"></a>
<a id="__codelineno-76-10" name="__codelineno-76-10" href="#__codelineno-76-10"></a><span class="c1"># Check each metric</span>
<a id="__codelineno-76-11" name="__codelineno-76-11" href="#__codelineno-76-11"></a><span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;sharpe_ratio&#39;</span><span class="p">,</span> <span class="s1">&#39;total_return&#39;</span><span class="p">,</span> <span class="s1">&#39;max_drawdown&#39;</span><span class="p">,</span> <span class="s1">&#39;win_rate&#39;</span><span class="p">]:</span>
<a id="__codelineno-76-12" name="__codelineno-76-12" href="#__codelineno-76-12"></a>    <span class="k">if</span> <span class="n">mc_result</span><span class="o">.</span><span class="n">is_robust</span><span class="p">[</span><span class="n">metric</span><span class="p">]:</span>
<a id="__codelineno-76-13" name="__codelineno-76-13" href="#__codelineno-76-13"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2">: Robust&quot;</span><span class="p">)</span>
<a id="__codelineno-76-14" name="__codelineno-76-14" href="#__codelineno-76-14"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-76-15" name="__codelineno-76-15" href="#__codelineno-76-15"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2">: Not robust&quot;</span><span class="p">)</span>
</code></pre></div></p>
<h3 id="interpretation-guide">Interpretation Guide<a class="headerlink" href="#interpretation-guide" title="Permanent link">&para;</a></h3>
<h4 id="robust-strategy-indicators">Robust Strategy Indicators<a class="headerlink" href="#robust-strategy-indicators" title="Permanent link">&para;</a></h4>
<p><strong>All positive signs</strong>:
1. <strong>Observed outside 95% CI</strong> (especially above upper bound)
2. <strong>High percentile rank</strong> (&gt;95th)
3. <strong>Low p-value</strong> (&lt;0.05)
4. <strong>Narrow confidence interval</strong> (consistent across permutations)</p>
<p><strong>Example</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a>Observed Sharpe: 2.50
<a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a>95% CI: [0.80, 1.60]
<a id="__codelineno-77-3" name="__codelineno-77-3" href="#__codelineno-77-3"></a>P-value: 0.01
<a id="__codelineno-77-4" name="__codelineno-77-4" href="#__codelineno-77-4"></a>Percentile: 99.0
<a id="__codelineno-77-5" name="__codelineno-77-5" href="#__codelineno-77-5"></a>
<a id="__codelineno-77-6" name="__codelineno-77-6" href="#__codelineno-77-6"></a>✅ ROBUST: Observed far above CI, highly significant
</code></pre></div></p>
<h4 id="luck-indicators">Luck Indicators<a class="headerlink" href="#luck-indicators" title="Permanent link">&para;</a></h4>
<p><strong>Warning signs</strong>:
1. <strong>Observed inside 95% CI</strong>
2. <strong>Moderate percentile rank</strong> (50-90th)
3. <strong>High p-value</strong> (&gt;0.10)
4. <strong>Wide confidence interval</strong> (high variance across permutations)</p>
<p><strong>Example</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a>Observed Sharpe: 1.20
<a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a>95% CI: [0.90, 1.50]
<a id="__codelineno-78-3" name="__codelineno-78-3" href="#__codelineno-78-3"></a>P-value: 0.25
<a id="__codelineno-78-4" name="__codelineno-78-4" href="#__codelineno-78-4"></a>Percentile: 75.0
<a id="__codelineno-78-5" name="__codelineno-78-5" href="#__codelineno-78-5"></a>
<a id="__codelineno-78-6" name="__codelineno-78-6" href="#__codelineno-78-6"></a>❌ NOT ROBUST: Observed within CI, not significant
</code></pre></div></p>
<h4 id="edge-cases">Edge Cases<a class="headerlink" href="#edge-cases" title="Permanent link">&para;</a></h4>
<p><strong>Unlucky strategy</strong> (good process, bad sequence):
<div class="highlight"><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a>Observed Sharpe: 0.80
<a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a>95% CI: [0.90, 1.50]
<a id="__codelineno-79-3" name="__codelineno-79-3" href="#__codelineno-79-3"></a>P-value: 0.95
<a id="__codelineno-79-4" name="__codelineno-79-4" href="#__codelineno-79-4"></a>Percentile: 5.0
<a id="__codelineno-79-5" name="__codelineno-79-5" href="#__codelineno-79-5"></a>
<a id="__codelineno-79-6" name="__codelineno-79-6" href="#__codelineno-79-6"></a>⚠️  UNUSUAL: Observed below CI (unlucky trade sequence)
<a id="__codelineno-79-7" name="__codelineno-79-7" href="#__codelineno-79-7"></a>Strategy might be better than backtest suggests!
</code></pre></div></p>
<h3 id="technical-implementation_2">Technical Implementation<a class="headerlink" href="#technical-implementation_2" title="Permanent link">&para;</a></h3>
<h4 id="permutation-algorithm">Permutation Algorithm<a class="headerlink" href="#permutation-algorithm" title="Permanent link">&para;</a></h4>
<p><strong>Shuffle preserving trade outcomes</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a><span class="k">def</span> <span class="nf">_permute_trades</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trade_data</span><span class="p">):</span>
<a id="__codelineno-80-2" name="__codelineno-80-2" href="#__codelineno-80-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Permute trade order using Fisher-Yates shuffle.&quot;&quot;&quot;</span>
<a id="__codelineno-80-3" name="__codelineno-80-3" href="#__codelineno-80-3"></a>    <span class="n">n_trades</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">trade_data</span><span class="p">[</span><span class="s1">&#39;returns&#39;</span><span class="p">])</span>
<a id="__codelineno-80-4" name="__codelineno-80-4" href="#__codelineno-80-4"></a>    <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="n">n_trades</span><span class="p">)</span>
<a id="__codelineno-80-5" name="__codelineno-80-5" href="#__codelineno-80-5"></a>
<a id="__codelineno-80-6" name="__codelineno-80-6" href="#__codelineno-80-6"></a>    <span class="k">return</span> <span class="p">(</span>
<a id="__codelineno-80-7" name="__codelineno-80-7" href="#__codelineno-80-7"></a>        <span class="n">trade_data</span><span class="p">[</span><span class="s1">&#39;returns&#39;</span><span class="p">][</span><span class="n">indices</span><span class="p">],</span>
<a id="__codelineno-80-8" name="__codelineno-80-8" href="#__codelineno-80-8"></a>        <span class="n">trade_data</span><span class="p">[</span><span class="s1">&#39;pnl&#39;</span><span class="p">][</span><span class="n">indices</span><span class="p">],</span>
<a id="__codelineno-80-9" name="__codelineno-80-9" href="#__codelineno-80-9"></a>    <span class="p">)</span>
</code></pre></div></p>
<p><strong>Properties</strong>:
- Uniform random permutation (all orders equally likely)
- O(n) time complexity
- Preserves trade outcomes exactly</p>
<h4 id="equity-curve-reconstruction">Equity Curve Reconstruction<a class="headerlink" href="#equity-curve-reconstruction" title="Permanent link">&para;</a></h4>
<p><strong>Rebuild equity from shuffled trades</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a><span class="k">def</span> <span class="nf">_reconstruct_equity_curve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pnl_sequence</span><span class="p">,</span> <span class="n">initial_capital</span><span class="p">):</span>
<a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Reconstruct equity curve from PnL sequence.&quot;&quot;&quot;</span>
<a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a>    <span class="n">equity_curve</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pnl_sequence</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-81-4" name="__codelineno-81-4" href="#__codelineno-81-4"></a>    <span class="n">equity_curve</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">initial_capital</span>
<a id="__codelineno-81-5" name="__codelineno-81-5" href="#__codelineno-81-5"></a>    <span class="n">equity_curve</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">initial_capital</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">pnl_sequence</span><span class="p">)</span>
<a id="__codelineno-81-6" name="__codelineno-81-6" href="#__codelineno-81-6"></a>    <span class="k">return</span> <span class="n">equity_curve</span>
</code></pre></div></p>
<p><strong>Metrics recalculated</strong>:
- Sharpe ratio (from return sequence)
- Total return (from equity curve)
- Maximum drawdown (from equity curve peaks/troughs)
- Win rate (from return signs)</p>
<h4 id="statistical-metrics">Statistical Metrics<a class="headerlink" href="#statistical-metrics" title="Permanent link">&para;</a></h4>
<p><strong>Confidence intervals</strong> (percentile method):
<div class="highlight"><pre><span></span><code><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a><span class="n">ci_lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">distribution</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>   <span class="c1"># 2.5th percentile</span>
<a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a><span class="n">ci_upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">distribution</span><span class="p">,</span> <span class="mf">97.5</span><span class="p">)</span>  <span class="c1"># 97.5th percentile</span>
</code></pre></div></p>
<p><strong>P-values</strong> (empirical):
<div class="highlight"><pre><span></span><code><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a><span class="c1"># For positive metrics (higher is better)</span>
<a id="__codelineno-83-2" name="__codelineno-83-2" href="#__codelineno-83-2"></a><span class="n">p_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">distribution</span> <span class="o">&gt;=</span> <span class="n">observed</span><span class="p">)</span>
<a id="__codelineno-83-3" name="__codelineno-83-3" href="#__codelineno-83-3"></a>
<a id="__codelineno-83-4" name="__codelineno-83-4" href="#__codelineno-83-4"></a><span class="c1"># For max_drawdown (lower is better)</span>
<a id="__codelineno-83-5" name="__codelineno-83-5" href="#__codelineno-83-5"></a><span class="n">p_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">distribution</span> <span class="o">&lt;=</span> <span class="n">observed</span><span class="p">)</span>
</code></pre></div></p>
<p><strong>Percentile rank</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">percentileofscore</span>
<a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a><span class="n">percentile</span> <span class="o">=</span> <span class="n">percentileofscore</span><span class="p">(</span><span class="n">distribution</span><span class="p">,</span> <span class="n">observed</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;rank&#39;</span><span class="p">)</span>
</code></pre></div></p>
<h3 id="performance-considerations_1">Performance Considerations<a class="headerlink" href="#performance-considerations_1" title="Permanent link">&para;</a></h3>
<p><strong>Computational cost</strong>:
- <strong>N simulations</strong> × <strong>trade reconstruction</strong> × <strong>metrics calculation</strong>
- Example: 1000 simulations × 100 trades = ~0.5 seconds</p>
<p><strong>Optimization strategies</strong>:
1. <strong>Use seed</strong>: Reproducible results for testing
2. <strong>Parallel execution</strong>: Run simulations in parallel (future enhancement)
3. <strong>Early stopping</strong>: Stop if distribution converged (future enhancement)</p>
<p><strong>Typical configuration</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a><span class="c1"># Development/testing</span>
<a id="__codelineno-85-2" name="__codelineno-85-2" href="#__codelineno-85-2"></a><span class="n">n_simulations</span><span class="o">=</span><span class="mi">100</span>    <span class="c1"># Fast iteration</span>
<a id="__codelineno-85-3" name="__codelineno-85-3" href="#__codelineno-85-3"></a>
<a id="__codelineno-85-4" name="__codelineno-85-4" href="#__codelineno-85-4"></a><span class="c1"># Production validation</span>
<a id="__codelineno-85-5" name="__codelineno-85-5" href="#__codelineno-85-5"></a><span class="n">n_simulations</span><span class="o">=</span><span class="mi">1000</span>   <span class="c1"># Standard</span>
<a id="__codelineno-85-6" name="__codelineno-85-6" href="#__codelineno-85-6"></a>
<a id="__codelineno-85-7" name="__codelineno-85-7" href="#__codelineno-85-7"></a><span class="c1"># High-stakes validation</span>
<a id="__codelineno-85-8" name="__codelineno-85-8" href="#__codelineno-85-8"></a><span class="n">n_simulations</span><span class="o">=</span><span class="mi">10000</span>  <span class="c1"># Publication-grade confidence</span>
</code></pre></div></p>
<h3 id="limitations-and-caveats_1">Limitations and Caveats<a class="headerlink" href="#limitations-and-caveats_1" title="Permanent link">&para;</a></h3>
<h4 id="1-assumes-iid-trades">1. Assumes IID Trades<a class="headerlink" href="#1-assumes-iid-trades" title="Permanent link">&para;</a></h4>
<p>Monte Carlo permutation assumes trades are <strong>independent and identically distributed</strong> (IID).</p>
<p><strong>Violated when</strong>:
- <strong>Serial correlation</strong>: Winning trades cluster in time
- <strong>Regime changes</strong>: Market conditions shift during backtest
- <strong>Position sizing dependencies</strong>: Trade size depends on prior results</p>
<p><strong>Mitigation</strong>: Use walk-forward validation to account for temporal dependencies.</p>
<h4 id="2-preserves-trade-outcomes">2. Preserves Trade Outcomes<a class="headerlink" href="#2-preserves-trade-outcomes" title="Permanent link">&para;</a></h4>
<p>Permutation <strong>does not</strong> test if individual trades are lucky.</p>
<p><strong>What it tests</strong>: Is the <em>sequence</em> lucky?
<strong>What it doesn't test</strong>: Are the individual trades themselves lucky?</p>
<p><strong>Example</strong>:
- If all trades are wins → All permutations will have high Sharpe
- Monte Carlo won't detect that <em>all wins</em> might be lucky</p>
<p><strong>Mitigation</strong>: Combine with other validation (walk-forward, out-of-sample).</p>
<h4 id="3-distribution-assumptions">3. Distribution Assumptions<a class="headerlink" href="#3-distribution-assumptions" title="Permanent link">&para;</a></h4>
<p>Statistical tests assume <strong>sufficient simulations</strong> for valid distributions.</p>
<p><strong>Minimum recommended</strong>:
- 100 simulations: Rough estimate
- 1000 simulations: Standard (95% CI reliable)
- 10000 simulations: High confidence</p>
<h4 id="4-interpretation-context">4. Interpretation Context<a class="headerlink" href="#4-interpretation-context" title="Permanent link">&para;</a></h4>
<p>Monte Carlo validation is <strong>one piece</strong> of robustness assessment.</p>
<p><strong>Complete validation requires</strong>:
1. <strong>Parameter sensitivity</strong> (Story 5.8)
2. <strong>Walk-forward testing</strong> (Story 5.7)
3. <strong>Monte Carlo permutation</strong> (Story 5.9)
4. <strong>Out-of-sample testing</strong></p>
<h3 id="integration-with-validation-pipeline">Integration with Validation Pipeline<a class="headerlink" href="#integration-with-validation-pipeline" title="Permanent link">&para;</a></h3>
<p><strong>Recommended validation workflow</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a><span class="c1"># 1. Parameter optimization</span>
<a id="__codelineno-86-2" name="__codelineno-86-2" href="#__codelineno-86-2"></a><span class="n">best_params</span> <span class="o">=</span> <span class="n">optimize_parameters</span><span class="p">(</span><span class="n">strategy</span><span class="p">,</span> <span class="n">train_data</span><span class="p">)</span>
<a id="__codelineno-86-3" name="__codelineno-86-3" href="#__codelineno-86-3"></a>
<a id="__codelineno-86-4" name="__codelineno-86-4" href="#__codelineno-86-4"></a><span class="c1"># 2. Parameter sensitivity analysis</span>
<a id="__codelineno-86-5" name="__codelineno-86-5" href="#__codelineno-86-5"></a><span class="n">sensitivity</span> <span class="o">=</span> <span class="n">analyze_sensitivity</span><span class="p">(</span><span class="n">best_params</span><span class="p">)</span>
<a id="__codelineno-86-6" name="__codelineno-86-6" href="#__codelineno-86-6"></a><span class="k">if</span> <span class="n">any_sensitive_parameters</span><span class="p">(</span><span class="n">sensitivity</span><span class="p">):</span>
<a id="__codelineno-86-7" name="__codelineno-86-7" href="#__codelineno-86-7"></a>    <span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Potential parameter overfitting&quot;</span><span class="p">)</span>
<a id="__codelineno-86-8" name="__codelineno-86-8" href="#__codelineno-86-8"></a>
<a id="__codelineno-86-9" name="__codelineno-86-9" href="#__codelineno-86-9"></a><span class="c1"># 3. Walk-forward validation</span>
<a id="__codelineno-86-10" name="__codelineno-86-10" href="#__codelineno-86-10"></a><span class="n">wf_result</span> <span class="o">=</span> <span class="n">walk_forward_optimize</span><span class="p">(</span><span class="n">strategy</span><span class="p">,</span> <span class="n">full_data</span><span class="p">,</span> <span class="n">best_params</span><span class="p">)</span>
<a id="__codelineno-86-11" name="__codelineno-86-11" href="#__codelineno-86-11"></a><span class="k">if</span> <span class="n">wf_result</span><span class="o">.</span><span class="n">train_test_degradation</span> <span class="o">&gt;</span> <span class="mf">0.3</span><span class="p">:</span>
<a id="__codelineno-86-12" name="__codelineno-86-12" href="#__codelineno-86-12"></a>    <span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Performance degradation on out-of-sample data&quot;</span><span class="p">)</span>
<a id="__codelineno-86-13" name="__codelineno-86-13" href="#__codelineno-86-13"></a>
<a id="__codelineno-86-14" name="__codelineno-86-14" href="#__codelineno-86-14"></a><span class="c1"># 4. Monte Carlo permutation</span>
<a id="__codelineno-86-15" name="__codelineno-86-15" href="#__codelineno-86-15"></a><span class="n">mc_result</span> <span class="o">=</span> <span class="n">monte_carlo_simulate</span><span class="p">(</span><span class="n">wf_result</span><span class="o">.</span><span class="n">trades</span><span class="p">,</span> <span class="n">wf_result</span><span class="o">.</span><span class="n">metrics</span><span class="p">)</span>
<a id="__codelineno-86-16" name="__codelineno-86-16" href="#__codelineno-86-16"></a><span class="k">if</span> <span class="ow">not</span> <span class="n">mc_result</span><span class="o">.</span><span class="n">is_robust</span><span class="p">:</span>
<a id="__codelineno-86-17" name="__codelineno-86-17" href="#__codelineno-86-17"></a>    <span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Performance may be due to lucky trade sequence&quot;</span><span class="p">)</span>
<a id="__codelineno-86-18" name="__codelineno-86-18" href="#__codelineno-86-18"></a>
<a id="__codelineno-86-19" name="__codelineno-86-19" href="#__codelineno-86-19"></a><span class="c1"># 5. Final decision</span>
<a id="__codelineno-86-20" name="__codelineno-86-20" href="#__codelineno-86-20"></a><span class="k">if</span> <span class="n">all_validation_passed</span><span class="p">():</span>
<a id="__codelineno-86-21" name="__codelineno-86-21" href="#__codelineno-86-21"></a>    <span class="n">deploy_strategy</span><span class="p">()</span>
<a id="__codelineno-86-22" name="__codelineno-86-22" href="#__codelineno-86-22"></a><span class="k">else</span><span class="p">:</span>
<a id="__codelineno-86-23" name="__codelineno-86-23" href="#__codelineno-86-23"></a>    <span class="n">refine_strategy_or_reject</span><span class="p">()</span>
</code></pre></div></p>
<h3 id="example-complete-analysis_1">Example: Complete Analysis<a class="headerlink" href="#example-complete-analysis_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a><span class="kn">from</span> <span class="nn">rustybt.optimization.monte_carlo</span> <span class="kn">import</span> <span class="n">MonteCarloSimulator</span>
<a id="__codelineno-87-2" name="__codelineno-87-2" href="#__codelineno-87-2"></a><span class="kn">import</span> <span class="nn">polars</span> <span class="k">as</span> <span class="nn">pl</span>
<a id="__codelineno-87-3" name="__codelineno-87-3" href="#__codelineno-87-3"></a><span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span>
<a id="__codelineno-87-4" name="__codelineno-87-4" href="#__codelineno-87-4"></a>
<a id="__codelineno-87-5" name="__codelineno-87-5" href="#__codelineno-87-5"></a><span class="c1"># Setup: Extract trades from backtest</span>
<a id="__codelineno-87-6" name="__codelineno-87-6" href="#__codelineno-87-6"></a><span class="n">trades</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s1">&#39;backtest_trades.parquet&#39;</span><span class="p">)</span>
<a id="__codelineno-87-7" name="__codelineno-87-7" href="#__codelineno-87-7"></a>
<a id="__codelineno-87-8" name="__codelineno-87-8" href="#__codelineno-87-8"></a><span class="c1"># Observed performance</span>
<a id="__codelineno-87-9" name="__codelineno-87-9" href="#__codelineno-87-9"></a><span class="n">observed</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-87-10" name="__codelineno-87-10" href="#__codelineno-87-10"></a>    <span class="s1">&#39;sharpe_ratio&#39;</span><span class="p">:</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;1.85&#39;</span><span class="p">),</span>
<a id="__codelineno-87-11" name="__codelineno-87-11" href="#__codelineno-87-11"></a>    <span class="s1">&#39;total_return&#39;</span><span class="p">:</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;0.32&#39;</span><span class="p">),</span>
<a id="__codelineno-87-12" name="__codelineno-87-12" href="#__codelineno-87-12"></a>    <span class="s1">&#39;max_drawdown&#39;</span><span class="p">:</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;0.12&#39;</span><span class="p">),</span>
<a id="__codelineno-87-13" name="__codelineno-87-13" href="#__codelineno-87-13"></a>    <span class="s1">&#39;win_rate&#39;</span><span class="p">:</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;0.58&#39;</span><span class="p">),</span>
<a id="__codelineno-87-14" name="__codelineno-87-14" href="#__codelineno-87-14"></a><span class="p">}</span>
<a id="__codelineno-87-15" name="__codelineno-87-15" href="#__codelineno-87-15"></a>
<a id="__codelineno-87-16" name="__codelineno-87-16" href="#__codelineno-87-16"></a><span class="c1"># Create Monte Carlo simulator</span>
<a id="__codelineno-87-17" name="__codelineno-87-17" href="#__codelineno-87-17"></a><span class="n">mc</span> <span class="o">=</span> <span class="n">MonteCarloSimulator</span><span class="p">(</span>
<a id="__codelineno-87-18" name="__codelineno-87-18" href="#__codelineno-87-18"></a>    <span class="n">n_simulations</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
<a id="__codelineno-87-19" name="__codelineno-87-19" href="#__codelineno-87-19"></a>    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;permutation&#39;</span><span class="p">,</span>
<a id="__codelineno-87-20" name="__codelineno-87-20" href="#__codelineno-87-20"></a>    <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
<a id="__codelineno-87-21" name="__codelineno-87-21" href="#__codelineno-87-21"></a>    <span class="n">confidence_level</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span>
<a id="__codelineno-87-22" name="__codelineno-87-22" href="#__codelineno-87-22"></a><span class="p">)</span>
<a id="__codelineno-87-23" name="__codelineno-87-23" href="#__codelineno-87-23"></a>
<a id="__codelineno-87-24" name="__codelineno-87-24" href="#__codelineno-87-24"></a><span class="c1"># Run simulation</span>
<a id="__codelineno-87-25" name="__codelineno-87-25" href="#__codelineno-87-25"></a><span class="n">result</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">trades</span><span class="p">,</span> <span class="n">observed</span><span class="p">,</span> <span class="n">initial_capital</span><span class="o">=</span><span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;100000&#39;</span><span class="p">))</span>
<a id="__codelineno-87-26" name="__codelineno-87-26" href="#__codelineno-87-26"></a>
<a id="__codelineno-87-27" name="__codelineno-87-27" href="#__codelineno-87-27"></a><span class="c1"># Generate summary</span>
<a id="__codelineno-87-28" name="__codelineno-87-28" href="#__codelineno-87-28"></a><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">get_summary</span><span class="p">(</span><span class="s1">&#39;sharpe_ratio&#39;</span><span class="p">))</span>
<a id="__codelineno-87-29" name="__codelineno-87-29" href="#__codelineno-87-29"></a><span class="c1"># Output:</span>
<a id="__codelineno-87-30" name="__codelineno-87-30" href="#__codelineno-87-30"></a><span class="c1"># Monte Carlo Analysis (1000 simulations, permutation method)</span>
<a id="__codelineno-87-31" name="__codelineno-87-31" href="#__codelineno-87-31"></a><span class="c1"># Metric: sharpe_ratio</span>
<a id="__codelineno-87-32" name="__codelineno-87-32" href="#__codelineno-87-32"></a><span class="c1"># Observed: 1.8500</span>
<a id="__codelineno-87-33" name="__codelineno-87-33" href="#__codelineno-87-33"></a><span class="c1"># 95% CI: [1.2300, 1.6800]</span>
<a id="__codelineno-87-34" name="__codelineno-87-34" href="#__codelineno-87-34"></a><span class="c1"># P-value: 0.0080</span>
<a id="__codelineno-87-35" name="__codelineno-87-35" href="#__codelineno-87-35"></a><span class="c1"># Percentile: 99.2</span>
<a id="__codelineno-87-36" name="__codelineno-87-36" href="#__codelineno-87-36"></a><span class="c1">#</span>
<a id="__codelineno-87-37" name="__codelineno-87-37" href="#__codelineno-87-37"></a><span class="c1"># ✅ ROBUST: Strategy is statistically significant and outside 95% CI</span>
<a id="__codelineno-87-38" name="__codelineno-87-38" href="#__codelineno-87-38"></a>
<a id="__codelineno-87-39" name="__codelineno-87-39" href="#__codelineno-87-39"></a><span class="c1"># Visualize</span>
<a id="__codelineno-87-40" name="__codelineno-87-40" href="#__codelineno-87-40"></a><span class="n">result</span><span class="o">.</span><span class="n">plot_distribution</span><span class="p">(</span><span class="s1">&#39;sharpe_ratio&#39;</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="s1">&#39;mc_sharpe.png&#39;</span><span class="p">)</span>
<a id="__codelineno-87-41" name="__codelineno-87-41" href="#__codelineno-87-41"></a><span class="n">result</span><span class="o">.</span><span class="n">plot_distribution</span><span class="p">(</span><span class="s1">&#39;total_return&#39;</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="s1">&#39;mc_return.png&#39;</span><span class="p">)</span>
<a id="__codelineno-87-42" name="__codelineno-87-42" href="#__codelineno-87-42"></a><span class="n">result</span><span class="o">.</span><span class="n">plot_distribution</span><span class="p">(</span><span class="s1">&#39;max_drawdown&#39;</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="s1">&#39;mc_drawdown.png&#39;</span><span class="p">)</span>
<a id="__codelineno-87-43" name="__codelineno-87-43" href="#__codelineno-87-43"></a>
<a id="__codelineno-87-44" name="__codelineno-87-44" href="#__codelineno-87-44"></a><span class="c1"># Check each metric</span>
<a id="__codelineno-87-45" name="__codelineno-87-45" href="#__codelineno-87-45"></a><span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;sharpe_ratio&#39;</span><span class="p">,</span> <span class="s1">&#39;total_return&#39;</span><span class="p">,</span> <span class="s1">&#39;max_drawdown&#39;</span><span class="p">,</span> <span class="s1">&#39;win_rate&#39;</span><span class="p">]:</span>
<a id="__codelineno-87-46" name="__codelineno-87-46" href="#__codelineno-87-46"></a>    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">is_significant</span><span class="p">[</span><span class="n">metric</span><span class="p">]</span> <span class="ow">and</span> <span class="n">result</span><span class="o">.</span><span class="n">is_robust</span><span class="p">[</span><span class="n">metric</span><span class="p">]:</span>
<a id="__codelineno-87-47" name="__codelineno-87-47" href="#__codelineno-87-47"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2">: Robust and significant&quot;</span><span class="p">)</span>
<a id="__codelineno-87-48" name="__codelineno-87-48" href="#__codelineno-87-48"></a>    <span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">is_significant</span><span class="p">[</span><span class="n">metric</span><span class="p">]:</span>
<a id="__codelineno-87-49" name="__codelineno-87-49" href="#__codelineno-87-49"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;⚠️  </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2">: Significant but near CI boundary&quot;</span><span class="p">)</span>
<a id="__codelineno-87-50" name="__codelineno-87-50" href="#__codelineno-87-50"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-87-51" name="__codelineno-87-51" href="#__codelineno-87-51"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2">: Not statistically significant&quot;</span><span class="p">)</span>
<a id="__codelineno-87-52" name="__codelineno-87-52" href="#__codelineno-87-52"></a>
<a id="__codelineno-87-53" name="__codelineno-87-53" href="#__codelineno-87-53"></a><span class="c1"># Export results for reporting</span>
<a id="__codelineno-87-54" name="__codelineno-87-54" href="#__codelineno-87-54"></a><span class="kn">import</span> <span class="nn">json</span>
<a id="__codelineno-87-55" name="__codelineno-87-55" href="#__codelineno-87-55"></a><span class="n">report</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-87-56" name="__codelineno-87-56" href="#__codelineno-87-56"></a>    <span class="s1">&#39;observed&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">observed_metrics</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
<a id="__codelineno-87-57" name="__codelineno-87-57" href="#__codelineno-87-57"></a>    <span class="s1">&#39;confidence_intervals&#39;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-87-58" name="__codelineno-87-58" href="#__codelineno-87-58"></a>        <span class="n">k</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
<a id="__codelineno-87-59" name="__codelineno-87-59" href="#__codelineno-87-59"></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">confidence_intervals</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<a id="__codelineno-87-60" name="__codelineno-87-60" href="#__codelineno-87-60"></a>    <span class="p">},</span>
<a id="__codelineno-87-61" name="__codelineno-87-61" href="#__codelineno-87-61"></a>    <span class="s1">&#39;p_values&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">p_values</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
<a id="__codelineno-87-62" name="__codelineno-87-62" href="#__codelineno-87-62"></a>    <span class="s1">&#39;percentile_ranks&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">percentile_ranks</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
<a id="__codelineno-87-63" name="__codelineno-87-63" href="#__codelineno-87-63"></a>    <span class="s1">&#39;is_significant&#39;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">is_significant</span><span class="p">,</span>
<a id="__codelineno-87-64" name="__codelineno-87-64" href="#__codelineno-87-64"></a>    <span class="s1">&#39;is_robust&#39;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">is_robust</span><span class="p">,</span>
<a id="__codelineno-87-65" name="__codelineno-87-65" href="#__codelineno-87-65"></a><span class="p">}</span>
<a id="__codelineno-87-66" name="__codelineno-87-66" href="#__codelineno-87-66"></a>
<a id="__codelineno-87-67" name="__codelineno-87-67" href="#__codelineno-87-67"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;monte_carlo_report.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-87-68" name="__codelineno-87-68" href="#__codelineno-87-68"></a>    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div>
<h3 id="references_1">References<a class="headerlink" href="#references_1" title="Permanent link">&para;</a></h3>
<p><strong>Theoretical Foundation</strong>:
- <strong>Permutation Tests</strong>: Fisher (1935) - "The Design of Experiments"
- <strong>Bootstrap Methods</strong>: Efron (1979) - "Bootstrap Methods: Another Look at the Jackknife"
- <strong>Trading System Validation</strong>: Aronson (2006) - "Evidence-Based Technical Analysis"</p>
<p><strong>Related Work</strong>:
- <strong>QuantConnect</strong>: Bootstrap analysis for strategy validation
- <strong>Backtrader</strong>: Monte Carlo module for trade permutation
- <strong>PySystemTrade</strong>: Permutation testing in validation framework</p>
<hr />
<h2 id="noise-infusion-simulation">Noise Infusion Simulation<a class="headerlink" href="#noise-infusion-simulation" title="Permanent link">&para;</a></h2>
<h3 id="overview_4">Overview<a class="headerlink" href="#overview_4" title="Permanent link">&para;</a></h3>
<p><strong>NoiseInfusionSimulator</strong> tests if strategy performance is overfit to specific historical price patterns by adding synthetic noise to OHLCV data and measuring performance degradation. This is analogous to data augmentation and regularization in machine learning - validating that the strategy generalizes beyond noise-free historical data.</p>
<h3 id="concept">Concept<a class="headerlink" href="#concept" title="Permanent link">&para;</a></h3>
<p>Unlike Monte Carlo permutation (which shuffles trade order), noise infusion perturbs the actual price data:</p>
<ol>
<li><strong>Add synthetic noise</strong> to OHLCV data (Gaussian or bootstrap)</li>
<li><strong>Validate OHLCV constraints</strong> (high ≥ low, etc.)</li>
<li><strong>Re-run backtest</strong> on noisy data</li>
<li><strong>Repeat N times</strong> with different noise seeds</li>
<li><strong>Measure degradation</strong> in performance metrics</li>
</ol>
<p><strong>Key Question</strong>: Does strategy performance collapse when prices are slightly perturbed?</p>
<h3 id="architecture_1">Architecture<a class="headerlink" href="#architecture_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a><span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span>
<a id="__codelineno-88-3" name="__codelineno-88-3" href="#__codelineno-88-3"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">Callable</span>
<a id="__codelineno-88-4" name="__codelineno-88-4" href="#__codelineno-88-4"></a><span class="kn">import</span> <span class="nn">polars</span> <span class="k">as</span> <span class="nn">pl</span>
<a id="__codelineno-88-5" name="__codelineno-88-5" href="#__codelineno-88-5"></a>
<a id="__codelineno-88-6" name="__codelineno-88-6" href="#__codelineno-88-6"></a><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-88-7" name="__codelineno-88-7" href="#__codelineno-88-7"></a><span class="k">class</span> <span class="nc">NoiseInfusionResult</span><span class="p">:</span>
<a id="__codelineno-88-8" name="__codelineno-88-8" href="#__codelineno-88-8"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Noise infusion simulation result with degradation analysis.&quot;&quot;&quot;</span>
<a id="__codelineno-88-9" name="__codelineno-88-9" href="#__codelineno-88-9"></a>    <span class="n">original_metrics</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">]</span>        <span class="c1"># Noise-free backtest</span>
<a id="__codelineno-88-10" name="__codelineno-88-10" href="#__codelineno-88-10"></a>    <span class="n">noisy_metrics</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">Decimal</span><span class="p">]]</span>     <span class="c1"># Distributions from noisy runs</span>
<a id="__codelineno-88-11" name="__codelineno-88-11" href="#__codelineno-88-11"></a>    <span class="n">mean_metrics</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">]</span>            <span class="c1"># Mean across simulations</span>
<a id="__codelineno-88-12" name="__codelineno-88-12" href="#__codelineno-88-12"></a>    <span class="n">std_metrics</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">]</span>             <span class="c1"># Std dev across simulations</span>
<a id="__codelineno-88-13" name="__codelineno-88-13" href="#__codelineno-88-13"></a>    <span class="n">degradation_pct</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">]</span>         <span class="c1"># Performance degradation %</span>
<a id="__codelineno-88-14" name="__codelineno-88-14" href="#__codelineno-88-14"></a>    <span class="n">worst_case_metrics</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">]</span>      <span class="c1"># 5th percentile (worst case)</span>
<a id="__codelineno-88-15" name="__codelineno-88-15" href="#__codelineno-88-15"></a>    <span class="n">confidence_intervals</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Decimal</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">]]</span>  <span class="c1"># 95% CI</span>
<a id="__codelineno-88-16" name="__codelineno-88-16" href="#__codelineno-88-16"></a>    <span class="n">n_simulations</span><span class="p">:</span> <span class="nb">int</span>
<a id="__codelineno-88-17" name="__codelineno-88-17" href="#__codelineno-88-17"></a>    <span class="n">noise_model</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;gaussian&#39;</span><span class="p">,</span> <span class="s1">&#39;bootstrap&#39;</span><span class="p">]</span>
<a id="__codelineno-88-18" name="__codelineno-88-18" href="#__codelineno-88-18"></a>    <span class="n">std_pct</span><span class="p">:</span> <span class="n">Decimal</span>                            <span class="c1"># Noise amplitude</span>
<a id="__codelineno-88-19" name="__codelineno-88-19" href="#__codelineno-88-19"></a>    <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span>
<a id="__codelineno-88-20" name="__codelineno-88-20" href="#__codelineno-88-20"></a>
<a id="__codelineno-88-21" name="__codelineno-88-21" href="#__codelineno-88-21"></a><span class="k">class</span> <span class="nc">NoiseInfusionSimulator</span><span class="p">:</span>
<a id="__codelineno-88-22" name="__codelineno-88-22" href="#__codelineno-88-22"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Monte Carlo simulation with noise infusion for robustness testing.&quot;&quot;&quot;</span>
<a id="__codelineno-88-23" name="__codelineno-88-23" href="#__codelineno-88-23"></a>
<a id="__codelineno-88-24" name="__codelineno-88-24" href="#__codelineno-88-24"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-88-25" name="__codelineno-88-25" href="#__codelineno-88-25"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-88-26" name="__codelineno-88-26" href="#__codelineno-88-26"></a>        <span class="n">n_simulations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
<a id="__codelineno-88-27" name="__codelineno-88-27" href="#__codelineno-88-27"></a>        <span class="n">std_pct</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>              <span class="c1"># 1% noise amplitude</span>
<a id="__codelineno-88-28" name="__codelineno-88-28" href="#__codelineno-88-28"></a>        <span class="n">noise_model</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;gaussian&#39;</span><span class="p">,</span> <span class="s1">&#39;bootstrap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;gaussian&#39;</span><span class="p">,</span>
<a id="__codelineno-88-29" name="__codelineno-88-29" href="#__codelineno-88-29"></a>        <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-88-30" name="__codelineno-88-30" href="#__codelineno-88-30"></a>        <span class="n">confidence_level</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.95</span><span class="p">,</span>
<a id="__codelineno-88-31" name="__codelineno-88-31" href="#__codelineno-88-31"></a>    <span class="p">):</span>
<a id="__codelineno-88-32" name="__codelineno-88-32" href="#__codelineno-88-32"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize noise infusion simulator.&quot;&quot;&quot;</span>
<a id="__codelineno-88-33" name="__codelineno-88-33" href="#__codelineno-88-33"></a>        <span class="o">...</span>
<a id="__codelineno-88-34" name="__codelineno-88-34" href="#__codelineno-88-34"></a>
<a id="__codelineno-88-35" name="__codelineno-88-35" href="#__codelineno-88-35"></a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span>
<a id="__codelineno-88-36" name="__codelineno-88-36" href="#__codelineno-88-36"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-88-37" name="__codelineno-88-37" href="#__codelineno-88-37"></a>        <span class="n">data</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>                  <span class="c1"># OHLCV data</span>
<a id="__codelineno-88-38" name="__codelineno-88-38" href="#__codelineno-88-38"></a>        <span class="n">backtest_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">]],</span>
<a id="__codelineno-88-39" name="__codelineno-88-39" href="#__codelineno-88-39"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NoiseInfusionResult</span><span class="p">:</span>
<a id="__codelineno-88-40" name="__codelineno-88-40" href="#__codelineno-88-40"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Run noise infusion simulation.&quot;&quot;&quot;</span>
<a id="__codelineno-88-41" name="__codelineno-88-41" href="#__codelineno-88-41"></a>        <span class="o">...</span>
<a id="__codelineno-88-42" name="__codelineno-88-42" href="#__codelineno-88-42"></a>
<a id="__codelineno-88-43" name="__codelineno-88-43" href="#__codelineno-88-43"></a>    <span class="k">def</span> <span class="nf">add_noise</span><span class="p">(</span>
<a id="__codelineno-88-44" name="__codelineno-88-44" href="#__codelineno-88-44"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-88-45" name="__codelineno-88-45" href="#__codelineno-88-45"></a>        <span class="n">data</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
<a id="__codelineno-88-46" name="__codelineno-88-46" href="#__codelineno-88-46"></a>        <span class="n">sim_seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-88-47" name="__codelineno-88-47" href="#__codelineno-88-47"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-88-48" name="__codelineno-88-48" href="#__codelineno-88-48"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add noise to OHLCV data while preserving relationships.&quot;&quot;&quot;</span>
<a id="__codelineno-88-49" name="__codelineno-88-49" href="#__codelineno-88-49"></a>        <span class="o">...</span>
</code></pre></div>
<h3 id="noise-models">Noise Models<a class="headerlink" href="#noise-models" title="Permanent link">&para;</a></h3>
<h4 id="1-gaussian-noise">1. Gaussian Noise<a class="headerlink" href="#1-gaussian-noise" title="Permanent link">&para;</a></h4>
<p>Adds random returns from N(0, σ) to each bar:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a><span class="c1"># Generate noise</span>
<a id="__codelineno-89-2" name="__codelineno-89-2" href="#__codelineno-89-2"></a><span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">std_pct</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n_bars</span><span class="p">)</span>
<a id="__codelineno-89-3" name="__codelineno-89-3" href="#__codelineno-89-3"></a>
<a id="__codelineno-89-4" name="__codelineno-89-4" href="#__codelineno-89-4"></a><span class="c1"># Apply to close prices</span>
<a id="__codelineno-89-5" name="__codelineno-89-5" href="#__codelineno-89-5"></a><span class="n">close_noisy</span> <span class="o">=</span> <span class="n">close</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">noise</span><span class="p">)</span>
<a id="__codelineno-89-6" name="__codelineno-89-6" href="#__codelineno-89-6"></a>
<a id="__codelineno-89-7" name="__codelineno-89-7" href="#__codelineno-89-7"></a><span class="c1"># Scale OHLC proportionally</span>
<a id="__codelineno-89-8" name="__codelineno-89-8" href="#__codelineno-89-8"></a><span class="n">factor</span> <span class="o">=</span> <span class="n">close_noisy</span> <span class="o">/</span> <span class="n">close</span>
<a id="__codelineno-89-9" name="__codelineno-89-9" href="#__codelineno-89-9"></a><span class="n">open_noisy</span> <span class="o">=</span> <span class="nb">open</span> <span class="o">*</span> <span class="n">factor</span>
<a id="__codelineno-89-10" name="__codelineno-89-10" href="#__codelineno-89-10"></a><span class="n">high_noisy</span> <span class="o">=</span> <span class="n">high</span> <span class="o">*</span> <span class="n">factor</span>
<a id="__codelineno-89-11" name="__codelineno-89-11" href="#__codelineno-89-11"></a><span class="n">low_noisy</span> <span class="o">=</span> <span class="n">low</span> <span class="o">*</span> <span class="n">factor</span>
</code></pre></div>
<p><strong>Properties</strong>:
- Symmetric, zero-mean noise
- Simple and interpretable
- May not preserve fat tails</p>
<h4 id="2-bootstrap-noise">2. Bootstrap Noise<a class="headerlink" href="#2-bootstrap-noise" title="Permanent link">&para;</a></h4>
<p>Resamples historical returns with replacement:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a><span class="c1"># Extract historical returns</span>
<a id="__codelineno-90-2" name="__codelineno-90-2" href="#__codelineno-90-2"></a><span class="n">returns</span> <span class="o">=</span> <span class="n">close</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<a id="__codelineno-90-3" name="__codelineno-90-3" href="#__codelineno-90-3"></a>
<a id="__codelineno-90-4" name="__codelineno-90-4" href="#__codelineno-90-4"></a><span class="c1"># Bootstrap sample</span>
<a id="__codelineno-90-5" name="__codelineno-90-5" href="#__codelineno-90-5"></a><span class="n">noise_returns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">returns</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n_bars</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-90-6" name="__codelineno-90-6" href="#__codelineno-90-6"></a>
<a id="__codelineno-90-7" name="__codelineno-90-7" href="#__codelineno-90-7"></a><span class="c1"># Apply noise</span>
<a id="__codelineno-90-8" name="__codelineno-90-8" href="#__codelineno-90-8"></a><span class="n">close_noisy</span> <span class="o">=</span> <span class="n">close</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">noise_returns</span><span class="p">)</span>
</code></pre></div>
<p><strong>Properties</strong>:
- Preserves empirical return distribution
- Maintains fat tails and skewness
- More realistic for financial data</p>
<h3 id="ohlcv-constraint-validation">OHLCV Constraint Validation<a class="headerlink" href="#ohlcv-constraint-validation" title="Permanent link">&para;</a></h3>
<p>After adding noise, ensure OHLCV relationships remain valid:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a><span class="k">def</span> <span class="nf">_fix_ohlcv_relationships</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-91-2" name="__codelineno-91-2" href="#__codelineno-91-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Fix OHLCV constraints after noise.&quot;&quot;&quot;</span>
<a id="__codelineno-91-3" name="__codelineno-91-3" href="#__codelineno-91-3"></a>    <span class="c1"># Adjust high to be max of all</span>
<a id="__codelineno-91-4" name="__codelineno-91-4" href="#__codelineno-91-4"></a>    <span class="n">high</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="o">.</span><span class="n">reduce</span><span class="p">([</span><span class="n">high</span><span class="p">,</span> <span class="nb">open</span><span class="p">,</span> <span class="n">close</span><span class="p">])</span>
<a id="__codelineno-91-5" name="__codelineno-91-5" href="#__codelineno-91-5"></a>
<a id="__codelineno-91-6" name="__codelineno-91-6" href="#__codelineno-91-6"></a>    <span class="c1"># Adjust low to be min of all</span>
<a id="__codelineno-91-7" name="__codelineno-91-7" href="#__codelineno-91-7"></a>    <span class="n">low</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="o">.</span><span class="n">reduce</span><span class="p">([</span><span class="n">low</span><span class="p">,</span> <span class="nb">open</span><span class="p">,</span> <span class="n">close</span><span class="p">])</span>
<a id="__codelineno-91-8" name="__codelineno-91-8" href="#__codelineno-91-8"></a>
<a id="__codelineno-91-9" name="__codelineno-91-9" href="#__codelineno-91-9"></a>    <span class="c1"># Ensure high ≥ low</span>
<a id="__codelineno-91-10" name="__codelineno-91-10" href="#__codelineno-91-10"></a>    <span class="n">high</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">high</span><span class="p">,</span> <span class="n">low</span> <span class="o">+</span> <span class="n">epsilon</span><span class="p">)</span>
<a id="__codelineno-91-11" name="__codelineno-91-11" href="#__codelineno-91-11"></a>
<a id="__codelineno-91-12" name="__codelineno-91-12" href="#__codelineno-91-12"></a>    <span class="c1"># Ensure volume ≥ 0</span>
<a id="__codelineno-91-13" name="__codelineno-91-13" href="#__codelineno-91-13"></a>    <span class="n">volume</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">volume</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-91-14" name="__codelineno-91-14" href="#__codelineno-91-14"></a>
<a id="__codelineno-91-15" name="__codelineno-91-15" href="#__codelineno-91-15"></a>    <span class="k">return</span> <span class="n">fixed_data</span>
</code></pre></div>
<p><strong>Constraints</strong>:
1. high ≥ low (always)
2. high ≥ open, close (always)
3. low ≤ open, close (always)
4. volume ≥ 0 (always)</p>
<h3 id="degradation-analysis">Degradation Analysis<a class="headerlink" href="#degradation-analysis" title="Permanent link">&para;</a></h3>
<p><strong>Performance Degradation</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a>degradation = (original - noisy_mean) / |original| × 100%
</code></pre></div></p>
<p><strong>Interpretation</strong>:
- <strong>&lt; 20%</strong>: ✅ <strong>Robust</strong> - Strategy tolerates noise well
- <strong>20-50%</strong>: ⚠️ <strong>Moderate</strong> - Some noise sensitivity
- <strong>&gt; 50%</strong>: ❌ <strong>Fragile</strong> - Likely overfit to price patterns</p>
<p><strong>Worst-Case Analysis</strong>:
- 5th percentile of noisy distribution
- Conservative estimate of performance under adverse noise</p>
<h3 id="usage-example_2">Usage Example<a class="headerlink" href="#usage-example_2" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a><span class="kn">from</span> <span class="nn">rustybt.optimization</span> <span class="kn">import</span> <span class="n">NoiseInfusionSimulator</span>
<a id="__codelineno-93-2" name="__codelineno-93-2" href="#__codelineno-93-2"></a><span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span>
<a id="__codelineno-93-3" name="__codelineno-93-3" href="#__codelineno-93-3"></a><span class="kn">import</span> <span class="nn">polars</span> <span class="k">as</span> <span class="nn">pl</span>
<a id="__codelineno-93-4" name="__codelineno-93-4" href="#__codelineno-93-4"></a>
<a id="__codelineno-93-5" name="__codelineno-93-5" href="#__codelineno-93-5"></a><span class="c1"># Define backtest function</span>
<a id="__codelineno-93-6" name="__codelineno-93-6" href="#__codelineno-93-6"></a><span class="k">def</span> <span class="nf">backtest</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">]:</span>
<a id="__codelineno-93-7" name="__codelineno-93-7" href="#__codelineno-93-7"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Run strategy backtest and return metrics.&quot;&quot;&quot;</span>
<a id="__codelineno-93-8" name="__codelineno-93-8" href="#__codelineno-93-8"></a>    <span class="c1"># ... strategy logic ...</span>
<a id="__codelineno-93-9" name="__codelineno-93-9" href="#__codelineno-93-9"></a>    <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-93-10" name="__codelineno-93-10" href="#__codelineno-93-10"></a>        <span class="s1">&#39;sharpe_ratio&#39;</span><span class="p">:</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;1.5&#39;</span><span class="p">),</span>
<a id="__codelineno-93-11" name="__codelineno-93-11" href="#__codelineno-93-11"></a>        <span class="s1">&#39;total_return&#39;</span><span class="p">:</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;0.25&#39;</span><span class="p">),</span>
<a id="__codelineno-93-12" name="__codelineno-93-12" href="#__codelineno-93-12"></a>        <span class="s1">&#39;max_drawdown&#39;</span><span class="p">:</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;0.15&#39;</span><span class="p">),</span>
<a id="__codelineno-93-13" name="__codelineno-93-13" href="#__codelineno-93-13"></a>    <span class="p">}</span>
<a id="__codelineno-93-14" name="__codelineno-93-14" href="#__codelineno-93-14"></a>
<a id="__codelineno-93-15" name="__codelineno-93-15" href="#__codelineno-93-15"></a><span class="c1"># Run original backtest</span>
<a id="__codelineno-93-16" name="__codelineno-93-16" href="#__codelineno-93-16"></a><span class="n">original_result</span> <span class="o">=</span> <span class="n">backtest</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-93-17" name="__codelineno-93-17" href="#__codelineno-93-17"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Original Sharpe: </span><span class="si">{</span><span class="n">original_result</span><span class="p">[</span><span class="s1">&#39;sharpe_ratio&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-93-18" name="__codelineno-93-18" href="#__codelineno-93-18"></a>
<a id="__codelineno-93-19" name="__codelineno-93-19" href="#__codelineno-93-19"></a><span class="c1"># Initialize noise infusion simulator</span>
<a id="__codelineno-93-20" name="__codelineno-93-20" href="#__codelineno-93-20"></a><span class="n">simulator</span> <span class="o">=</span> <span class="n">NoiseInfusionSimulator</span><span class="p">(</span>
<a id="__codelineno-93-21" name="__codelineno-93-21" href="#__codelineno-93-21"></a>    <span class="n">n_simulations</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>      <span class="c1"># 1000 noise realizations</span>
<a id="__codelineno-93-22" name="__codelineno-93-22" href="#__codelineno-93-22"></a>    <span class="n">std_pct</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>            <span class="c1"># 1% noise amplitude</span>
<a id="__codelineno-93-23" name="__codelineno-93-23" href="#__codelineno-93-23"></a>    <span class="n">noise_model</span><span class="o">=</span><span class="s1">&#39;gaussian&#39;</span><span class="p">,</span>  <span class="c1"># Gaussian noise</span>
<a id="__codelineno-93-24" name="__codelineno-93-24" href="#__codelineno-93-24"></a>    <span class="n">seed</span><span class="o">=</span><span class="mi">42</span>                  <span class="c1"># Reproducibility</span>
<a id="__codelineno-93-25" name="__codelineno-93-25" href="#__codelineno-93-25"></a><span class="p">)</span>
<a id="__codelineno-93-26" name="__codelineno-93-26" href="#__codelineno-93-26"></a>
<a id="__codelineno-93-27" name="__codelineno-93-27" href="#__codelineno-93-27"></a><span class="c1"># Run simulation</span>
<a id="__codelineno-93-28" name="__codelineno-93-28" href="#__codelineno-93-28"></a><span class="n">result</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">backtest</span><span class="p">)</span>
<a id="__codelineno-93-29" name="__codelineno-93-29" href="#__codelineno-93-29"></a>
<a id="__codelineno-93-30" name="__codelineno-93-30" href="#__codelineno-93-30"></a><span class="c1"># Display summary</span>
<a id="__codelineno-93-31" name="__codelineno-93-31" href="#__codelineno-93-31"></a><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">get_summary</span><span class="p">(</span><span class="s1">&#39;sharpe_ratio&#39;</span><span class="p">))</span>
<a id="__codelineno-93-32" name="__codelineno-93-32" href="#__codelineno-93-32"></a><span class="c1"># Noise Infusion Test (1000 simulations, gaussian noise, 1.0% amplitude)</span>
<a id="__codelineno-93-33" name="__codelineno-93-33" href="#__codelineno-93-33"></a><span class="c1"># Metric: sharpe_ratio</span>
<a id="__codelineno-93-34" name="__codelineno-93-34" href="#__codelineno-93-34"></a><span class="c1"># Original (noise-free): 1.5000</span>
<a id="__codelineno-93-35" name="__codelineno-93-35" href="#__codelineno-93-35"></a><span class="c1"># Noisy mean: 1.4200 ± 0.1500</span>
<a id="__codelineno-93-36" name="__codelineno-93-36" href="#__codelineno-93-36"></a><span class="c1"># 95% CI: [1.1300, 1.7100]</span>
<a id="__codelineno-93-37" name="__codelineno-93-37" href="#__codelineno-93-37"></a><span class="c1"># Worst case (5th %ile): 1.1800</span>
<a id="__codelineno-93-38" name="__codelineno-93-38" href="#__codelineno-93-38"></a><span class="c1"># Degradation: 5.3%</span>
<a id="__codelineno-93-39" name="__codelineno-93-39" href="#__codelineno-93-39"></a><span class="c1">#</span>
<a id="__codelineno-93-40" name="__codelineno-93-40" href="#__codelineno-93-40"></a><span class="c1"># ✅ ROBUST: Strategy tolerates noise well</span>
<a id="__codelineno-93-41" name="__codelineno-93-41" href="#__codelineno-93-41"></a>
<a id="__codelineno-93-42" name="__codelineno-93-42" href="#__codelineno-93-42"></a><span class="c1"># Visualize distribution</span>
<a id="__codelineno-93-43" name="__codelineno-93-43" href="#__codelineno-93-43"></a><span class="n">result</span><span class="o">.</span><span class="n">plot_distribution</span><span class="p">(</span><span class="s1">&#39;sharpe_ratio&#39;</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="s1">&#39;noise_sharpe.png&#39;</span><span class="p">)</span>
<a id="__codelineno-93-44" name="__codelineno-93-44" href="#__codelineno-93-44"></a>
<a id="__codelineno-93-45" name="__codelineno-93-45" href="#__codelineno-93-45"></a><span class="c1"># Check robustness</span>
<a id="__codelineno-93-46" name="__codelineno-93-46" href="#__codelineno-93-46"></a><span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">is_robust</span><span class="p">[</span><span class="s1">&#39;sharpe_ratio&#39;</span><span class="p">]:</span>
<a id="__codelineno-93-47" name="__codelineno-93-47" href="#__codelineno-93-47"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✅ Strategy is robust to noise&quot;</span><span class="p">)</span>
<a id="__codelineno-93-48" name="__codelineno-93-48" href="#__codelineno-93-48"></a><span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">is_fragile</span><span class="p">[</span><span class="s1">&#39;sharpe_ratio&#39;</span><span class="p">]:</span>
<a id="__codelineno-93-49" name="__codelineno-93-49" href="#__codelineno-93-49"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;❌ Strategy is fragile (likely overfit)&quot;</span><span class="p">)</span>
<a id="__codelineno-93-50" name="__codelineno-93-50" href="#__codelineno-93-50"></a><span class="k">else</span><span class="p">:</span>
<a id="__codelineno-93-51" name="__codelineno-93-51" href="#__codelineno-93-51"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;⚠️  Strategy shows moderate noise sensitivity&quot;</span><span class="p">)</span>
<a id="__codelineno-93-52" name="__codelineno-93-52" href="#__codelineno-93-52"></a>
<a id="__codelineno-93-53" name="__codelineno-93-53" href="#__codelineno-93-53"></a><span class="c1"># Test multiple noise levels</span>
<a id="__codelineno-93-54" name="__codelineno-93-54" href="#__codelineno-93-54"></a><span class="k">for</span> <span class="n">std_pct</span> <span class="ow">in</span> <span class="p">[</span><span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">]:</span>
<a id="__codelineno-93-55" name="__codelineno-93-55" href="#__codelineno-93-55"></a>    <span class="n">sim</span> <span class="o">=</span> <span class="n">NoiseInfusionSimulator</span><span class="p">(</span><span class="n">n_simulations</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">std_pct</span><span class="o">=</span><span class="n">std_pct</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<a id="__codelineno-93-56" name="__codelineno-93-56" href="#__codelineno-93-56"></a>    <span class="n">res</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">backtest</span><span class="p">)</span>
<a id="__codelineno-93-57" name="__codelineno-93-57" href="#__codelineno-93-57"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">std_pct</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">% noise → </span><span class="si">{</span><span class="n">res</span><span class="o">.</span><span class="n">degradation_pct</span><span class="p">[</span><span class="s1">&#39;sharpe_ratio&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">% degradation&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="comparison-with-monte-carlo-permutation">Comparison with Monte Carlo Permutation<a class="headerlink" href="#comparison-with-monte-carlo-permutation" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>Monte Carlo Permutation</th>
<th>Noise Infusion</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>What is perturbed</strong></td>
<td>Trade order</td>
<td>Price data</td>
</tr>
<tr>
<td><strong>Question answered</strong></td>
<td>Is sequence luck?</td>
<td>Is strategy overfit to patterns?</td>
</tr>
<tr>
<td><strong>Noise type</strong></td>
<td>Shuffle trades</td>
<td>Add price noise</td>
</tr>
<tr>
<td><strong>Temporal structure</strong></td>
<td>Broken</td>
<td>Can be preserved</td>
</tr>
<tr>
<td><strong>Use case</strong></td>
<td>Validate trade sequence</td>
<td>Validate pattern robustness</td>
</tr>
<tr>
<td><strong>Analogy</strong></td>
<td>Cross-validation</td>
<td>Data augmentation</td>
</tr>
</tbody>
</table>
<p><strong>When to use each</strong>:
- <strong>Permutation</strong>: Test if performance is due to lucky trade sequencing
- <strong>Noise Infusion</strong>: Test if strategy is overfit to specific price patterns
- <strong>Both</strong>: Comprehensive robustness validation</p>
<h3 id="noise-amplitude-guidelines">Noise Amplitude Guidelines<a class="headerlink" href="#noise-amplitude-guidelines" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>std_pct</th>
<th>Noise Level</th>
<th>Interpretation</th>
</tr>
</thead>
<tbody>
<tr>
<td>0.5%</td>
<td>Very Mild</td>
<td>Minimal perturbation, basic sanity check</td>
</tr>
<tr>
<td>1.0%</td>
<td>Moderate</td>
<td><strong>Default</strong>, reasonable real-world noise</td>
</tr>
<tr>
<td>2.0%</td>
<td>Aggressive</td>
<td>Stress test, larger perturbations</td>
</tr>
<tr>
<td>3-5%</td>
<td>Extreme</td>
<td>Worst-case scenarios, high volatility</td>
</tr>
</tbody>
</table>
<p><strong>Recommendation</strong>: Start with 1% noise. If strategy is robust, test with 2-3% for stress testing.</p>
<h3 id="temporal-structure-preservation-advanced">Temporal Structure Preservation (Advanced)<a class="headerlink" href="#temporal-structure-preservation-advanced" title="Permanent link">&para;</a></h3>
<p>Simple additive noise breaks autocorrelation and trends. For more realistic noise:</p>
<p><strong>ARMA Noise</strong> (Optional):
<div class="highlight"><pre><span></span><code><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a><span class="kn">from</span> <span class="nn">statsmodels.tsa.arima.model</span> <span class="kn">import</span> <span class="n">ARIMA</span>
<a id="__codelineno-94-2" name="__codelineno-94-2" href="#__codelineno-94-2"></a>
<a id="__codelineno-94-3" name="__codelineno-94-3" href="#__codelineno-94-3"></a><span class="c1"># Fit ARMA to returns</span>
<a id="__codelineno-94-4" name="__codelineno-94-4" href="#__codelineno-94-4"></a><span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">returns</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-94-5" name="__codelineno-94-5" href="#__codelineno-94-5"></a><span class="n">fitted</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<a id="__codelineno-94-6" name="__codelineno-94-6" href="#__codelineno-94-6"></a>
<a id="__codelineno-94-7" name="__codelineno-94-7" href="#__codelineno-94-7"></a><span class="c1"># Simulate ARMA noise (preserves autocorrelation)</span>
<a id="__codelineno-94-8" name="__codelineno-94-8" href="#__codelineno-94-8"></a><span class="n">arma_noise</span> <span class="o">=</span> <span class="n">fitted</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">nsimulations</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">returns</span><span class="p">))</span>
<a id="__codelineno-94-9" name="__codelineno-94-9" href="#__codelineno-94-9"></a><span class="n">close_noisy</span> <span class="o">=</span> <span class="n">close</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">arma_noise</span><span class="p">)</span>
</code></pre></div></p>
<p><strong>Trade-off</strong>: ARMA noise is more realistic but complex. Simple Gaussian/bootstrap noise is sufficient for most use cases.</p>
<h3 id="integration-with-optimization-pipeline">Integration with Optimization Pipeline<a class="headerlink" href="#integration-with-optimization-pipeline" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a><span class="kn">from</span> <span class="nn">rustybt.optimization</span> <span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-95-2" name="__codelineno-95-2" href="#__codelineno-95-2"></a>    <span class="n">Optimizer</span><span class="p">,</span>
<a id="__codelineno-95-3" name="__codelineno-95-3" href="#__codelineno-95-3"></a>    <span class="n">GridSearchAlgorithm</span><span class="p">,</span>
<a id="__codelineno-95-4" name="__codelineno-95-4" href="#__codelineno-95-4"></a>    <span class="n">NoiseInfusionSimulator</span><span class="p">,</span>
<a id="__codelineno-95-5" name="__codelineno-95-5" href="#__codelineno-95-5"></a><span class="p">)</span>
<a id="__codelineno-95-6" name="__codelineno-95-6" href="#__codelineno-95-6"></a>
<a id="__codelineno-95-7" name="__codelineno-95-7" href="#__codelineno-95-7"></a><span class="c1"># 1. Run optimization to find best parameters</span>
<a id="__codelineno-95-8" name="__codelineno-95-8" href="#__codelineno-95-8"></a><span class="n">optimizer</span> <span class="o">=</span> <span class="n">Optimizer</span><span class="p">(</span>
<a id="__codelineno-95-9" name="__codelineno-95-9" href="#__codelineno-95-9"></a>    <span class="n">search_algorithm</span><span class="o">=</span><span class="n">GridSearchAlgorithm</span><span class="p">(),</span>
<a id="__codelineno-95-10" name="__codelineno-95-10" href="#__codelineno-95-10"></a>    <span class="n">parameter_space</span><span class="o">=</span><span class="n">param_space</span><span class="p">,</span>
<a id="__codelineno-95-11" name="__codelineno-95-11" href="#__codelineno-95-11"></a>    <span class="n">objective_function</span><span class="o">=</span><span class="n">objective_fn</span><span class="p">,</span>
<a id="__codelineno-95-12" name="__codelineno-95-12" href="#__codelineno-95-12"></a><span class="p">)</span>
<a id="__codelineno-95-13" name="__codelineno-95-13" href="#__codelineno-95-13"></a><span class="n">best_params</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-95-14" name="__codelineno-95-14" href="#__codelineno-95-14"></a>
<a id="__codelineno-95-15" name="__codelineno-95-15" href="#__codelineno-95-15"></a><span class="c1"># 2. Run walk-forward validation</span>
<a id="__codelineno-95-16" name="__codelineno-95-16" href="#__codelineno-95-16"></a><span class="n">wf_optimizer</span> <span class="o">=</span> <span class="n">WalkForwardOptimizer</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-95-17" name="__codelineno-95-17" href="#__codelineno-95-17"></a><span class="n">wf_result</span> <span class="o">=</span> <span class="n">wf_optimizer</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">strategy</span><span class="p">,</span> <span class="n">param_space</span><span class="p">)</span>
<a id="__codelineno-95-18" name="__codelineno-95-18" href="#__codelineno-95-18"></a>
<a id="__codelineno-95-19" name="__codelineno-95-19" href="#__codelineno-95-19"></a><span class="c1"># 3. Run noise infusion test (robustness check)</span>
<a id="__codelineno-95-20" name="__codelineno-95-20" href="#__codelineno-95-20"></a><span class="k">def</span> <span class="nf">backtest_with_best_params</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">]:</span>
<a id="__codelineno-95-21" name="__codelineno-95-21" href="#__codelineno-95-21"></a>    <span class="k">return</span> <span class="n">run_backtest</span><span class="p">(</span><span class="n">strategy</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">best_params</span><span class="p">)</span>
<a id="__codelineno-95-22" name="__codelineno-95-22" href="#__codelineno-95-22"></a>
<a id="__codelineno-95-23" name="__codelineno-95-23" href="#__codelineno-95-23"></a><span class="n">simulator</span> <span class="o">=</span> <span class="n">NoiseInfusionSimulator</span><span class="p">(</span><span class="n">n_simulations</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">std_pct</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<a id="__codelineno-95-24" name="__codelineno-95-24" href="#__codelineno-95-24"></a><span class="n">noise_result</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">backtest_with_best_params</span><span class="p">)</span>
<a id="__codelineno-95-25" name="__codelineno-95-25" href="#__codelineno-95-25"></a>
<a id="__codelineno-95-26" name="__codelineno-95-26" href="#__codelineno-95-26"></a><span class="c1"># 4. Decision gate</span>
<a id="__codelineno-95-27" name="__codelineno-95-27" href="#__codelineno-95-27"></a><span class="k">if</span> <span class="p">(</span><span class="n">wf_result</span><span class="o">.</span><span class="n">is_consistent</span> <span class="ow">and</span>
<a id="__codelineno-95-28" name="__codelineno-95-28" href="#__codelineno-95-28"></a>    <span class="n">noise_result</span><span class="o">.</span><span class="n">is_robust</span><span class="p">[</span><span class="s1">&#39;sharpe_ratio&#39;</span><span class="p">]):</span>
<a id="__codelineno-95-29" name="__codelineno-95-29" href="#__codelineno-95-29"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✅ Strategy passed all validation tests → Ready for live trading&quot;</span><span class="p">)</span>
<a id="__codelineno-95-30" name="__codelineno-95-30" href="#__codelineno-95-30"></a><span class="k">else</span><span class="p">:</span>
<a id="__codelineno-95-31" name="__codelineno-95-31" href="#__codelineno-95-31"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;❌ Strategy failed validation → Do not deploy&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="testing-strategy_1">Testing Strategy<a class="headerlink" href="#testing-strategy_1" title="Permanent link">&para;</a></h3>
<p><strong>Unit Tests</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a><span class="k">def</span> <span class="nf">test_ohlcv_constraints_preserved</span><span class="p">():</span>
<a id="__codelineno-96-2" name="__codelineno-96-2" href="#__codelineno-96-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Noisy data must satisfy OHLCV constraints.&quot;&quot;&quot;</span>
<a id="__codelineno-96-3" name="__codelineno-96-3" href="#__codelineno-96-3"></a>    <span class="n">sim</span> <span class="o">=</span> <span class="n">NoiseInfusionSimulator</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<a id="__codelineno-96-4" name="__codelineno-96-4" href="#__codelineno-96-4"></a>    <span class="n">noisy_data</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">add_noise</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-96-5" name="__codelineno-96-5" href="#__codelineno-96-5"></a>
<a id="__codelineno-96-6" name="__codelineno-96-6" href="#__codelineno-96-6"></a>    <span class="k">assert</span> <span class="p">(</span><span class="n">noisy_data</span><span class="p">[</span><span class="s1">&#39;high&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">noisy_data</span><span class="p">[</span><span class="s1">&#39;low&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<a id="__codelineno-96-7" name="__codelineno-96-7" href="#__codelineno-96-7"></a>    <span class="k">assert</span> <span class="p">(</span><span class="n">noisy_data</span><span class="p">[</span><span class="s1">&#39;high&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">noisy_data</span><span class="p">[</span><span class="s1">&#39;open&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<a id="__codelineno-96-8" name="__codelineno-96-8" href="#__codelineno-96-8"></a>    <span class="k">assert</span> <span class="p">(</span><span class="n">noisy_data</span><span class="p">[</span><span class="s1">&#39;high&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">noisy_data</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</code></pre></div></p>
<p><strong>Property Tests</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a><span class="nd">@given</span><span class="p">(</span><span class="n">std_pct</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">floats</span><span class="p">(</span><span class="n">min_value</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mf">0.1</span><span class="p">))</span>
<a id="__codelineno-97-2" name="__codelineno-97-2" href="#__codelineno-97-2"></a><span class="k">def</span> <span class="nf">test_noise_amplitude_scaling</span><span class="p">(</span><span class="n">std_pct</span><span class="p">):</span>
<a id="__codelineno-97-3" name="__codelineno-97-3" href="#__codelineno-97-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Higher noise amplitude increases variance.&quot;&quot;&quot;</span>
<a id="__codelineno-97-4" name="__codelineno-97-4" href="#__codelineno-97-4"></a>    <span class="n">sim1</span> <span class="o">=</span> <span class="n">NoiseInfusionSimulator</span><span class="p">(</span><span class="n">std_pct</span><span class="o">=</span><span class="n">std_pct</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<a id="__codelineno-97-5" name="__codelineno-97-5" href="#__codelineno-97-5"></a>    <span class="n">sim2</span> <span class="o">=</span> <span class="n">NoiseInfusionSimulator</span><span class="p">(</span><span class="n">std_pct</span><span class="o">=</span><span class="n">std_pct</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">43</span><span class="p">)</span>
<a id="__codelineno-97-6" name="__codelineno-97-6" href="#__codelineno-97-6"></a>
<a id="__codelineno-97-7" name="__codelineno-97-7" href="#__codelineno-97-7"></a>    <span class="n">noisy1</span> <span class="o">=</span> <span class="n">sim1</span><span class="o">.</span><span class="n">add_noise</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-97-8" name="__codelineno-97-8" href="#__codelineno-97-8"></a>    <span class="n">noisy2</span> <span class="o">=</span> <span class="n">sim2</span><span class="o">.</span><span class="n">add_noise</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-97-9" name="__codelineno-97-9" href="#__codelineno-97-9"></a>
<a id="__codelineno-97-10" name="__codelineno-97-10" href="#__codelineno-97-10"></a>    <span class="n">var1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">noisy1</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">])</span>
<a id="__codelineno-97-11" name="__codelineno-97-11" href="#__codelineno-97-11"></a>    <span class="n">var2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">noisy2</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">])</span>
<a id="__codelineno-97-12" name="__codelineno-97-12" href="#__codelineno-97-12"></a>
<a id="__codelineno-97-13" name="__codelineno-97-13" href="#__codelineno-97-13"></a>    <span class="k">assert</span> <span class="n">var2</span> <span class="o">&gt;</span> <span class="n">var1</span>  <span class="c1"># Higher amplitude → higher variance</span>
</code></pre></div></p>
<p><strong>Integration Tests</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a><span class="k">def</span> <span class="nf">test_robust_vs_fragile_strategies</span><span class="p">():</span>
<a id="__codelineno-98-2" name="__codelineno-98-2" href="#__codelineno-98-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Robust strategies should have low degradation.&quot;&quot;&quot;</span>
<a id="__codelineno-98-3" name="__codelineno-98-3" href="#__codelineno-98-3"></a>    <span class="c1"># Robust strategy (trend following)</span>
<a id="__codelineno-98-4" name="__codelineno-98-4" href="#__codelineno-98-4"></a>    <span class="n">robust_result</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">robust_strategy</span><span class="p">)</span>
<a id="__codelineno-98-5" name="__codelineno-98-5" href="#__codelineno-98-5"></a>    <span class="k">assert</span> <span class="n">robust_result</span><span class="o">.</span><span class="n">degradation_pct</span><span class="p">[</span><span class="s1">&#39;sharpe_ratio&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;20&#39;</span><span class="p">)</span>
<a id="__codelineno-98-6" name="__codelineno-98-6" href="#__codelineno-98-6"></a>
<a id="__codelineno-98-7" name="__codelineno-98-7" href="#__codelineno-98-7"></a>    <span class="c1"># Fragile strategy (pattern matching)</span>
<a id="__codelineno-98-8" name="__codelineno-98-8" href="#__codelineno-98-8"></a>    <span class="n">fragile_result</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fragile_strategy</span><span class="p">)</span>
<a id="__codelineno-98-9" name="__codelineno-98-9" href="#__codelineno-98-9"></a>    <span class="k">assert</span> <span class="n">fragile_result</span><span class="o">.</span><span class="n">degradation_pct</span><span class="p">[</span><span class="s1">&#39;sharpe_ratio&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;50&#39;</span><span class="p">)</span>
</code></pre></div></p>
<h3 id="performance-considerations_2">Performance Considerations<a class="headerlink" href="#performance-considerations_2" title="Permanent link">&para;</a></h3>
<p><strong>Computational Cost</strong>:
- N simulations × backtest time
- For 1000 simulations × 1s backtest = ~17 minutes
- Parallelization possible (independent simulations)</p>
<p><strong>Optimization</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a><span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ProcessPoolExecutor</span>
<a id="__codelineno-99-2" name="__codelineno-99-2" href="#__codelineno-99-2"></a>
<a id="__codelineno-99-3" name="__codelineno-99-3" href="#__codelineno-99-3"></a><span class="k">def</span> <span class="nf">run_parallel_noise_infusion</span><span class="p">(</span>
<a id="__codelineno-99-4" name="__codelineno-99-4" href="#__codelineno-99-4"></a>    <span class="n">data</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
<a id="__codelineno-99-5" name="__codelineno-99-5" href="#__codelineno-99-5"></a>    <span class="n">backtest_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
<a id="__codelineno-99-6" name="__codelineno-99-6" href="#__codelineno-99-6"></a>    <span class="n">n_simulations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
<a id="__codelineno-99-7" name="__codelineno-99-7" href="#__codelineno-99-7"></a>    <span class="n">n_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
<a id="__codelineno-99-8" name="__codelineno-99-8" href="#__codelineno-99-8"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NoiseInfusionResult</span><span class="p">:</span>
<a id="__codelineno-99-9" name="__codelineno-99-9" href="#__codelineno-99-9"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Run noise infusion with parallel execution.&quot;&quot;&quot;</span>
<a id="__codelineno-99-10" name="__codelineno-99-10" href="#__codelineno-99-10"></a>    <span class="k">with</span> <span class="n">ProcessPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="n">n_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
<a id="__codelineno-99-11" name="__codelineno-99-11" href="#__codelineno-99-11"></a>        <span class="n">futures</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-99-12" name="__codelineno-99-12" href="#__codelineno-99-12"></a>            <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">run_single_simulation</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">backtest_fn</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-99-13" name="__codelineno-99-13" href="#__codelineno-99-13"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_simulations</span><span class="p">)</span>
<a id="__codelineno-99-14" name="__codelineno-99-14" href="#__codelineno-99-14"></a>        <span class="p">]</span>
<a id="__codelineno-99-15" name="__codelineno-99-15" href="#__codelineno-99-15"></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">result</span><span class="p">()</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">futures</span><span class="p">]</span>
<a id="__codelineno-99-16" name="__codelineno-99-16" href="#__codelineno-99-16"></a>
<a id="__codelineno-99-17" name="__codelineno-99-17" href="#__codelineno-99-17"></a>    <span class="k">return</span> <span class="n">aggregate_results</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</code></pre></div></p>
<h3 id="references_2">References<a class="headerlink" href="#references_2" title="Permanent link">&para;</a></h3>
<p><strong>Theoretical Foundation</strong>:
- <strong>Data Augmentation</strong>: Simard et al. (2003) - "Best Practices for Convolutional Neural Networks"
- <strong>Robustness Testing</strong>: Szegedy et al. (2014) - "Intriguing Properties of Neural Networks"
- <strong>Trading System Validation</strong>: Prado (2018) - "Advances in Financial Machine Learning"</p>
<p><strong>Related Work</strong>:
- <strong>ML Regularization</strong>: Noise injection as regularization technique
- <strong>Adversarial Testing</strong>: Robustness to input perturbations
- <strong>Sensitivity Analysis</strong>: Parameter stability under noise</p>
<h3 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">&para;</a></h3>
<p>Noise infusion testing answers: <strong>"Is my strategy overfit to noise-free historical patterns?"</strong></p>
<p><strong>Key Benefits</strong>:
- Detects overfitting to specific price sequences
- Validates strategy generalization
- Provides confidence intervals under realistic noise
- Complements Monte Carlo permutation testing</p>
<p><strong>Interpretation</strong>:
- ✅ <strong>Robust</strong> (&lt; 20% degradation): Deploy with confidence
- ⚠️ <strong>Moderate</strong> (20-50%): Review strategy, consider simplification
- ❌ <strong>Fragile</strong> (&gt; 50%): Do not deploy, likely overfit</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/jerryinyang/rustybt" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://pypi.org/project/rustybt/" target="_blank" rel="noopener" title="pypi.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6M286.2 444.7a20.4 20.4 0 1 1 0-40.7 20.4 20.4 0 1 1 0 40.7M167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4m-6.6-183.4a20.4 20.4 0 1 1 0 40.8 20.4 20.4 0 1 1 0-40.8"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.path", "navigation.top", "navigation.footer", "toc.follow", "search.suggest", "search.highlight", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>